

                                                                <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang='zh-CN' xml:lang='zh-CN' xmlns='http://www.w3.org/1999/xhtml'>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
  <meta http-equiv="Content-Language" content="zh-CN"/>
  <title>gerry_pang的博客</title>
  <style>
  body {font:12px/21px Tahoma,"Microsoft Yahei",Geneva,sans-serif;}
  h1 a {color:#40AA53;}
  h1 a,h2 a{text-decoration:none;}
  .backupDesc em {font-style:normal;}
  .blog {margin:0 0 20px 0;border:1px solid #ccc;background:#ffc;padding:10px;}
  .blog h2 {border-bottom:1px solid #ccc;padding:0 0 10px 0;}
  .blog h2 a.top {float:right;font-weight:normal;font-size:9pt;}
  .blog .outline {background:#fff;border:1px solid #eee;padding:10px;color:#666;}
  
  .commentList {margin:20px 0 0 0;}
  .comment {margin:0 0 10px 0; border:1px solid #ddd; background:#ffe;padding:5px;}
  .comment .author {float:left;font-weight:bold;}
  .comment .date {float:left;margin:0 0 0 10px;}
  .comment .content {clear:left;margin:5px 0 0 0;}
  </style>
</head>
<body>
  <h1><a name='top' href="https://my.oschina.net/u/225084/blog">gerry_pang的博客@OSCHINA</a></h1>
  <p class='backupDesc'>共有<em>63</em>篇文章，备份时间：2018-02-04 11:39:07</p>
  <ol>
		<li><a href="#blog_780889">JD面试Pass的挫败感</a></li>
		<li><a href="#blog_282158">技术人员，请注意那些被你忽略的重要事情 [转载]</a></li>
		<li><a href="#blog_223777">分享免费教学视频网站</a></li>
		<li><a href="#blog_215668">Kettle 学习知识总结(一)</a></li>
		<li><a href="#blog_208809">Hibernate查询返回list对象分析学习</a></li>
		<li><a href="#blog_179882">使用IE"F12开发人员工具"调试Js错误</a></li>
		<li><a href="#blog_178266">解决MySql数据库连接超时问题</a></li>
		<li><a href="#blog_167842">spring getbean 方法分析</a></li>
		<li><a href="#blog_151989">quartz无法启动的原因</a></li>
		<li><a href="#blog_151988">使用cronTriggerBean子类,动态设置cronExpression(quartz +...</a></li>
		<li><a href="#blog_151984">ajax Post 使用总结</a></li>
		<li><a href="#blog_151982">Highchart 动态从库中读取数据</a></li>
		<li><a href="#blog_822438">JQuery Nicescroll插件功能不生效检查点</a></li>
		<li><a href="#blog_363466">SQL1084C  Shared memory segments cannot be allocat</a></li>
		<li><a href="#blog_363449">"orcibly releasing inactive connection" 异常处理</a></li>
		<li><a href="#blog_363448">weblogic  "ThreadPool has stuck threads"  异常处理</a></li>
		<li><a href="#blog_280773">对于类中静态变量的控制问题</a></li>
		<li><a href="#blog_280725">通过HttpClient类调用其他子系统中action方法 </a></li>
		<li><a href="#blog_264893">单点登录系统技术(SSO)梳理(二)</a></li>
		<li><a href="#blog_264045">单点登录系统技术(SSO)梳理(一)</a></li>
		<li><a href="#blog_228609">ajax "SyntaxError: missing ; before statement"错误解决</a></li>
		<li><a href="#blog_215673">Kettle 学习知识总结（三）</a></li>
		<li><a href="#blog_215672">Linux 定时插件Crontab</a></li>
		<li><a href="#blog_215671">Kettle 学习知识总结（二）</a></li>
		<li><a href="#blog_213454">SQL  case when 语句学习</a></li>
		<li><a href="#blog_213292">Junit 4 学习笔记（四、Junit Parameters）</a></li>
		<li><a href="#blog_213267">Junit 4 学习笔记（三、测试套件TestSuite）</a></li>
		<li><a href="#blog_213266">Junit 4 学习笔记（二、assert方法的分类）</a></li>
		<li><a href="#blog_213261">Junit 4 学习笔记（一、注释学习）</a></li>
		<li><a href="#blog_207215">常用的js正则校验表达式</a></li>
		<li><a href="#blog_207192">有趣的winodw.open方法</a></li>
		<li><a href="#blog_191845">Was(WebSphere)不能正常打印程序日志问题</a></li>
		<li><a href="#blog_188126">程序员的吐槽</a></li>
		<li><a href="#blog_181021">org.hibernate.exception.GenericJDBCException异常</a></li>
		<li><a href="#blog_181020">sun.io.MalformedInputException  IBM Websphere 中间件异常</a></li>
		<li><a href="#blog_178261">破解word受保护文档</a></li>
		<li><a href="#blog_177185">杂记</a></li>
		<li><a href="#blog_177184">前端界面开发精彩文章总结</a></li>
		<li><a href="#blog_177183">Spring事务</a></li>
		<li><a href="#blog_172780">ssh数据源（c3p0+was）</a></li>
		<li><a href="#blog_170831">quartz demo</a></li>
		<li><a href="#blog_170620">HQL学习总结</a></li>
		<li><a href="#blog_170619">shell编程时要注意点</a></li>
		<li><a href="#blog_170617">list使用的低级错误</a></li>
		<li><a href="#blog_170615">spring主动注入（每次调用getBean类似new一个对象）</a></li>
		<li><a href="#blog_170614">数据库连接超时异常</a></li>
		<li><a href="#blog_169410">处女作开发总结</a></li>
		<li><a href="#blog_163707">new idea</a></li>
		<li><a href="#blog_162411">String类型使用注意</a></li>
		<li><a href="#blog_162410">Jsp中C标签学习总结</a></li>
		<li><a href="#blog_162409">开发中与浏览器相关的一些问题总结</a></li>
		<li><a href="#blog_161048">Illegal attempt to associate a collection with ...</a></li>
		<li><a href="#blog_161046">Unable to instantiate Action 异常</a></li>
		<li><a href="#blog_161045"> There is no result type defined for type &apos...</a></li>
		<li><a href="#blog_161044">spring quartz 常见的"Table 'database.qrtz_locks' d...</a></li>
		<li><a href="#blog_161043">tomcat异常：parmeter：Invalid chunk ignored</a></li>
		<li><a href="#blog_161042">org.springframework.beans.factory.BeanCurrently...</a></li>
		<li><a href="#blog_161041">ognl.MethodFailedException 异常</a></li>
		<li><a href="#blog_161040">FileUploadBase$SizeLimitExceededException异常</a></li>
		<li><a href="#blog_161039">Could not find property struts.actionMapping st...</a></li>
		<li><a href="#blog_157919">jquery ajax post 回调函数不执行的原因分析和解决办法 </a></li>
		<li><a href="#blog_157080">浅谈数据库设计技巧(下)(转)</a></li>
		<li><a href="#blog_157079">浅谈数据库设计技巧(上)（转）</a></li>
	  </ol>
  <div class='blogList'>
        <div class='blog'>
      <h2><a href="#top" class='top'>回到顶部</a><a name="blog_780889" href="https://my.oschina.net/u/225084/blog/780889">JD面试Pass的挫败感</a></h2>
	  <div class='outline'>
	  <div class='date'>时间：2016-11-03 21:12:08</div>
	  <div class='catalog'>分类：日常记录</div>
	  	  	  	  	  </div>
      <div class='content'><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;好久没有写东西，现在自己脑子的思绪也乱乱的。</p>

<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;今天2016-11-3，天气雾霾，气温2-13度，心情就像这北京的雾霾天一样，有一种抑郁、压抑和挫败感。好久没有出去面试了，在sinosoft一干，转念已有三年多了，从刚出茅庐的小子，到激情燃烧的程序员，再到已有些懒惰的项目经理。最近部门的一些人和事，迫使我有了“世界这么大，我想去看看”的念头。回头看看脚下走过的路，仰望天空，脑海中闪过刚出大学校门时年给自己定下的五年计划，好像离当时的目标还有好远。或许再待在这里无法满足对技术、money、事业的向往。</p>

<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; 来JD面试，是刚刚向外面世界迈出的第一小步，就有了危机感和挫败感。在想，这个步迈出的是不是有些晚了，看来以后每年都让自己出去多面试，肯定是有必要的，一来熟悉行情，二来看看外面世界很多彩。</p>

<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;面试的职位是JAVA中级开发攻城狮，在去之前对自己还信心满满的，干了这么久，middle level应该不成问题，但是通过这笔试和面试下来，很多技能都退化了。接下的两个月fighting吧！！！</p>

<p>&nbsp; &nbsp; &nbsp; &nbsp; 之前的一年之今一直是在给别人面试，今天再次坐到面试官的对面，说实话这个感觉不太好啊。之前给面试者提的问题大多没有具体答案的问题，在我看来那些固定答案的基础题，只要事先准备好多背一些题，根本看不出来什么能力。但是今天的面试却问了好多基础题，着实答不上来啊！看来以后必需大补了。</p>

<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; 1、hashTable 和 hashMap那个是线程安全的？ &nbsp;我给说反了</p>

<p>&nbsp; &nbsp; &nbsp; &nbsp; 2、分布式事务有接触过吗？ &nbsp; 事务我知道，分布式完全不知啊，只好厚着脸说我们的业务不需要这个，所以不清楚。</p>

<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; 3、重新和复写，是怎么回事？ &nbsp; 完全懵逼，这个最基础的，竟然搞不清是咋回事了，用到是会用，啥区别来着，啊啊……打脸吧。</p>

<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; 4、什么情况下才会走索引，什么情况下不走索引？</p>

<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; 5、SQL查询优化一般都如何做？ &nbsp; 别用or，用and；别用in，用exist；根据条件创建索引，where中条件是索引的，放在条件的最前面，再不行就做个数据库重组。</p>

<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; 6、springMVC有特性？&nbsp;</p>

<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; 7、jQuery中的post是异步的还是同步的？ &nbsp; 不都是异步的吗？难道还能同步，是的能，啊……回去我在学习一下接口文档吧。</p>

<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; 8、常用那些设计模式，说一下使用场景？ &nbsp; 我们也就用个单例，在某个项目多线程中使用过。</p>

<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; ……</p>

<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; 现在真的有点迷了，这一年多时间重点放在带项目上了，好久没有写代码了。带项目也刚刚起步，带这些项目经验到下一家认可吗？技术又退化了这么多，现在不少新技术（例如：mybatis、redis、dubbo、elasticsearch……）现在又不会。</p>

<p>&nbsp; &nbsp; &nbsp; &nbsp; 3年的sinosoft经历，好像并未给简历添彩，眼下脚下的路要怎么走呢？要给自己定一个什么样的岗位呢？是重回开发路，还是沿着现在的项目管理走。现在自己的感觉就是老人常说的那句话，“低不成，高不就”。</p>

<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;还望高人指点一二。</p>
</div>
	  	  <div class='commentList'>
		<h3>评论列表</h3>
	    	    <div class='comment'>
		  <div class='author'>勇往向前</div>
		  <div class='date'>2017-01-02 23:14:18</div>
		  <div class='content'>说实话，有几个问题确实很基础，不应该搭错。加油吧<br/> </div>
		</div>
			    <div class='comment'>
		  <div class='author'>书铭</div>
		  <div class='date'>2017-05-18 16:45:12</div>
		  <div class='content'>如果想做技术就一直做下去，三年的技术开发，转管理早了点，增加广度和深度，另外就是确定一个领域和方向。加油</div>
		</div>
			  </div>
	      </div>
        <div class='blog'>
      <h2><a href="#top" class='top'>回到顶部</a><a name="blog_282158" href="https://my.oschina.net/u/225084/blog/282158">技术人员，请注意那些被你忽略的重要事情 [转载]</a></h2>
	  <div class='outline'>
	  <div class='date'>时间：2014-06-19 19:49:52</div>
	  <div class='catalog'>分类：转贴的文章</div>
	  	  	  <div class='tags'>标签：技术,IT</div>	  	  <div class='url'>http://yanyangtian.blog.51cto.com/2310974/1427234</div>	  	  </div>
      <div class='content'><p><span style="font-family: &quot;微软雅黑&quot;, &quot;Microsoft YaHei&quot;; font-size: 16px;"><span style="line-height: 0px; font-size: 16px;"></span>对于很多做技术的朋友，包括我自己在内，一直以为：只要技术牛，就可以活的非常滋润；只要技术牛，就可以拿优厚的待遇；只要技术牛，就可以拉着几个小伙伴搞自己的“事业”；只要技术牛，就可以驰骋IT江湖。</span></p> 
<p><span style="font-family: &quot;微软雅黑&quot;, &quot;Microsoft YaHei&quot;; font-size: 16px;"></span>&nbsp;</p> 
<p><span style="font-family: &quot;微软雅黑&quot;, &quot;Microsoft YaHei&quot;; font-size: 16px;">很多的事情，或许是我们预期太高，期望太美好，或者就是我们自己一厢情愿的“意淫”。因为我们总是“这山望着那山好，只要到了山顶，一切就会不一样”。其实事情不是这样的。</span></p> 
<p><span style="font-family: &quot;微软雅黑&quot;, &quot;Microsoft YaHei&quot;; font-size: 16px;">说教无益，下面就说下自己的一些经历和感受，希望对大家有用，如果冒犯，请一笑了之。</span></p> 
<p><span style="font-family: &quot;微软雅黑&quot;, &quot;Microsoft YaHei&quot;; font-size: 16px;">&nbsp;</span></p> 
<p><span style="font-family: &quot;微软雅黑&quot;, &quot;Microsoft YaHei&quot;; font-size: 16px;"><strong>技术重要，软实力更加重要</strong></span></p> 
<p>&nbsp;</p> 
<p><span style="font-family: &quot;微软雅黑&quot;, &quot;Microsoft YaHei&quot;; font-size: 16px;"><strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </strong>说到这里，大家心里会有很多的嘀咕：作为我们搞技术的，技术就是生命，技术就是立身之本，技术就是饭碗，你说技术不重要，唬谁呢！</span></p> 
<p>&nbsp;</p> 
<p><span style="font-family: &quot;微软雅黑&quot;, &quot;Microsoft YaHei&quot;; font-size: 16px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 其实说到了软实力，就是我们本身最人性的东西，例如，性格，品性，做人态度，做事风格，解决问题的思维方式，看待事务的角度….</span></p> 
<p>&nbsp;</p> 
<p><span style="font-family: &quot;微软雅黑&quot;, &quot;Microsoft YaHei&quot;; font-size: 16px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 很多人可以凭着热情，兴趣，把技术做到很厉害，甚至达到顶峰，但是，我们发现一点：到最后，做成了事的，一定不是因为他仅仅只有强悍的技术能力。</span></p> 
<p>&nbsp;</p> 
<p><span style="font-family: &quot;微软雅黑&quot;, &quot;Microsoft YaHei&quot;; font-size: 16px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 换句话说，对于我们很多人员，我们如果拼命的努力，顽强的学习，很多人都可以成为高手，牛人。但是，在技术层面上，其实是可以被人超越的，但是，你的思维，人性方面的东西，别人无法Copy，也很难超越。我们终有一天，会遇到“长江后浪推前浪”的局面，我们拿什么来和后辈竞争。</span></p> 
<p><span style="font-family: &quot;微软雅黑&quot;, &quot;Microsoft YaHei&quot;; font-size: 16px;"></span>&nbsp;</p> 
<p><span style="font-family: &quot;微软雅黑&quot;, &quot;Microsoft YaHei&quot;; font-size: 16px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 常常和一些公司的朋友在一起聊，大家都发现很多的技术人员到了一定的程度就上不去了，尽管技术在不断的深化，但是待遇和职位就是停在那里不动。不是每个公司都像阿里，腾讯这样，会给技术人员足够的空间去发展，提升。</span></p> 
<p>&nbsp;</p> 
<p><span style="font-family: &quot;微软雅黑&quot;, &quot;Microsoft YaHei&quot;; font-size: 16px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 有个朋友，做技术也不错，做了多年的架构师，而且主要是偏重在技术上面。后来去一个公司面试技术总监，而老板是市场出身，是一个完全不懂技术人。在面试过程中，老板肯定丝毫没有提到技术的问题，而提出的都是关于做事方式，思维方式，和解决问题的思路，还有一些个人经历、性格方面的问题，尽管这个朋友从来没有真正做过管理职位，尽管这个朋友从来没有带过几十人的团队，但是老板当时就拍板录用。除了说明老板的魄力之外，我们也可以看到“对于高层人员而已，软实力很重要”。</span></p> 
<p>&nbsp;</p> 
<p><span style="font-family: &quot;微软雅黑&quot;, &quot;Microsoft YaHei&quot;; font-size: 16px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 当一堆技术能力相当，背景差不多的人在一起竞争一个位置的时候，最后决定成败的就是“软实力”，人性方面的因素，所以，阿里在选择一个不懂技术的王坚，最后把阿里云搞上去。甚至有时候，在选择人员上，软实力会比技术能力更加重要，这也为什么很多公司会选择：“这个人虽然能力不强，但是很上进，我们更愿意要他”。</span></p> 
<p><span style="font-family: &quot;微软雅黑&quot;, &quot;Microsoft YaHei&quot;; font-size: 16px;">&nbsp;</span></p> 
<p><span style="font-family: &quot;微软雅黑&quot;, &quot;Microsoft YaHei&quot;; font-size: 16px;"><strong>不要以“技术人员都很宅为理由”</strong></span></p> 
<p>&nbsp;</p> 
<p><span style="font-family: &quot;微软雅黑&quot;, &quot;Microsoft YaHei&quot;; font-size: 16px;"><strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </strong>每次让技术人员做一些“出众”的事情的时候，很多的人总是躲躲闪闪，要么是上不了台，要么就是上台之后哆哆嗦嗦，要么就是呆在那里….</span></p> 
<p>&nbsp;</p> 
<p><span style="font-family: &quot;微软雅黑&quot;, &quot;Microsoft YaHei&quot;; font-size: 16px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 一直以来，很多人都说“搞技术的都很宅”，所以每次看到技术人员闷不吭声，每次看到技术人员沉默寡言的时候，我们都“容忍”了。同时，我们做技术的也认同了这个“公理”，在心里把我们自己禁锢，给自己找了一个“公认”的借口不去和别人接触，不主动的去与人沟通，不积极的出去露面。</span></p> 
<p>&nbsp;</p> 
<p><span style="font-family: &quot;微软雅黑&quot;, &quot;Microsoft YaHei&quot;; font-size: 16px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 我们很多的人都对那些技术大会上面的大牛演讲者羡慕不已，都希望自己有朝一日可以也可以站在台上面意气风发，也希望自己被万众瞩目。后来，我陆陆续续的也有幸的接触到了一些这些大会的讲师，其实很多时候，他们也是被“逼着”上去的，都是硬着上了。而且在演讲之前，已经提前几个月在家里反反复复的练习了很多遍。每次我们看到只是别人的光环，却没有关注背后的辛酸。</span></p> 
<p>&nbsp;</p> 
<p><span style="font-family: &quot;微软雅黑&quot;, &quot;Microsoft YaHei&quot;; font-size: 16px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 对于技术，有个朋友说的非常好：你自己懂，不算真的懂；你自己懂，要写出了让别人；也懂，你自己懂，要讲出来让别人懂。这才说明你真的懂了。</span></p> 
<p>&nbsp;</p> 
<p><span style="font-family: &quot;微软雅黑&quot;, &quot;Microsoft YaHei&quot;; font-size: 16px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 我们很多人做技术的时候，喜欢把知识“焖“在心中，从来不吐露出来。在现在，技术人员是要”勇于发声“的。</span></p> 
<p><span style="font-family: &quot;微软雅黑&quot;, &quot;Microsoft YaHei&quot;; font-size: 16px;"></span>&nbsp;</p> 
<p><span style="font-family: &quot;微软雅黑&quot;, &quot;Microsoft YaHei&quot;; font-size: 16px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 如果说80%的技术人员都是“宅”的，如果你不“宅”，你发声了，起码你就在某种程度上面超过了他们。</span></p> 
<p>&nbsp;</p> 
<p><span style="font-family: &quot;微软雅黑&quot;, &quot;Microsoft YaHei&quot;; font-size: 16px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 今天就暂时到这里，写博很难，IT不易，且看且珍惜。</span></p> 
<p><br /></p></div>
	      </div>
        <div class='blog'>
      <h2><a href="#top" class='top'>回到顶部</a><a name="blog_223777" href="https://my.oschina.net/u/225084/blog/223777">分享免费教学视频网站</a></h2>
	  <div class='outline'>
	  <div class='date'>时间：2014-04-18 12:46:41</div>
	  <div class='catalog'>分类：日常记录</div>
	  	  	  <div class='tags'>标签：免费,教学视频</div>	  	  	  </div>
      <div class='content'><p>昨天在研究单点登录的时候，偶然发现一个不错的免费分享教学视频网站。这么好的东东当然不能独自分享了，下边是网址感兴趣的童鞋可以去看看，或会会有收获哦！ ^ _ ^<br /></p> 
<p>http://www.boobooke.com/</p></div>
	      </div>
        <div class='blog'>
      <h2><a href="#top" class='top'>回到顶部</a><a name="blog_215668" href="https://my.oschina.net/u/225084/blog/215668">Kettle 学习知识总结(一)</a></h2>
	  <div class='outline'>
	  <div class='date'>时间：2014-04-03 08:37:09</div>
	  <div class='catalog'>分类：Kettle</div>
	  	  	  <div class='tags'>标签：kettle,注意事项</div>	  	  	  </div>
      <div class='content'><p><span style="font-family:宋体">【基础知识】</span></p> 
<p>Kettle <span style="font-family: 宋体">分为两部分</span>Job<span style="font-family:宋体">（作业）</span> <span style="font-family: 宋体">和</span>Transaction<span style="font-family:宋体">（转换）</span></p> 
<ul> 
 <li><p>Job <span style="font-family:宋体">的执行可以通过</span>kitten <span style="font-family:宋体">组件</span></p></li> 
 <li><p>Transaction<span style="font-family:宋体">的执行可以通过</span>pan <span style="font-family:宋体">组件</span></p></li> 
</ul> 
<p>&nbsp;</p> 
<p><span style="font-family:宋体">输入组件中是将所有查询后获取到的数据全部转给下一个节点使用，而不是一条数据执行到尾节点后，在从新执行下一条数据。</span></p> 
<p><br /></p> 
<p><span style="font-family:宋体">数据有两种发送形式：</span></p> 
<p><span style="font-family:宋体">分发：从数据源依次发送到下一个节点</span></p> 
<p><span style="font-family:宋体">复制：将数据源的所有结果全部发送到下一个节点</span></p> 
<p><span style="font-family:宋体"><br /></span></p> 
<p><strong><span style="font-family:宋体">【注意事项】</span></strong></p> 
<p>1、<span style="font:9px 'Times New Roman'">&nbsp; </span>Kettle<span style="font-family:宋体">中时间查询使用的格式为</span>yyyy/MM/dd HH:mm:ss<span style="font-family:宋体">。但是在</span>db2<span style="font-family:宋体">中查询条件中使用的时间格式是</span>yyyy-MM-dd HH:mm:ss<span style="font-family:宋体">，所以在</span>SQL<span style="font-family:宋体">语句中的查询条件必须统一格式为“</span>yyyy-MM-dd HH:mm:ss<span style="font-family:宋体">”。这样才能正确查询。</span></p> 
<p>&nbsp;</p> 
<p>2、<span style="font:9px 'Times New Roman'">&nbsp; </span><span style="font-family:宋体">在</span>SQL<span style="font-family:宋体">语句中时间参数必须使用单引号或者双引号括起来，否则</span>SQL<span style="font-family:宋体">语法正确。</span></p> 
<p>&nbsp;</p> 
<p>3、<span style="font:9px 'Times New Roman'">&nbsp; </span><span style="font-family:宋体">在生成错误文件时，如果不想每次执行都创建一个文件，需要把“</span>Don not create file at start <span style="font-family:宋体">”复选框勾上，这样就不会每次执行都生成文件了。</span></p> 
<p><img src="http://static.oschina.net/uploads/space/2014/0403/083412_CRcA_225084.jpg" /></p> 
<p>4、<span style="font:9px 'Times New Roman'">&nbsp; </span><span style="font-family:宋体">对于在</span>kettle<span style="font-family:宋体">中使用</span>set variables<span style="font-family:宋体">设置的参数，使<strong>不能</strong>在</span>javaScript<span style="font-family:宋体">中调用的。</span></p> 
<p>&nbsp;</p> 
<p>5、<span style="font:9px 'Times New Roman'">&nbsp; </span><span style="font-family:宋体">如果想要让执行改变为并行，使用“</span>Launch next entires in parallel<span style="font-family:宋体">”后边的整个执行过程为并行方式。</span></p> 
<p><img src="http://static.oschina.net/uploads/space/2014/0403/083517_qJap_225084.jpg" /></p> 
<p><span style="font-family:宋体">改为并向后</span>kettle<span style="font-family:宋体">图形界面显示如下</span></p> 
<p><img src="http://static.oschina.net/uploads/space/2014/0403/083606_1rzz_225084.jpg" /></p></div>
	      </div>
        <div class='blog'>
      <h2><a href="#top" class='top'>回到顶部</a><a name="blog_208809" href="https://my.oschina.net/u/225084/blog/208809">Hibernate查询返回list对象分析学习</a></h2>
	  <div class='outline'>
	  <div class='date'>时间：2014-03-17 09:58:35</div>
	  <div class='catalog'>分类：web开发</div>
	  	  	  <div class='tags'>标签：Hibernate,List,query,查询</div>	  	  	  </div>
      <div class='content'><p><span style="font-family:宋体">在一次开发中我需要从</span>Hibernate<span style="font-family:宋体">查询返回</span>List<span style="font-family:宋体">对象中（注：这个</span>list<span style="font-family:宋体">对象并非一个完整的</span>model<span style="font-family:宋体">类，而是多表查询拼凑的一些字段），取出部分数据在做一次筛选操作。但</span>list<span style="font-family:宋体">只是一个接口类，并没有具体指明什么类型，所以我们不能轻松的获取到每个</span>list<span style="font-family:宋体">中对象。</span></p> 
<p><span style="font-family:宋体">于是使用</span>debug<span style="font-family:宋体">模式，我想查看一下这返回的</span>list<span style="font-family:宋体">具体是什么类生成的。通过下图我们可以明显的看出这个</span>list<span style="font-family:宋体">使用对象数组类</span>new<span style="font-family:宋体">出来的。</span></p> 
<pre class="brush:java;toolbar: true; auto-links: false;">List&lt;Object[]&gt;&nbsp;list&nbsp;=&nbsp;new&nbsp;ArrayList&lt;Object[]&gt;();</pre> 
<p></p> 
<p><span style="font-size:13px;font-family: 'Courier New';color:#3F7F5F"></span><br /></p> 
<p><img src="http://static.oschina.net/uploads/space/2014/0317/095252_TVhs_225084.png" /></p> 
<p><span style="font-family:宋体">知道具体的生成类型，我们就可以单独取出每个</span>list<span style="font-family:宋体">中的对象，并根据对象中一些属性的值进行其他判断操作。</span></p> 
<p><span style="font-family:宋体">如下是简单的实例代码：</span></p> 
<pre class="brush:java;toolbar: true; auto-links: false;">hql.append(“SELECT&nbsp;A1.a,&nbsp;A1.b,COUNT(B1.c)&nbsp;FROM&nbsp;AAA&nbsp;A1,&nbsp;BBB&nbsp;B1”);
List&lt;Object[]&gt;&nbsp;queryList&nbsp;=&nbsp;acceptVehiclesService.findBysql(hql.toString());
Object[]&nbsp;obj&nbsp;=&nbsp;null;
for&nbsp;(int&nbsp;i&nbsp;=&nbsp;queryList.size()-1;&nbsp;i&nbsp;&gt;=&nbsp;0;&nbsp;i--)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;obj&nbsp;=&nbsp;queryList.get(i);
&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;tmp&nbsp;=&nbsp;obj[0].toString();
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(tmp.length()&nbsp;!=&nbsp;15&nbsp;&amp;&amp;&nbsp;tmp.length()&nbsp;!=&nbsp;18)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;queryList.remove(i);
&nbsp;&nbsp;&nbsp;&nbsp;}
}</pre> 
<p></p> 
<p><span style="font-size:13px;font-family:'Courier New';color:black"></span></p> 
<p><span style="font-family:宋体">【</span>Ps<span style="font-family:宋体">补充一个技巧】</span></p> 
<p><span style="font-family:宋体">对于</span>list<span style="font-family:宋体">中的</span>removed<span style="font-family:宋体">操作，</span>List<span style="font-family:宋体">每</span>remove<span style="font-family:宋体">掉一个元素以后，后面的元素都会向前移动，此时如果执行</span>i=i+1<span style="font-family:宋体">，则刚刚移过来的元素没有被读取。在网上搜了一下大概有三种方法解决这个问题。</span></p> 
<p>1.<span style="font-family:宋体">倒过来遍历</span>list<span style="font-family:宋体">（个人比较喜欢这种）</span></p> 
<pre class="brush:java;toolbar: true; auto-links: false;">for&nbsp;(int&nbsp;i&nbsp;=&nbsp;list.size()-1;&nbsp;i&nbsp;&gt;&nbsp;=0;&nbsp;i--)&nbsp;{
　　if&nbsp;(((String)&nbsp;list.get(i)).startsWith(&quot;abcde&quot;))&nbsp;{
　　&nbsp;list.remove(i);
　　}
}</pre> 
<p></p> 
<p>&nbsp;</p> 
<p>2.<span style="font-family:宋体">每移除一个元素以后再把</span>i<span style="font-family:宋体">移回来</span></p> 
<pre class="brush:java;toolbar: true; auto-links: false;">for&nbsp;(int&nbsp;i&nbsp;=&nbsp;0;&nbsp;i&nbsp;&lt;&nbsp;list.size();&nbsp;i++)&nbsp;{
　　if&nbsp;(((String)&nbsp;list.get(i)).startsWith(&quot;abcde&quot;))&nbsp;{
　　&nbsp;list.remove(i);
　　&nbsp;i=i-1;
　　}
}</pre> 
<p></p> 
<p>&nbsp;</p> 
<p>3.<span style="font-family:宋体">使用</span>iterator.remove()<span style="font-family:宋体">方法删除</span> </p> 
<pre class="brush:java;toolbar: true; auto-links: false;">for&nbsp;(Iterator&nbsp;it&nbsp;=&nbsp;list.iterator();&nbsp;it.hasNext();)&nbsp;{
　　String&nbsp;str&nbsp;=&nbsp;(String)it.next();
　　if&nbsp;(str.equals(&quot;chengang&quot;)){
　　&nbsp;it.remove();
　　}
}</pre> 
<p></p> 
<p><br /></p></div>
	      </div>
        <div class='blog'>
      <h2><a href="#top" class='top'>回到顶部</a><a name="blog_179882" href="https://my.oschina.net/u/225084/blog/179882">使用IE"F12开发人员工具"调试Js错误</a></h2>
	  <div class='outline'>
	  <div class='date'>时间：2013-11-28 17:41:34</div>
	  <div class='catalog'>分类：web开发</div>
	  	  	  <div class='tags'>标签：IE,js调试工具</div>	  	  	  </div>
      <div class='content'><p>最近发现IE的自带的js调试工具也停好用了，简单记录下使用方法，以供大家参考。</p> 
<p>1）Internet选项——高级 去掉“显示友好Http错误信息” <img src="http://static.oschina.net/uploads/space/2013/1128/173756_eheJ_225084.jpg" alt="在此输入图片描述"></p> 
<p>去掉“禁用脚本调试（Internet Explorer）” <img src="http://static.oschina.net/uploads/space/2013/1128/173831_WcZr_225084.jpg" alt="在此输入图片描述"></p> 
<p>2）启动F12开发人员工具——选择“脚本”标签——首先设置“错误时中断”和“格式化JS脚本”——启动调试 <img src="http://static.oschina.net/uploads/space/2013/1128/174007_Sor8_225084.jpg" alt="在此输入图片描述"></p> 
<p>3）点击运行IE界面中的成，这样程序运行到错误代码处，就会中断运行。这样就可以调试程序。程序运行前还可以点左侧行号设置断点。 <img src="http://static.oschina.net/uploads/space/2013/1128/174102_nEWJ_225084.jpg" alt="在此输入图片描述"></p> 
<ol> 
 <li>点击右侧的“监视”可以像C++那样监视系统中的变量，也可以通过“局部变量”产看代码中的声明的变量。</li> 
</ol> 
<p>【ps】对于IE版本问题，我印象中是IE6以上都应该有这个调试功能。如有不对请拍砖。</p></div>
	  	  <div class='commentList'>
		<h3>评论列表</h3>
	    	    <div class='comment'>
		  <div class='author'>开源无憾</div>
		  <div class='date'>2013-11-28 19:44:26</div>
		  <div class='content'>哪个版本的IE？ </div>
		</div>
			    <div class='comment'>
		  <div class='author'>gerry_pang</div>
		  <div class='date'>2013-12-02 08:32:54</div>
		  <div class='content'><div class=ref><h4>引用来自“开源码农”的评论</h4><p>哪个版本的IE？ </p></div>哦，哦， 忘记说明版本了，IE 9</div>
		</div>
			  </div>
	      </div>
        <div class='blog'>
      <h2><a href="#top" class='top'>回到顶部</a><a name="blog_178266" href="https://my.oschina.net/u/225084/blog/178266">解决MySql数据库连接超时问题</a></h2>
	  <div class='outline'>
	  <div class='date'>时间：2013-11-22 13:15:03</div>
	  <div class='catalog'>分类：常见异常</div>
	  	  	  <div class='tags'>标签：mysql,timeout,超时</div>	  	  	  </div>
      <div class='content'><p>在Mysql的默认设置中，如果一个数据库连接超过8小时没有使用（闲置8小时，即28800s），mysql server将主动断开这条连接。 <img src="http://static.oschina.net/uploads/space/2013/1122/131123_xhGh_225084.jpg" alt="在此输入图片描述"></p> 
<p>在运维监控系统中，程序会报如下异常：</p> 
<pre><code>&lt;!-- lang: java --&gt;
org.springframework.orm.hibernate3.HibernateJdbcException: JDBC exception on     Hibernate data access; nested exception is org.hibernate.exception.GenericJDBCException: could not inspect JDBC autocommit mode
</code></pre> 
<p>底层错误日志：</p> 
<pre><code>&lt;!-- lang: java --&gt;
    [130925-102435-381][ERROR][ActionQueue:afterTransactionCompletion 179]could not release a cache lock
org.hibernate.cache.CacheException: java.lang.IllegalStateException: The org.hibernate.cache.UpdateTimestampsCache Cache is not alive.
	at org.hibernate.cache.EhCache.put(EhCache.java:125)
	at org.hibernate.cache.UpdateTimestampsCache.invalidate(UpdateTimestampsCache.java:69)
	at org.hibernate.engine.ActionQueue.afterTransactionCompletion(ActionQueue.java:174)
	at org.hibernate.impl.SessionImpl.afterTransactionCompletion(SessionImpl.java:424)
	at org.hibernate.jdbc.JDBCContext.afterTransactionCompletion(JDBCContext.java:225)
	at org.hibernate.transaction.JDBCTransaction.rollback(JDBCTransaction.java:174)
	at org.springframework.orm.hibernate3.HibernateTransactionManager.doRollback(HibernateTransactionManager.java:577)
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.processRollback(AbstractPlatformTransactionManager.java:631)
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.rollback(AbstractPlatformTransactionManager.java:608)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.completeTransactionAfterThrowing(TransactionAspectSupport.java:328)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:111)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:185)
	at org.springframework.aop.framework.Cglib2AopProxy$DynamicAdvisedInterceptor.intercept(Cglib2AopProxy.java:652)
	at com.sinosoft.sepmis.inspection.service.InspectionDataServiceImpl$$EnhancerByCGLIB$$d9f54f39.saveInspectionData(&lt;generated&gt;)
	at com.sinosoft.sepmis.util.ConnectionTelnet.execute(ConnectionTelnet.java:319)
	at com.sinosoft.sepmis.util.InspectionUtil.inspectExecute(InspectionUtil.java:331)
	at com.sinosoft.sepmis.util.InspectionUtil.partOfManual(InspectionUtil.java:259)
	at com.sinosoft.sepmis.util.ThreadManageUtil.startInspect(ThreadManageUtil.java:45)
	at com.sinosoft.sepmis.util.ThreadManageUtil.run(ThreadManageUtil.java:31)
	at java.lang.Thread.run(Thread.java:735)
Caused by: 
java.lang.IllegalStateException: The org.hibernate.cache.UpdateTimestampsCache Cache is not alive.
	at net.sf.ehcache.Cache.checkStatus(Cache.java:1204)
	at net.sf.ehcache.Cache.put(Cache.java:549)
	at net.sf.ehcache.Cache.put(Cache.java:522)
	at org.hibernate.cache.EhCache.put(EhCache.java:119)
	... 19 more
</code></pre> 
<p><strong>原因分析：</strong></p> 
<p>由于程序后台一直在运行定时程序，而且定时程序的运行为7*24小时。在这期间程序会出现八小时闲置的情况，即程序和数据库之间没有任何交换操作。这样Mysql数据库端会主动动断开连接。这样如果定时启动后，要想获取到Mysql的连接，自然就会报出异常。</p> 
<p>方法一，Mysql数据库延长wait_timeout参数时间（不推荐）：</p> 
<p>通过修改my.ini(Linux系统为my.cnf)文件中wait_timeout=xxx，即便是这样系统在闲着超过此参数设置时间后依然会出现异常。（注意：此参数单位为秒） 也可以通过mysql命令设置。</p> 
<pre><code>&lt;!-- lang: sql --&gt;
Mysql &gt; set global wait_timeout=xxx;
</code></pre> 
<p>设置后重启mysql服务，命令如下： &lt;!-- lang: sql --&gt; service mysql restart 登录mysql查看是否生效： &lt;!-- lang: sql --&gt; Mysql &gt; show global variables like 'wait_timeout'; <img src="http://static.oschina.net/uploads/space/2013/1122/131914_pjK8_225084.jpg" alt="在此输入图片描述"></p> 
<p>方法二，修改hibernate 中配置属性（不推荐）：</p> 
<p>代码如下</p> 
<pre><code>&lt;!-- lang: xml --&gt;
&lt;property name="connection.autoReconnect"&gt;true&lt;/ property&gt;
&lt;property name="connection.autoReconnectForPools"&gt;true&lt;/ property &gt;
&lt;property name="connection.is-connection-validation-required"&gt;true&lt;/ property&gt;
</code></pre> 
<p>个人通过试验发现，这种方法并没有起到效果。不知道网上的写文章的人是怎么解决的。</p> 
<p>方法三，使用第三方数据库连接池（推荐）： 现在第三方数据库连接池使用较多的为c3p0，proxool等，在性能上c3p0稍好一些，原因c3p0数据库连接池，底层有一个定时查看数据库连接是否有效的参数。而且Hibernate的api中也推荐使用第三方数据库连接池，因为Hibernate本身的数据库连接池过于简单、本身存在bug。c3p0参数配置如下：</p> 
<pre><code>&lt;!-- lang: xml --&gt;
&lt;!-- 数据源 --&gt; 
&lt;bean id="dataSourceTarget" class="com.mchange.v2.c3p0.ComboPooledDataSource" &gt;
&lt;property name="user" value="root" /&gt;
&lt;property name="password" value="root" /&gt;
&lt;property name="jdbcUrl" value="jdbc:mysql://192.168.61.208:3306/sinoomv1_0_0" /&gt;
&lt;property name="driverClass" value="com.mysql.jdbc.Driver" /&gt;
&lt;!-- 系统初始化连接数 --&gt;
&lt;property name="initialPoolSize" value="10" /&gt;
&lt;!-- 最大连接数 --&gt;
&lt;property name="maxPoolSize" value="30" /&gt;
&lt;!-- 最小连接数 --&gt;
&lt;property name="minPoolSize" value="10" /&gt;
&lt;!--最大空闲时间,600秒（10分钟）内未使用则连接被丢弃。若为0则永不丢弃。Default: 0 --&gt;
&lt;property name="maxIdleTime" value="600" /&gt;
&lt;!--当连接池中的连接耗尽的时候c3p0一次同时获取的连接数。Default: 3 --&gt;  
&lt;property name="acquireIncrement" value="3" /&gt;
&lt;!--每60秒检查所有连接池中的空闲连接。Default: 0 --&gt;  
&lt;property name="idleConnectionTestPeriod" value="60" /&gt;
&lt;!-- 每次从pool内checkout连接时测试有效性（同步操作）
    程序每次数据库调用都连接有效性，若无效关闭此连接并剔除出pool，
   从pool内取其他连接，慎用，会造成至少多一倍的数据库调用。Default：false --&gt;
&lt;property name="testConnectionOnCheckout" value="false" /&gt;
&lt;!--定义在从数据库获取新连接失败后重复尝试的次数。Default: 30 --&gt;
&lt;property name="acquireRetryAttempts" value="30"/&gt;
&lt;!--两次连接中间隔时间，单位毫秒。Default: 1000 --&gt;
&lt;property name="acquireRetryDelay" value="1000"/&gt;
&lt;/bean&gt;
</code></pre> 
<p>查看mysql数据库连接池情况，命令如下：</p> 
<pre><code>&lt;!-- lang: sql --&gt;
Mysql&gt; show processlist;
</code></pre> 
<p><img src="http://static.oschina.net/uploads/space/2013/1122/132235_nx7H_225084.jpg" alt="在此输入图片描述"></p> 
<p>ps：最近在在停起程序的时候我发现了一个问题，就算是我停止了服务，但是程序和mysql数据库之间的连接数依然没有断开，后来经查资料和同事请教，我发现在上边的c3p0配置存在一个小bug。因为我将c3p0交给Spring进行管理，但是在上边注入的bean中没有加上destroy-method="close"这个属性。 也就是说Spring是不能正常销毁连接的，由此出现了我说的问题。</p> 
<p>写在这里以供大家警示，真是马虎啊，竟然忘记了销毁，实在不应该。</p> 
<pre><code>&lt;!-- lang: xml --&gt;
&lt;!-- 数据源 --&gt; 
&lt;bean id="dataSourceTarget" class="com.mchange.v2.c3p0.ComboPooledDataSource" destroy-method="close"&gt;
 ... ...
&lt;/bean&gt;
</code></pre> 
<p>参考文章：</p> 
<p>Hibernate API 文档 <a href="http://blog.csdn.net/nethibernate/article/details/6658855" rel="nofollow">http://blog.csdn.net/nethibernate/article/details/6658855</a> <a href="http://zhidao.baidu.com/question/96746075.html" rel="nofollow">http://zhidao.baidu.com/question/96746075.html</a></p></div>
	      </div>
        <div class='blog'>
      <h2><a href="#top" class='top'>回到顶部</a><a name="blog_167842" href="https://my.oschina.net/u/225084/blog/167842">spring getbean 方法分析</a></h2>
	  <div class='outline'>
	  <div class='date'>时间：2013-10-10 23:28:57</div>
	  <div class='catalog'>分类：web开发</div>
	  	  	  <div class='tags'>标签：spring,getBean,注入Bean</div>	  	  	  </div>
      <div class='content'><p>在最近的项目中，有个地方我们不得不实用getBean的方法，自己从Spring context中获取bean进行数据库操作。</p> 
<p>方法一（效率低，极易出现bug，不推荐使用）：</p> 
<p>刚刚开始的时候，我们使用这中方式，但是在应用过程中发现此方式效率低下，而且极易出现bug。 在我们系统中会生成ehcache_auto_created_时间戳文件夹，</p> 
<pre><code>&lt;!-- lang: java --&gt;
String[] xmlCfg = new String[] {"classpath:/spring/applicationContext-service.xml",
			"classpath:/spring/applicationContext-util.xml",
			"classpath:/spring/applicationContext.xml"}; 
ApplicationContext context  = new FileSystemXmlApplicationContext(xmlCfg);
// 获取inspectionUtil bean
inspectionUtil = (InspectionUtil) context.getBean("inspectionUtil");
</code></pre> 
<p>所以我google了一下，改用其他方法。</p> 
<p>方法二（效率高，灵活性高，可复用，推荐使用）： 创建一个工具类SpringContextsUtil ，通过实现Spring中的ApplicationContextAware接口，在applicationContext.xml中注入bean后Spring会自动调用setApplicationContext方法。此时我们就可以获取到Spring context。</p> 
<pre><code>&lt;!-- lang: java --&gt;
public class SpringContextsUtil implements ApplicationContextAware{

private static ApplicationContext applicationContext;    //Spring应用上下文环境   
  /**
  * 实现ApplicationContextAware接口的回调方法，设置上下文环境  
  * @param applicationContext
  * @throws BeansException
  */
  public void setApplicationContext(ApplicationContext applicationContext) throws BeansException {
    SpringContextsUtil.applicationContext = applicationContext;
  }
 
  /**
  * @return ApplicationContext
  */
  public static ApplicationContext getApplicationContext() {
    return applicationContext;
  }
 
  /**
  * 获取对象  
  * @param name
  * @return Object 一个以所给名字注册的bean的实例
  * @throws BeansException
  */
  public static Object getBean(String name) throws BeansException {
    return applicationContext.getBean(name);
  }
 
  /**
  * 获取类型为requiredType的对象
  * 如果bean不能被类型转换，相应的异常将会被抛出（BeanNotOfRequiredTypeException）
  * @param name       bean注册名
  * @param requiredType 返回对象类型
  * @return Object 返回requiredType类型对象
  * @throws BeansException
  */
  public static Object getBean(String name, Class requiredType) throws BeansException {
    return applicationContext.getBean(name, requiredType);
  }
 
  /**
  * 如果BeanFactory包含一个与所给名称匹配的bean定义，则返回true
  * @param name
  * @return boolean
  */
  public static boolean containsBean(String name) {
    return applicationContext.containsBean(name);
  }
 
  /**
  * 判断以给定名字注册的bean定义是一个singleton还是一个prototype。
  * 如果与给定名字相应的bean定义没有被找到，将会抛出一个异常（NoSuchBeanDefinitionException）  
  * @param name
  * @return boolean
  * @throws NoSuchBeanDefinitionException
  */
  public static boolean isSingleton(String name) throws NoSuchBeanDefinitionException {
    return applicationContext.isSingleton(name);
  }
 
  /**
  * @param name
  * @return Class 注册对象的类型
  * @throws NoSuchBeanDefinitionException
  */
  public static Class getType(String name) throws NoSuchBeanDefinitionException {
    return applicationContext.getType(name);
  }
 
  /**
  * 如果给定的bean名字在bean定义中有别名，则返回这些别名  
  * @param name
  * @return
  * @throws NoSuchBeanDefinitionException
  */
  public static String[] getAliases(String name) throws NoSuchBeanDefinitionException {
    return applicationContext.getAliases(name);
  }
}
</code></pre> 
<p>调用方法：</p> 
<pre><code>&lt;!-- lang: java --&gt;
// 获取inspectionUtil bean
inspectionUtil = (InspectionUtil) SpringContextUtil.getBean("inspectionUtil");
</code></pre> 
<p>注：</p> 
<p>1、使用时会出现无法获取applicationContext，并抛出NullPointerException。 原因：使用此方法必须在spring applicationContext.xml中注入bean。否则spring无法自动调用setApplicationContext。如下</p> 
<pre><code>&lt;!-- lang: xml --&gt;
&lt;bean id="springContextsUtil" class="com.sinosoft.sepmis.util.SpringContextsUtil" &gt;&lt;/bean&gt;
</code></pre> 
<p>2、如果注入后仍然出现这个问题。 则修改&lt;beans default-autowire="byName" default-lazy-init="true"&gt;中的default-lazy-init="false"。 或者是修改bean注入属性</p> 
<pre><code>&lt;!-- lang: xml --&gt;
&lt;bean id="springContextsUtil" class="com.sinosoft.sepmis.util.SpringContextsUtil" lazy-init="false"&gt;&lt;/bean&gt;
</code></pre></div>
	      </div>
        <div class='blog'>
      <h2><a href="#top" class='top'>回到顶部</a><a name="blog_151989" href="https://my.oschina.net/u/225084/blog/151989">quartz无法启动的原因</a></h2>
	  <div class='outline'>
	  <div class='date'>时间：2013-08-11 22:43:01</div>
	  <div class='catalog'>分类：web开发</div>
	  	  	  <div class='tags'>标签：quartz,无法启动</div>	  	  	  </div>
      <div class='content'><p>场景：spring集成quartz，在spring配置文件中配置quartz相关参数。</p> 
<p>在以往的工作中，quartz经常无法启动，今天就根据以前经验，总结一下，供大家参考。</p> 
<ul> 
 <li>原因一：ID冲突</li> 
</ul> 
<p>quartz的两个基本单元是Job和Trigger，它们在内存中分别以jobName+groupName和triggerName+GrupName唯一标识，如果两个job的名字和群组都相同，则必然会有一个job无法启动。</p> 
<ul> 
 <li>原因二：default-lazy-init="true"</li> 
</ul> 
<p>若在spring配置文件中配置了quartz相关参数，则不能够设置default-lazy-init="true",否则定时任务不会触发；若工程有多个spring配置文件，则只需当前配置quartz的文件不设置default-lazy-init="true"即可。</p> 
<ul> 
 <li>原因三：default-autowire="byName"</li> 
</ul> 
<p>若在spring配置文件中配置了quartz相关参数，则不能够设置default-autowire="byName"属性，否则后台会报Table 'database.qrtz_locks' doesn't exist异常，这是因为若使用了autowire，spring集成quartz，会默认使用数据库存储job状态(而不是存储在内存中)，spring会自动将dataSource(hibernate配置的数据库)配置为quartz存储数据库，而我们的数据库中又没有quartz所需的数据表，因此就会报出如上异常；若工程有多个spring配置文件，则只需当前配置quartz的文件不设置default-autowire="byName"即可。</p> 
<ul> 
 <li>原因四： 特别注意一点，与Spring整合必须使用Quartz1.8.x及以下版本</li> 
</ul></div>
	      </div>
        <div class='blog'>
      <h2><a href="#top" class='top'>回到顶部</a><a name="blog_151988" href="https://my.oschina.net/u/225084/blog/151988">使用cronTriggerBean子类,动态设置cronExpression(quartz +...</a></h2>
	  <div class='outline'>
	  <div class='date'>时间：2013-08-11 22:41:52</div>
	  <div class='catalog'>分类：web开发</div>
	  	  	  <div class='tags'>标签：quartz,stpring,cronTriggerBean,dynamic</div>	  	  	  </div>
      <div class='content'><p><strong>Quartz的使用前准备：</strong></p> 
<p>1.引入必要的jar包：</p> 
<ul> 
 <li>quartz_all_xxx.jar 或者quartz_xxx.jar</li> 
 <li>slf4j_api_xx.jar quartz所需要的日志工具</li> 
</ul> 
<p><strong>quartz知识简单了解：</strong> 2.quartz的两种作业存储方式：</p> 
<ul> 
 <li>RAMJobStore,利用内存来持久化调度程序信息</li> 
 <li>JDBC作业存储，利用JDBC驱动和后台库中保存的调度程序信息</li> 
</ul> 
<p>3.Quartz两种触发器</p> 
<ul> 
 <li>simpleTrigger 适合执行简单的调度任务</li> 
 <li>cronTrigger 使用cron表达式，调度相对复杂的任务</li> 
</ul> 
<p>4.quartz调度器—将任务和触发器关联起来。 由scheduler接口体现，该接口主要定义了三个方法：</p> 
<ul> 
 <li>void addJob(JobDetail jobDetail, Boolean replace)</li> 
 <li>Date scheduleJob(JobDetail jobDetail, Trigger trigger) //使用trigger类控制该job</li> 
 <li>Date scheduleJob(Trigger trigger) //添加触发器调度作业</li> 
</ul> 
<p>在spring中使用quartz,创建quartz作业bean的两种方法: 1.使用JobDetailBean包装QuartzBean子类的实例</p> 
<ul> 
 <li>创建一个Quartz的作业bean，但是这个bean必须要继承QuartzJobBean抽象类，其中要实现一个executeInternal（JobExecutionContext ctx）方法。</li> 
</ul> 
<p>2.使用MethodInvokingJobDetailFactoryBean配置方法（如下例Spring-action.xml 配置）</p> 
<p>3.Spring-action.xml 配置内容:</p> 
<pre><code>&lt;!-- lang: xml --&gt;
    &lt;!--quartz demo test start--&gt;
    &lt;!-- 定义要定时工作bean  并将任务工程注入 --&gt;
    &lt;bean id="quarzDemo" class="com.pgw.util.QuarzDemo" &gt;
       &lt;property name="scheduler" ref="schedulerFactory" /&gt;
    &lt;/bean&gt;
   
    &lt;!-- 将testQuarzt注入到job中 --&gt;
    &lt;bean id="testJob" class="org.springframework.scheduling.quartz.MethodInvokingJobDetailFactoryBean"&gt;
       &lt;!-- targetObject 为要定时调用的工作bean --&gt;
        &lt;property name="targetObject" ref="quarzDemo" /&gt;
        &lt;!-- targetMethod 为targetObject中要触发的方法名 --&gt;
        &lt;property name="targetMethod" value="doSomething" /&gt;
    &lt;/bean&gt;
   
    &lt;!-- 将job注入到定时触发器 --&gt;
    &lt;bean id="testTrigger" class="org.springframework.scheduling.quartz.CronTriggerBean"&gt;
       &lt;!-- 上边定义好的job Bean注入到触发器中 --&gt;
       &lt;property name="jobDetail" ref="testJob" /&gt;
       &lt;!-- cron表达式，定义要触发的时间 --&gt;
       &lt;property name="cronExpression"&gt; 
           &lt;value&gt;0 56 10 * * ?&lt;/value&gt;
       &lt;/property&gt;
    &lt;/bean&gt;
 
    &lt;!-- 将触发器注入任务工程 --&gt;
    &lt;bean id="schedulerFactory" class="org.springframework.scheduling.quartz.SchedulerFactoryBean" lazy-init="false"  autowire="no"&gt;
       &lt;property name="triggers"&gt;
           &lt;list&gt;
              &lt;!-- 任务工程中要触发的触发器列表 --&gt;
              &lt;ref local="testTrigger" /&gt;
           &lt;/list&gt;
       &lt;/property&gt;
    &lt;/bean&gt;
   
    &lt;!-- 动态填入cron表单式的界面action bean --&gt;
    &lt;bean id="quartzAction" class="com.pgw.action.QuartzAction"&gt;
       &lt;property name="quarzDemo" ref="quarzDemo"&gt;&lt;/property&gt;
    &lt;/bean&gt;
    &lt;!--quartz demo test end --&gt;
&lt;/beans&gt;
</code></pre> 
<p>QuarzDemo类</p> 
<pre><code>&lt;!-- lang: java --&gt;
 public class QuarzDemo{
     private Scheduler scheduler;
    
     publicvoid doSomething() {
        System.out.println("Hello World !!!");
     }
    
     publicvoid resetJob(String cronExpression){
        try {
             // 运行时可通过动态注入的scheduler得到trigger，
             // 注意采用这种注入方式在有的项目中会有问题，如果遇到注入问题，
             // 可以采取在运行方法时候，获得bean来避免错误发生。
             CronTriggerBean trigger = (CronTriggerBean) scheduler.getTrigger("testTrigger", Scheduler.DEFAULT_GROUP);
             String originConExpression = trigger.getCronExpression();
             // 如果相等，则表示用户并没有重新设定数据库中的任务时间，这种情况不需要重新rescheduleJob
             if (!originConExpression.equalsIgnoreCase(cronExpression)) {
                trigger.setCronExpression(cronExpression);
                scheduler.rescheduleJob("testTrigger", Scheduler.DEFAULT_GROUP, trigger);
             }
                } catch (SchedulerException e) {
             e.printStackTrace();
                } catch (ParseException e) {
             e.printStackTrace();
                }
     }
  
     publicvoid setScheduler(Scheduler scheduler) {
        this.scheduler = scheduler;
     }
    
     public Scheduler getScheduler() {
        returnscheduler;
     }
 }
</code></pre> 
<p><strong>注意：</strong></p> 
<p>1.lazy-init如果设置为true，这任务工程在服务器启动时不会加载。所以这里必须设置为false。</p> 
<p>2.由于在上边的配置中定义的了default-autowire="byName"， Spring会自动注入quartz中的datasource bean，所以会报异常。 解决方法：在bean中关掉autowired</p></div>
	      </div>
        <div class='blog'>
      <h2><a href="#top" class='top'>回到顶部</a><a name="blog_151984" href="https://my.oschina.net/u/225084/blog/151984">ajax Post 使用总结</a></h2>
	  <div class='outline'>
	  <div class='date'>时间：2013-08-11 22:23:39</div>
	  <div class='catalog'>分类：web开发</div>
	  	  	  <div class='tags'>标签：ajax,post</div>	  	  	  </div>
      <div class='content'><p><strong>注意：</strong></p> 
<p>$.post()，中的回调函数中的，要执行的数据类型，要和dataType匹配，否则无法正常执行回调函数。</p> 
<p><strong>例如：</strong></p> 
<p>在回调函数中只执行alert， datatype就可以填，或者填写text。 但是在回调函数中执行json格式的数据，就必须将dataType写为json。</p> 
<p>这个是我写$.post()</p> 
<pre><code>&lt;!-- lang: js --&gt;
     functioncheck() {
               vartiming = (new Date()).getTime(); // current time
               varall = new Array();
               $.post("${ctx}/chart/updateChartAction.do",function(json) {
                        varlists = json.data;
                        for( var i = 0; i &lt; lists.length; i++) {
                                 all.push(lists[i].cdata);
                                 //shift= dynamicChart.series[0].data.length &gt; 20;
                                 //dynamicChart.series[0].addPoint([timing,all[i]], true, shift);
                                 //dynamicChart.redraw();
                        }
               },"json");
               returnall;
     }
</code></pre></div>
	      </div>
        <div class='blog'>
      <h2><a href="#top" class='top'>回到顶部</a><a name="blog_151982" href="https://my.oschina.net/u/225084/blog/151982">Highchart 动态从库中读取数据</a></h2>
	  <div class='outline'>
	  <div class='date'>时间：2013-08-11 22:22:11</div>
	  <div class='catalog'>分类：web开发</div>
	  	  	  <div class='tags'>标签：Highchart,dynamic,database</div>	  	  	  </div>
      <div class='content'><p>前台页面jsp</p> 
<pre><code>&lt;!-- lang: java --&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta http-equiv="Content-Type" content="text/html; charset=UTF-8"&gt;
&lt;title&gt;Highcharts Example&lt;/title&gt;
&lt;script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"&gt;&lt;/script&gt;
&lt;script src="${ctx}/common/chartJs/highcharts.js"&gt;&lt;/script&gt;
&lt;script src="${ctx}/common/chartJs/modules/exporting.js"&gt;&lt;/script&gt;
&lt;script type="text/javascript"&gt;
    $(document).ready(function() {
	
	$.post("${ctx}/chart/updateChartAction2.do", function(json) {
	    new Highcharts.Chart({
		chart : {
		    //将图表显示至 container div
		    renderTo : 'container',
		    //char的类型 line, spline, area, areaspline, column, bar, pie and scatter
		    type : 'line',
		    //上边距
		    marginRight : 130,
		    //下边距
		    marginBottom : 45,
		    //不显示动画(性能)
		    animation : false
		},
		
		//标题
		title : {
		    text : 'Monthly Average Temperature',
		    //The x position of the title relative to the alignment within chart.spacingLeft and chart.spacingRight. Defaults to 0.
		    x : 0
		},
		
		//子标题
		subtitle : {
		    text : 'Source: WorldClimate.com',
		    x : 0
		},
		
		//x轴 标题
		xAxis : {
		    //Can be one of "linear", "logarithmic", "datetime" or "category".
		    type : 'category'
		},
		
		//y轴 标题
		yAxis : {
		    title : {
			text : '测试数据(%)'
		    },
		    labels : {
			format : '{value} %'
		    },
		    //基准线
		    plotLines : [ {
			//基准线类型 点线
			dashStyle: 'Dash',
			//The position of the line in axis units.
			value : 80,
			//The width or thickness of the plot line.
			width : 1,
			//y轴上的刻度线颜色
			color : '#EE0000'
		    } ]
		},
		
		//当鼠标放在point上时，显示的单位/后缀
		tooltip : {
		    //是否显示tip
		    enabled: true,
		    //是否可以比较
		    shared: false,
		    //可现实小数位数
		    valueDecimals: 1,
		    //前缀
		    valuePrefix : '',
		    //后缀
		    valueSuffix : '%'
		},

		//绘图项设置
		plotOptions : {
		    line : {
			//超过阀值的颜色
			color: '#FF0000',
			//未超过阀值后的颜色
			   negativeColor: '#0088FF',
			   //阀值
			threshold : 80,
			//线条  是否趋势成动画显示
			animation: {
			    duration: 2000
			}
		    }
		},
		
		//图例框
		legend : {
		    enabled: true,
		    //The layout of the legend items. Can be one of "horizontal" or "vertical".
		    layout : 'vertical',
		    //The horizontal alignment of the legend box within the chart area. Valid values are "left", "center" and "right"
		    align : 'left',
		    //The vertical alignment of the legend box. Can be one of "top", "middle" or "bottom". 
		    //Vertical position can be further determined by the y option. Defaults to bottom.
		    verticalAlign : 'top',
		    //The x offset of the legend relative to it's horizontal alignment align within chart.
		    x : 0,
		    //The vertical offset of the legend relative to it's vertical alignment verticalAlign within chart.
		    y : 100,
		    //The width of the drawn border around the legend. Defaults to 1.
		    borderWidth : 1
		},
		
		//去掉highChart网站连接url
		credits : {
		    enable : true
		},
		
		//去掉导出按钮
		exporting : {
		    enabled : true
		},
		
		//数据，个人认为这种方法，最强之处就在于series传值完全通过json。
		series : json
	    });
	    
	}, "json");

    });
&lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;div id="container" style="min-width: 400px; height: 420px; margin: 0 auto"&gt;&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre> 
<p>后台使用json传送数据。这里使用json的便利之处，就在数据的格式更佳灵活。开发人员能够更灵活的控制数据的传递。</p> 
<pre><code>&lt;!-- lang: java --&gt;
/**
 * 方法二：组织成json传送到前台
 */
public void updateChartAction2(){
    List&lt;Chart&gt; c1 = chartService.getChartByName("beijing");
    List&lt;Chart&gt; c2 = chartService.getChartByName("shanghai");
    try {
        JSONObject obj1 = this.writeJSON("beijing", c1);
        JSONObject obj2 = this.writeJSON("shanghai", c2);
        
        /**
         *   组合成
         *  [
         *    name：xxx
         *    data: {[x1,y1],[x2,y2], ... }
         *   ]
         */
        JSONArray all = new JSONArray();
        all.put(obj1);
        all.put(obj2);
        
        HttpServletResponse response = ServletActionContext.getResponse();
        response.setCharacterEncoding("UTF-8");
        response.getWriter().write(all.toString());
        response.getWriter().flush();
    } catch (IOException e) {
        e.printStackTrace();
    }
}

public JSONObject writeJSON(String nameVlu, List&lt;Chart&gt; list) {
    // 组合成{[x1,y1],[x2,y2], ... }
    JSONArray jsonArray = new JSONArray();
    for (int i = 0; i &lt; list.size(); i++) {
        JSONArray sub = new JSONArray();
        sub.put(list.get(i).getcTime());
        sub.put(list.get(i).getCdata());
        jsonArray.put(sub);
    }

    /**
     * 组合成 name：xxx data: {[x1,y1],[x2,y2], ... }
     */
    JSONObject jsonObject = new JSONObject();
    jsonObject.put("name", nameVlu);
    jsonObject.put("data", jsonArray);

    return jsonObject;
}
</code></pre></div>
	  	  <div class='commentList'>
		<h3>评论列表</h3>
	    	    <div class='comment'>
		  <div class='author'>星星爷</div>
		  <div class='date'>2013-12-03 15:14:48</div>
		  <div class='content'>能看看你json的完整格式吗， 格式总是搞不定哦， 对照api看 没有什么问题 就是设置不成功...</div>
		</div>
			    <div class='comment'>
		  <div class='author'>gerry_pang</div>
		  <div class='date'>2013-12-04 12:18:36</div>
		  <div class='content'><div class=ref><h4>引用来自“星迷”的评论</h4><p>能看看你json的完整格式吗， 格式总是搞不定哦， 对照api看 没有什么问题 就是设置不成功...</p></div>我记得传到hightchart中的json格式是这样的：[name：xxx, data: {[x1,y1],[x2,y2], ... }]。<br/>不知道你说的是不是这个?</div>
		</div>
			    <div class='comment'>
		  <div class='author'>gerry_pang</div>
		  <div class='date'>2013-12-04 12:28:35</div>
		  <div class='content'><div class=ref><h4>引用来自“星迷”的评论</h4><p>能看看你json的完整格式吗， 格式总是搞不定哦， 对照api看 没有什么问题 就是设置不成功...</p></div>对了，你可以使用gson，google的开源插件，它可以直接将对象、数组、枚举以及嵌套复杂的对象转为json格式，也可将json格式的字符串直接转化为对象，即便这个类没有源码也可以。超强大，很高用的。有兴趣试试吧。</div>
		</div>
			    <div class='comment'>
		  <div class='author'>星星爷</div>
		  <div class='date'>2013-12-04 13:35:16</div>
		  <div class='content'><div class=ref><h4>引用来自“pgw”的评论</h4><p><div class=ref><h4>引用来自“星迷”的评论</h4><p>能看看你json的完整格式吗， 格式总是搞不定哦， 对照api看 没有什么问题 就是设置不成功...</p></div>对了，你可以使用gson，google的开源插件，它可以直接将对象、数组、枚举以及嵌套复杂的对象转为json格式，也可将json格式的字符串直接转化为对象，即便这个类没有源码也可以。超强大，很高用的。有兴趣试试吧。</p></div>多谢回复， 格式那样的，动态设置还是不成功。， 另外手动设置2条折线 也没效果。 多谢你的回复</div>
		</div>
			    <div class='comment'>
		  <div class='author'>星星爷</div>
		  <div class='date'>2013-12-05 12:01:03</div>
		  <div class='content'><div class=ref><h4>引用来自“pgw”的评论</h4><p><div class=ref><h4>引用来自“星迷”的评论</h4><p>能看看你json的完整格式吗， 格式总是搞不定哦， 对照api看 没有什么问题 就是设置不成功...</p></div>我记得传到hightchart中的json格式是这样的：[name：xxx, data: {[x1,y1],[x2,y2], ... }]。<br/>不知道你说的是不是这个?</p></div>多谢。 成功了。 找到原因了，不是json格式的问题，是chart设置的问题， 数据哪里 series：jsonData  我错误的整成 series:[name:&apos;test&apos;,data:jsonData]  了 。   粗心害死人。</div>
		</div>
			  </div>
	      </div>
        <div class='blog'>
      <h2><a href="#top" class='top'>回到顶部</a><a name="blog_822438" href="https://my.oschina.net/u/225084/blog/822438">JQuery Nicescroll插件功能不生效检查点</a></h2>
	  <div class='outline'>
	  <div class='date'>时间：2017-01-10 20:02:06</div>
	  <div class='catalog'>分类：Junit</div>
	  	  	  	  	  </div>
      <div class='content'><pre><code class="language-html">&lt;!--1、检查html最顶端有没有写声明--&gt;
&lt;!--html4格式--&gt;
&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"&gt;

&lt;!--html5格式--&gt;
&lt;!DOCTYPE html&gt;

&lt;!--2、检查一下书写规范，虽然有的时候不用$(document).ready也能展示，但是最好规规矩矩的按人家规范来--&gt;
&lt;script type="text/javascript"&gt;   
    $(document).ready( function() {
        $("html").niceScroll();
     } );
&lt;/script&gt;
</code></pre> 
<p>&nbsp;</p></div>
	      </div>
        <div class='blog'>
      <h2><a href="#top" class='top'>回到顶部</a><a name="blog_363466" href="https://my.oschina.net/u/225084/blog/363466">SQL1084C  Shared memory segments cannot be allocat</a></h2>
	  <div class='outline'>
	  <div class='date'>时间：2015-01-04 14:05:59</div>
	  <div class='catalog'>分类：数据库</div>
	  	  	  <div class='tags'>标签：db2,SQL1084C</div>	  	  	  </div>
      <div class='content'><p><strong>【原因分析】：</strong></p> 
<p>由于服务器内存消耗过多，导致内存不够用，数据库无法分配多余的内存给应用创建连接。</p> 
<p><strong><br></strong></p> 
<p><strong>【解决方法】</strong></p> 
<p>使用db2&nbsp;force&nbsp;application&nbsp;all，强制断开所有的应用与数据库连接，清除session。</p> 
<p><br></p></div>
	  	  <div class='commentList'>
		<h3>评论列表</h3>
	    	    <div class='comment'>
		  <div class='author'>Release</div>
		  <div class='date'>2015-01-24 13:21:09</div>
		  <div class='content'><img src="/js/ke/plugins/emoticons/79.gif" alt="79"/></div>
		</div>
			  </div>
	      </div>
        <div class='blog'>
      <h2><a href="#top" class='top'>回到顶部</a><a name="blog_363449" href="https://my.oschina.net/u/225084/blog/363449">"orcibly releasing inactive connection" 异常处理</a></h2>
	  <div class='outline'>
	  <div class='date'>时间：2015-01-04 13:01:19</div>
	  <div class='catalog'>分类：常见异常</div>
	  	  	  	  	  </div>
      <div class='content'><p><strong>【异常信息】：</strong></p> 
<pre class="brush:java;toolbar: true; auto-links: false;">&lt;2014-12-25&nbsp;下午05时12分25秒&nbsp;CST&gt;&nbsp;&lt;Warning&gt;&nbsp;&lt;JDBC&gt;&nbsp;
&lt;BEA-001153&gt;&nbsp;&lt;Forcibly&nbsp;releasing&nbsp;inactive&nbsp;connection&nbsp;
"weblogic.jdbc.wrapper.PoolConnection_oracle_jdbc_driver_T4CConnection@531b381"
&nbsp;back&nbsp;into&nbsp;the&nbsp;connection&nbsp;pool&nbsp;"SinobrpsDataSourceOne",&nbsp;currently&nbsp;
reserved&nbsp;by:&nbsp;java.lang.Exception
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;weblogic.jdbc.common.internal.ConnectionEnv.setup(ConnectionEnv.java:318)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;weblogic.common.resourcepool.ResourcePoolImpl.reserveResource(ResourcePoolImpl.java:344)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;weblogic.common.resourcepool.ResourcePoolImpl.reserveResource(ResourcePoolImpl.java:322)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;weblogic.jdbc.common.internal.ConnectionPool.reserve(ConnectionPool.java:438)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;weblogic.jdbc.common.internal.ConnectionPool.reserve(ConnectionPool.java:317)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;weblogic.jdbc.common.internal.ConnectionPoolManager.reserve(ConnectionPoolManager.java:93)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;weblogic.jdbc.common.internal.ConnectionPoolManager.reserve(ConnectionPoolManager.java:106)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;weblogic.jdbc.pool.Driver.connect(Driver.java:149)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;weblogic.jdbc.jts.Driver.getNonTxConnection(Driver.java:652)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;weblogic.jdbc.jts.Driver.connect(Driver.java:127)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;weblogic.jdbc.common.internal.RmiDataSource.getConnection(RmiDataSource.java:355)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;com.sinosoft.sysframework.reference.DBManager.open(DBManager.java:72)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;com.sinosoft.sinobrps.main.release.ComputeHistory.insertComputeTableA(ComputeHistory.java:65)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;com.sinosoft.sinobrps.main.check.CheckComputeResult.conditionTwo(CheckComputeResult.java:210)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;com.sinosoft.sinobrps.main.check.CheckComputeResult.checkResult(CheckComputeResult.java:126)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;com.sinosoft.sinobrps.main.check.CheckThread.run(CheckThread.java:17)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;java.lang.Thread.run(Thread.java:619)
.&gt;
&lt;2014-12-25
&nbsp;下午05时12分25秒&nbsp;CST&gt;&nbsp;&lt;Notice&gt;&nbsp;&lt;Stdout&gt;&nbsp;&lt;BEA-000000&gt;&nbsp;
&lt;[14-12-25&nbsp;17:12:25,972]&nbsp;[ERROR]&nbsp;[ComputeHistory:insertComputeTableA&nbsp;
79]&nbsp;java.sql.SQLException:&nbsp;Connection&nbsp;has&nbsp;already&nbsp;been&nbsp;closed.&gt;
&lt;2014-12-25
&nbsp;下午05时12分25秒&nbsp;CST&gt;&nbsp;&lt;Notice&gt;&nbsp;&lt;Stdout&gt;&nbsp;&lt;BEA-000000&gt;&nbsp;
&lt;[14-12-25&nbsp;17:12:25,995]&nbsp;[INFO&nbsp;]&nbsp;[QuartzManager:pauseJob&nbsp;141]&nbsp;成功暂停&nbsp;
'CheckVersionTask'&nbsp;定时器。&gt;
&lt;2014-12-25&nbsp;下午05时12分25秒&nbsp;CST&gt;&nbsp;
&lt;Notice&gt;&nbsp;&lt;Stdout&gt;&nbsp;&lt;BEA-000000&gt;&nbsp;&lt;[14-12-25&nbsp;
17:12:25,996]&nbsp;[ERROR]&nbsp;[ComputeHistory:insertComputeTableA&nbsp;83]&nbsp;
java.sql.SQLException:&nbsp;Connection&nbsp;has&nbsp;already&nbsp;been&nbsp;closed.&gt;
&lt;2014-12-25
&nbsp;下午05时12分25秒&nbsp;CST&gt;&nbsp;&lt;Notice&gt;&nbsp;&lt;Stdout&gt;&nbsp;&lt;BEA-000000&gt;&nbsp;
&lt;[14-12-25&nbsp;17:12:25,996]&nbsp;[ERROR]&nbsp;[ComputeHistory:insertComputeTableA&nbsp;
84]&nbsp;校验通过时,计算历史表存储数据异常!&gt;</pre> 
<p></p> 
<p><br></p> 
<p><strong>【原因分析】：</strong></p> 
<p>由于WebLogic内部设置了对于数据源超时非活动连接关闭机制，但是由于我们程序中执行SQL处理了数据量较大，最终导致我们程序执行的时间已经超出WebLogic内设置的数据源超时非活动连接时间，程序中SQL还没有执行完成，WebLogic就强制关闭了程序和数据库之间的连接。</p> 
<p><br></p> 
<p><strong>【解决方案】：</strong></p> 
<p>1、首先打开所要设置的数据源。</p> 
<p>2、然后设置<strong><span style="color:#E30000">非活动超时连接时</span></strong>间。</p> 
<p><strong><span style="color:#E30000">注意：</span></strong><span style="text-align: left;">要设置关闭非活动连接的总时间，除以4 就是这个参数所有填写值，此参数值单位为秒。</span></p> 
<p><strong>【参考资料】：</strong></p> 
<p><a href="http://www.blogjava.net/fjin/archive/2013/10/10/404841.html" rel="nofollow">http://www.blogjava.net/fjin/archive/2013/10/10/404841.html</a></p> 
<p><a href="http://impradeep.com/forcibly-releasing-inactive-connection-weblogic-jdbc-wrapper-poolconnection_oracle_jdbc_driver_t4cconnectiond72/" rel="nofollow">http://impradeep.com/forcibly-releasing-inactive-connection-weblogic-jdbc-wrapper-poolconnection_oracle_jdbc_driver_t4cconnectiond72/</a></p> 
<p><br></p> 
<p><br></p></div>
	      </div>
        <div class='blog'>
      <h2><a href="#top" class='top'>回到顶部</a><a name="blog_363448" href="https://my.oschina.net/u/225084/blog/363448">weblogic  "ThreadPool has stuck threads"  异常处理</a></h2>
	  <div class='outline'>
	  <div class='date'>时间：2015-01-04 12:59:14</div>
	  <div class='catalog'>分类：常见异常</div>
	  	  	  <div class='tags'>标签：weblogic,stuck</div>	  	  	  </div>
      <div class='content'><p><strong>【异常日志】：</strong></p> 
<pre class="brush:java;toolbar: true; auto-links: false;">&lt;2014-12-23
&nbsp;上午09时58分33秒&nbsp;CST&gt;&nbsp;&lt;Error&gt;&nbsp;&lt;WebLogicServer&gt;&nbsp;
&lt;BEA-000337&gt;&nbsp;&lt;[STUCK]&nbsp;ExecuteThread:&nbsp;'1'&nbsp;for&nbsp;queue:&nbsp;
'weblogic.kernel.Default&nbsp;(self-tuning)'&nbsp;has&nbsp;been&nbsp;busy&nbsp;for&nbsp;"603"&nbsp;seconds&nbsp;
working&nbsp;on&nbsp;the&nbsp;request&nbsp;
"weblogic.work.SelfTuningWorkManagerImpl$WorkAdapterImpl@a738be",&nbsp;which&nbsp;
is&nbsp;more&nbsp;than&nbsp;the&nbsp;configured&nbsp;time&nbsp;(StuckThreadMaxTime)&nbsp;of&nbsp;"600"&nbsp;seconds.&nbsp;
Stack&nbsp;trace:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;oracle.jdbc.driver.PhysicalConnection.rollback(PhysicalConnection.java:3447)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;weblogic.jdbc.wrapper.Connection.forcedCleanup(Connection.java:151)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;weblogic.common.resourcepool.ResourcePoolImpl.timeoutInactiveResources(ResourcePoolImpl.java:1933)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;weblogic.common.resourcepool.ResourcePoolImpl.access$600(ResourcePoolImpl.java:40)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;weblogic.common.resourcepool.ResourcePoolImpl$ResourcePoolMaintanenceTask.timerExpired(ResourcePoolImpl.java:2411)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;weblogic.timers.internal.TimerImpl.run(TimerImpl.java:273)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;weblogic.work.SelfTuningWorkManagerImpl$WorkAdapterImpl.run(SelfTuningWorkManagerImpl.java:528)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;weblogic.work.ExecuteThread.execute(ExecuteThread.java:201)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;weblogic.work.ExecuteThread.run(ExecuteThread.java:173)
&gt;</pre> 
<p></p> 
<p><strong>【原因分析】：</strong></p> 
<p>1、线程执行时间过长，出现阻塞问题，分析日志查看出现的问题的线程类名。</p> 
<p>2、sql语句执行时间过长。</p> 
<p><br></p> 
<p><strong>【解决方法】：</strong></p> 
<p>可以通过以下几种方法解决：<br>1）修改StuckThreadMaxTime参数，将默认的600s改成1200s，或者其它适合的值。<br>2）增大线程数，防止线程阻塞问题。<br>3）优化程序，减少处理时间。</p> 
<p><br></p> 
<p>对sql语句进行优化处理：<br>1）对INFO_SIGN,PPMC等字段建立规范表，从数据库中进行查询，尽量减少in的使用<br>2）对&lt;&gt;等操作符不使用,使用&gt; or &lt;等方式来代替<br>3）尽量减少排序order by，rownum的使用，只在关键时刻进行使用，其他时刻能够不使用的就不进行使用。</p> 
<p><br></p></div>
	      </div>
        <div class='blog'>
      <h2><a href="#top" class='top'>回到顶部</a><a name="blog_280773" href="https://my.oschina.net/u/225084/blog/280773">对于类中静态变量的控制问题</a></h2>
	  <div class='outline'>
	  <div class='date'>时间：2014-06-17 17:14:00</div>
	  <div class='catalog'>分类：web开发</div>
	  	  	  <div class='tags'>标签：并发,类中静态变量,单例模式</div>	  	  	  </div>
      <div class='content'><p>java静态对象和非静态对象有什么区别？<br /><br />比对如下：<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 静态对象&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 非静态对象&nbsp;&nbsp;&nbsp; &nbsp;<br />拥有属性：&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 是类共同拥有的&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 是类各对象独立拥有的<br />内存分配：&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 内存空间上是固定的&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 空间在各个附属类里面分配<br />分配顺序：&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 先分配静态对象的空间&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 继而再对非静态对象分配空间,也就是初始化顺序是先静态<br /><br />在开发过程中遇到使用静态变量，将它作为计数标识等作用，除了通过synchronized进行控制外，发现并没有解决在高并发问题。还要在将此类设计为单例模式，在单例模式中对于对象的生成也要加锁（synchronized），这样在外层类进行调用时就可以控制住线程的高并发问题。<br /></p> 
<pre class="brush:java;toolbar: true; auto-links: false;">public&nbsp;class&nbsp;PubUtil&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;static&nbsp;int&nbsp;mSerialNo&nbsp;=&nbsp;0;
&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;PubUtil&nbsp;pubUtil&nbsp;=&nbsp;null;
&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;PubUtil&nbsp;getInstance()&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(pubUtil&nbsp;==&nbsp;null)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;synchronized&nbsp;(PubUtil.class)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(pubUtil&nbsp;==&nbsp;null)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pubUtil&nbsp;=&nbsp;new&nbsp;PubUtil();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;pubUtil;
&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;String&nbsp;CreateMaxNo(String&nbsp;businessType,&nbsp;String&nbsp;areaCode&nbsp;)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;对于类中静态变量的的控制
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;...&nbsp;...
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;synchronized&nbsp;(this)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(mSerialNo&nbsp;==&nbsp;100){
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mSerialNo&nbsp;=&nbsp;10;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;serialNo&nbsp;=&nbsp;(calendar.getTimeInMillis())&nbsp;*&nbsp;100&nbsp;+&nbsp;mSerialNo;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mSerialNo++;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;...&nbsp;...
&nbsp;&nbsp;&nbsp;&nbsp;}
}</pre> 
<p></p> 
<p><br />参考文档：http://devbean.blog.51cto.com/448512/203501/<br /></p></div>
	      </div>
        <div class='blog'>
      <h2><a href="#top" class='top'>回到顶部</a><a name="blog_280725" href="https://my.oschina.net/u/225084/blog/280725">通过HttpClient类调用其他子系统中action方法 </a></h2>
	  <div class='outline'>
	  <div class='date'>时间：2014-06-17 15:57:28</div>
	  <div class='catalog'>分类：web开发</div>
	  	  	  	  	  </div>
      <div class='content'><p>最近只是项目中偶然用到，所以拿来在这里简单记录一下，以便后期使用。这里只是简单的HttpClient使用方法，而且这里只是用了get方法，关于其他HttpClient相关内容，待后续学习后补充。<br /></p> 
<p>下文代码中使用GET的请求方式，那么所有参数都直接放到页面的URL后面用问号与页面地址隔开，每个参数用&amp;隔开，例如：http://java.sun.com/?name=liudong&amp;mobile=123456</p> 
<pre class="brush:java;toolbar: true; auto-links: false;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;初始化调用地址url
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;url&nbsp;=&nbsp;&quot;&quot;;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BLConfigCustomAction&nbsp;blConfigCustomAction&nbsp;=new&nbsp;BLConfigCustomAction();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;组织url
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MidConfigDto&nbsp;midConfigDto&nbsp;=&nbsp;blConfigCustomAction.findByPrimaryKeyMidConfig(AppConst.PROXY_ADDRESS);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;url&nbsp;=&nbsp;midConfigDto.getConfigValue()&nbsp;+&nbsp;&quot;/optswitch?optSwitch=&quot;+optSwitch;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(Exception&nbsp;e)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;log.error(&quot;查询proxy子系统地址出现异常！&quot;);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HttpClient&nbsp;client&nbsp;=&nbsp;new&nbsp;HttpClient();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GetMethod&nbsp;getMethod&nbsp;=&nbsp;new&nbsp;GetMethod(url);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;HttpMethodParams.RETRY_HANDLER是一个静态变量值：http.method.retry-handler,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;httpclient调用时/，如果Http出错，三次重试
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;getMethod.getParams().setParameter(HttpMethodParams.RETRY_HANDLER,&nbsp;new&nbsp;DefaultHttpMethodRetryHandler());
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;执行返回状态变量
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;statusCode;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;执行getMethod
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;statusCode&nbsp;=&nbsp;client.executeMethod(getMethod);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(statusCode&nbsp;!=&nbsp;HttpStatus.SC_OK)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;log.error(&quot;HttpClient&nbsp;Method&nbsp;failed:&nbsp;&quot;&nbsp;+&nbsp;getMethod.getStatusLine());
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(HttpException&nbsp;e)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;发生致命的异常，可能是协议不对或者返回的内容有问题
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;log.error(&quot;Please&nbsp;check&nbsp;your&nbsp;HttpClient&nbsp;address!&quot;);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;log.error(e.toString());
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(IOException&nbsp;e)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;发生网络异常
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;log.error(&quot;HttpClient&nbsp;IOException!&quot;);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;log.error(e.toString());
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}finally{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;释放连接
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;getMethod.releaseConnection();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</pre> 
<p><br /></p> 
<p>【ps】<br /></p> 
<p>HttpClient 是 Apache Jakarta Common 下的子项目，用来提供高效的、最新的、功能丰富的支持 HTTP 协议的客户端编程工具包，并且它支持 HTTP 协议最新的版本和建议。HttpClient 已经应用在很多的项目中，比如 Apache Jakarta 上很著名的另外两个开源项目 Cactus 和 HTMLUnit 都使用了 HttpClient，更多使用 HttpClient 的应用可以参见<a href="http://wiki.apache.org/jakarta-httpclient/HttpClientPowered" target="blank" rel="nofollow">http://wiki.apache.org/jakarta-httpclient/HttpClientPowered</a>。HttpClient 项目非常活跃，使用的人还是非常多的。目前 HttpClient 版本是在 2005.10.11 发布的 3.0 RC4 。&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; <br /></p></div>
	      </div>
        <div class='blog'>
      <h2><a href="#top" class='top'>回到顶部</a><a name="blog_264893" href="https://my.oschina.net/u/225084/blog/264893">单点登录系统技术(SSO)梳理(二)</a></h2>
	  <div class='outline'>
	  <div class='date'>时间：2014-05-14 18:27:25</div>
	  <div class='catalog'>分类：web开发</div>
	  	  	  <div class='tags'>标签：单点登录,jsonp,cookie,跨域</div>	  	  	  </div>
      <div class='content'><p><span style="font-family:宋体">系统中两种单点登录实现方式：</span></p> 
<p>1、<span style="font:9px 'Times New Roman'">&nbsp; </span><span style="font-family:宋体">直接登录单点登录认证系统。</span></p> 
<p>2、<span style="font:9px 'Times New Roman'">&nbsp; </span><span style="font-family:宋体">登录业务系统，如用户此时为首次登录，则跳转得到单点登录认证界面。如用户已通过认证，则直接登录到业务系统。</span></p> 
<p>&nbsp;</p> 
<p><span style="font-family:宋体">【补充说明】</span></p> 
<p><span style="font-family:宋体">单点登录认证服务器地址：</span><a href="http://192.168.61.124:8080/SSOAuth_v1.0.0/" rel="nofollow">http://192.168.61.124:8080/SSOAuth_v1.0.0/</a></p> 
<p><span style="font-family:宋体">业务系统服务器地址：</span><a href="http://192.168.61.134:8080/sepmis_v1.3.0/" rel="nofollow">http://192.168.61.134:8080/sepmis_v1.3.0/</a></p> 
<p>&nbsp;</p> 
<p><span style="font-family:宋体">直接登录单点登录认证系统流程：</span></p> 
<p>1、<span style="font:9px 'Times New Roman'">&nbsp; </span><span style="font-family:宋体">打开单点登录认证服务器登录页面，输入用户名密码。</span></p> 
<p><img src="http://static.oschina.net/uploads/space/2014/0514/180930_xO4o_225084.jpg" /></p> 
<p>2、<span style="font:9px 'Times New Roman'">&nbsp; </span><span style="font-family:宋体">如果通过认证，此时页面跳转到系统主界面</span>main.jsp<span style="font-family:宋体">。这个时候在加载</span>main.jsp<span style="font-family:宋体">页面同时，页面后端通过</span>ajax<span style="font-family:宋体">中</span>jsonp<span style="font-family:宋体">方式，向单点登录认证服务器后台</span>Action<span style="font-family:宋体">发送</span>hello<span style="font-family:宋体">请求。需要传递参数，当前用户代码。</span></p> 
<p>main.jsp<span style="font-family: 宋体">页面核心代码如下：</span></p> 
<pre class="brush:js;toolbar: true; auto-links: false;">&lt;%
&nbsp;&nbsp;&nbsp;&nbsp;UserSession&nbsp;userSession&nbsp;=&nbsp;(UserSession)session.getAttribute(AppConst.USER_SESSION_ID);
&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;userCode&nbsp;=&nbsp;&quot;&quot;;
&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;userName&nbsp;=&nbsp;&quot;&quot;;
&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;if(null&nbsp;!=&nbsp;userSession){
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;userCode&nbsp;=&nbsp;userSession.getUserCode();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;userName&nbsp;=&nbsp;userSession.getUserType();
&nbsp;&nbsp;&nbsp;&nbsp;}
%&gt;&nbsp;&nbsp;
&nbsp;
&lt;script&nbsp;type=&quot;text/javascript&quot;&gt;
&nbsp;&nbsp;&nbsp;&nbsp;$.ajax({&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;type:&nbsp;&quot;get&quot;,&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;contentType:&nbsp;&quot;application/json&quot;,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;url:&nbsp;&quot;http://192.168.61.124:8080/SSOAuth_v1.0.0/hello.do?usercode=&lt;%=userCode%&gt;&amp;callback=?&quot;,&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;crossDomain:&nbsp;true,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;success:&nbsp;function(data)&nbsp;{&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$.each(data.msg,&nbsp;function&nbsp;()&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$.getJSON(this);&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;});&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/script&gt;</pre> 
<p></p> 
<p>3、<span style="font:9px 'Times New Roman'">&nbsp; </span><span style="font-family:宋体">后台接受</span>hello<span style="font-family:宋体">请求，通过传递的参数用户代码，在</span>SysRealuser<span style="font-family:宋体">表中判断用户所能够访问到的业务系统对象。拿到业务系统对象中</span>url<span style="font-family:宋体">参数，组织各个业务系统</span>setCookie Url<span style="font-family:宋体">。然后通过</span>json<span style="font-family:宋体">异步传回前台。</span></p> 
<p>Url<span style="font-family:宋体">格式例如：</span>(<span style="font-family:宋体">红色字体处为变量</span>)</p> 
<pre class="brush:java;toolbar: true; auto-links: false;">http://192.168.61.134:8080/sepmis_v1.3.0/setCookie.do?userCode=xxx&amp;&amp;callback=?</pre> 
<p></p> 
<p><span style="font-family:宋体">代码如下：</span></p> 
<pre class="brush:java;toolbar: true; auto-links: false;">/**
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;当用户成功通过单点登录系统认证后，用户进入系统操作界面，同时页面异步发送此action请求
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;获取创建json对象，对象内容为页面使用ajax异步访问各个业务系统的&nbsp;setcookie&nbsp;action方法
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;result
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/
&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;String&nbsp;hello(){
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;List&lt;SysInfo&gt;&nbsp;tmp&nbsp;=&nbsp;getUserSysRealSys();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UserSession&nbsp;userSession&nbsp;=&nbsp;AuthorityUtil.getSysUserSession();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JSONObject&nbsp;jsonObject&nbsp;=&nbsp;new&nbsp;JSONObject();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JSONArray&nbsp;jsonArray&nbsp;=&nbsp;new&nbsp;JSONArray();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(tmp!=null&nbsp;&amp;&amp;&nbsp;tmp.size()&gt;0){
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for(int&nbsp;i=0;&nbsp;i&lt;tmp.size();&nbsp;i++){
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jsonArray.put(tmp.get(i).getSysUrl()&nbsp;+&nbsp;&quot;/setCookie.do?userCode=&quot;+userSession.getUserCode()+&quot;&amp;callback=?&quot;);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jsonObject.put(&quot;msg&quot;,&nbsp;jsonArray);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;response.setContentType(&quot;application/json&quot;);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;response.setCharacterEncoding(&quot;UTF-8&quot;);&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;response.setHeader(&quot;Cache-Control&quot;,&nbsp;&quot;no-cache&quot;);&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;response.getWriter().write(jsonObject.toString());
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;response.getWriter().flush();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//释放资源
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tmp&nbsp;=&nbsp;null;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;userSession&nbsp;=&nbsp;null;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//打印日志
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;info&nbsp;&nbsp;=&nbsp;LoggerUtil.getInfoMsg(&quot;AJAX异步访问，用户权限范围内各业务系统的&nbsp;setCookie方法&quot;);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;log.info(info);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;null;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(IOException&nbsp;ie)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.exceptionMessage.setError(ie.toString());
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.exceptionMessage.setClassName(this.getClass().getName());
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.exceptionMessage.setMessage(&quot;AJAX异步访问出现IO异常！&quot;);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;log.error(ie.toString());
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;ERROR;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(Exception&nbsp;ex)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.exceptionMessage.setError(ex.toString());
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.exceptionMessage.setClassName(this.getClass().getName());
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.exceptionMessage.setMessage(&quot;AJAX异步访问出现异常！&quot;);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;log.error(ex.toString());
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;ERROR;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;}</pre> 
<p></p> 
<p>4、<span style="font:9px 'Times New Roman'">&nbsp; </span><span style="font-family:宋体">前台</span>main.jsp<span style="font-family:宋体">页面这时拿到传回的</span>URL<span style="font-family:宋体">参数，此时执行</span>Success<span style="font-family:宋体">代码段中的函数</span></p> 
<pre class="brush:js;toolbar: true; auto-links: false;">success:&nbsp;function(data)&nbsp;{&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$.each(data.msg,&nbsp;function&nbsp;()&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$.getJSON(this);&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});</pre> 
<p></p> 
<p><span style="font-size:14px;font-family:宋体">此时</span><span style="font-size:14px;font-family:'Calibri','sans-serif'">function</span><span style="font-size:14px;font-family:宋体">中参数</span><span style="font-size:14px;font-family:'Calibri','sans-serif'">data</span><span style="font-size:14px;font-family:宋体">就是传回的</span><span style="font-size:14px;font-family:'Calibri','sans-serif'">URL</span><span style="font-size:14px;font-family:宋体">参数，然后遍历执行</span><span style="font-size:14px;font-family:'Calibri','sans-serif'">Jquery</span><span style="font-size:14px;font-family:宋体">中</span><span style="font-size:14px;font-family:'Calibri','sans-serif'">getJSON</span><span style="font-size:14px;font-family:宋体">方法。此时通过</span><span style="font-size:14px;font-family:'Calibri','sans-serif'">AJAX</span><span style="font-size:14px;font-family:宋体">技术异步又向各个业务系统发送</span><span style="font-size:14px;font-family:'Calibri','sans-serif'">setCookie</span><span style="font-size:14px;font-family:宋体">请求，此操作可以视为一种透明的登录操作，用户是不能够感知到。</span><br /></p> 
<p><img src="http://static.oschina.net/uploads/space/2014/0514/181310_5b7B_225084.jpg" /><br /></p> 
<p>5、<span style="font:9px 'Times New Roman'">&nbsp; </span><span style="font-family:宋体">业务系统接受</span>setCookie action<span style="font-family:宋体">请求。</span></p> 
<p><span style="font-size:14px;font-family:宋体">代码如下：</span></p> 
<pre class="brush:java;toolbar: true; auto-links: false;">public&nbsp;String&nbsp;setCookie(){
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;-&nbsp;查找用户岗位集合
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;StringBuilder&nbsp;hql&nbsp;=&nbsp;new&nbsp;StringBuilder(300);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;userCode&nbsp;=&nbsp;request.getParameter(&quot;userCode&quot;);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hql.append(&quot;FROM&nbsp;SysUser&nbsp;WHERE&nbsp;userCode&nbsp;='&quot;).append(userCode).append(&quot;'&quot;);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;List&lt;SysUser&gt;&nbsp;sysUserList&nbsp;=&nbsp;sysUserService.findByHql(hql.toString());
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(sysUserList.size()&nbsp;&gt;&nbsp;0){
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Cookie&nbsp;cookie&nbsp;=&nbsp;new&nbsp;Cookie(&quot;sso&quot;,&nbsp;userCode);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cookie.setPath(&quot;/&quot;);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//设置cookie的有效期，单位是秒;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//如果不使用这个方法或者参数为负数的话，当浏览器关闭的时候，这个cookie就失效了
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//cookie一年内有效60*60*24*365
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cookie.setMaxAge(60*60);&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;response.addCookie(cookie);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}catch(Exception&nbsp;ex){
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//返回异常信息
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.exceptionMessage.setError(ex.toString());
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.exceptionMessage.setClassName(this.getClass().getName());
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.exceptionMessage.setMessage(&quot;用户登录出现异常！&quot;);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;log.info(ex.toString());
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;ERROR;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;null;
&nbsp;&nbsp;&nbsp;&nbsp;}</pre> 
<p></p> 
<p><span style="font-size:14px;font-family:宋体"></span><span style="font-size:14px;font-family:宋体">业务系统通过</span><span style="font-size:14px;font-family:'Calibri','sans-serif'">setCookie</span><span style="font-size:14px;font-family:宋体">方法，将此用户在业务系统中</span><span style="font-size:14px;font-family:'Calibri','sans-serif'">Cookie</span><span style="font-size:14px;font-family:宋体">存储到用户本地。</span></p> 
<p><img src="http://static.oschina.net/uploads/space/2014/0514/181500_J6bU_225084.jpg" /></p> 
<p>6、<span style="font:9px 'Times New Roman'">&nbsp; </span><span style="font-family:宋体">输入业务系统连接。</span></p> 
<p><span style="font-size:14px;font-family:宋体">业务系统同后台通过</span><span style="font-size:14px;font-family:'Calibri','sans-serif'">filter</span><span style="font-size:14px;font-family:宋体">过滤所有请求，获取用户在当前服务器域下</span><span style="font-size:14px;font-family:'Calibri','sans-serif'">Cookie</span><span style="font-size:14px;font-family:宋体">值，进行校验，通过校验进入系统，未通过校验返回单点登录认证页面。</span></p> 
<p><span style="font-size:14px;font-family:宋体"><img src="http://static.oschina.net/uploads/space/2014/0514/181540_OccO_225084.jpg" /><br /></span></p> 
<p><span style="font-size:14px;font-family:宋体"><span style="font-size:14px;font-family:'Calibri','sans-serif'">SSOFilter.java</span><span style="font-size:14px;font-family:宋体">核心代码如下</span></span></p> 
<pre class="brush:java;toolbar: true; auto-links: false;">/**
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;servlet&nbsp;filter&nbsp;过滤方法
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;ServletRequest
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;ServletResponse
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;FilterChain
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@throws&nbsp;IOException,ServletException
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/
&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;doFilter(ServletRequest&nbsp;req,&nbsp;ServletResponse&nbsp;res,&nbsp;FilterChain&nbsp;chain)&nbsp;throws&nbsp;IOException,&nbsp;ServletException&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;用户本地cookie值
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;cookieValue&nbsp;=&nbsp;&quot;&quot;;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HttpServletRequest&nbsp;request&nbsp;=&nbsp;(HttpServletRequest)&nbsp;req;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HttpServletResponse&nbsp;response&nbsp;=&nbsp;(HttpServletResponse)&nbsp;res;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;url&nbsp;=&nbsp;request.getRequestURL().toString();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;返回结果
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;result&nbsp;=&nbsp;null;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;根据上下文根截取URL
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String[]&nbsp;urlArray&nbsp;=&nbsp;url.split(request.getContextPath());
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//如果是业务service地址，跳转到业务系统单点登录action
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(urlArray.length&nbsp;==&nbsp;2&nbsp;&amp;&amp;&nbsp;(&quot;/&quot;).equals(urlArray[1]))&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;response.sendRedirect(url+&quot;loginSSO.do&quot;);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}else&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for(int&nbsp;i=0;&nbsp;i&lt;urlArray.length;&nbsp;i++){
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(&quot;/setCookie.do&quot;.equals(urlArray[i])){
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result&nbsp;=&nbsp;&quot;setCookie&quot;;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;检查HTTP请求的head是否有需要的cookie
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Cookie[]&nbsp;diskCookies&nbsp;=&nbsp;request.getCookies();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(diskCookies&nbsp;!=&nbsp;null)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;log.info(&quot;【权限系统-用户认证过滤器】找到COOKIES&quot;);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(int&nbsp;i&nbsp;=&nbsp;0;&nbsp;i&nbsp;&lt;&nbsp;diskCookies.length;&nbsp;i++)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cookieValue&nbsp;=&nbsp;diskCookies[i].getValue();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;log.info(&quot;【权限系统-用户认证过滤器】COOKIES中找到用户标识:&quot;&nbsp;+&nbsp;diskCookies[i].getName()&nbsp;+&nbsp;&quot;=&quot;&nbsp;+&nbsp;cookieValue);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(SSO_AUTH.equals(diskCookies[i].getName()))&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result&nbsp;=&nbsp;SSOService(cookieValue);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(&quot;success&quot;.equals(result))&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;log.info(&quot;【通过单点登录服务器认证】&quot;);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;log.info(&quot;【未通过单点登录服务器认证】COOKIES认证失败&quot;);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;response.sendRedirect(ssoLoginPage);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;if&nbsp;(&quot;sso&quot;.equals(diskCookies[i].getName()))&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HttpSession&nbsp;session&nbsp;=&nbsp;&nbsp;request.getSession();&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;session.setAttribute(&quot;sso&quot;,&nbsp;cookieValue);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result&nbsp;=&nbsp;&quot;success&quot;;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;log.info(&quot;【权限系统-用户认证过滤器】未找到COOKIES&quot;);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;COOKIES效验,转到单点登录认证页面
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(result.equals(&quot;failed&quot;))&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;log.info(&quot;【权限系统-用户认证过滤器】COOKIES认证失败&quot;);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;response.sendRedirect(ssoLoginPage);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;效验成功并退出服务
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;if&nbsp;(result.equals(&quot;logout&quot;))&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;log.info(&quot;【权限系统-用户认证过滤器】退出登录&quot;);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//logoutService(cookieValue);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;response.sendRedirect(ssoLoginPage);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;效验成功
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;log.info(&quot;【权限系统-用户认证过滤器】认证成功&quot;);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Throwable&nbsp;problem&nbsp;=&nbsp;null;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;chain.doFilter(req,&nbsp;res);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(Throwable&nbsp;t)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;problem&nbsp;=&nbsp;t;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t.printStackTrace();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(problem&nbsp;!=&nbsp;null)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(problem&nbsp;instanceof&nbsp;ServletException)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;((ServletException)&nbsp;problem);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(problem&nbsp;instanceof&nbsp;IOException)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;((IOException)&nbsp;problem);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sendProcessingError(problem,&nbsp;res);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;/**
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;使用httpclient调用身份认证服务（SSOAuth）校验cookie
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;cookievalue
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;String&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@throws&nbsp;IOException
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/
&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;String&nbsp;SSOService(String&nbsp;cookievalue)&nbsp;throws&nbsp;IOException&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;result&nbsp;=&nbsp;&quot;failed&quot;;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;authAction&nbsp;=&nbsp;&quot;/sso/authcookie.do?cookieName=&quot;;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;tmp&nbsp;=&nbsp;this.ssoServiceURL&nbsp;+&nbsp;authAction&nbsp;+&nbsp;cookievalue;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;通过http协议来调用身份认证服务（SSOAuth）使用httpclient实现
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HttpClient&nbsp;httpclient&nbsp;=&nbsp;new&nbsp;HttpClient();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GetMethod&nbsp;httpget&nbsp;=&nbsp;new&nbsp;GetMethod(tmp);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;httpget.getParams().setParameter(HttpMethodParams.RETRY_HANDLER,&nbsp;new&nbsp;DefaultHttpMethodRetryHandler());
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;执行getMethod
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;statusCode&nbsp;=&nbsp;httpclient.executeMethod(httpget);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(statusCode&nbsp;!=&nbsp;HttpStatus.SC_OK)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;log.error(&quot;HttpClient&nbsp;Method&nbsp;failed:&nbsp;&quot;&nbsp;+&nbsp;httpget.getStatusLine());
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;获取返回内容
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result&nbsp;=&nbsp;httpget.getResponseHeader(&quot;result&quot;).getValue();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(HttpException&nbsp;e)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;发生致命的异常，可能是协议不对或者返回的内容有问题
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;log.error(&quot;Please&nbsp;check&nbsp;your&nbsp;HttpClient&nbsp;address!&quot;);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;log.error(e.toString());
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(IOException&nbsp;e)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;发生网络异常
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;log.error(e.toString());
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;finally&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;httpget.releaseConnection();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;log.info(&quot;【权限系统-用户认证过滤器】校验返回result=&quot;&nbsp;+&nbsp;result);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;result;
&nbsp;&nbsp;&nbsp;&nbsp;}</pre> 
<p></p> 
<p style="text-indent:28px"><span style="font-family:宋体">执行通过业务系统</span>fileter<span style="font-family:宋体">将，根据不同的请求进行不同的操作。获取业务系统</span>Cookie<span style="font-family:宋体">后同构使用</span><span style="font-size:13px;font-family:'Courier New';color:black">HttpClient</span><span style="font-size:13px;font-family:宋体;color:black">类方法调用单点认证中的</span><span style="font-size:13px;font-family:'Courier New';color:black">authcookie</span><span style="font-size:13px;font-family:宋体;color:black">方法，验证用户</span><span style="font-size:13px;font-family:'Courier New';color:black">Cookie</span><span style="font-size:13px;font-family: 宋体;color:black">的合法性。</span></p> 
<p><span style="font-size:13px;font-family:'Courier New';color:black">RealSysLoginAction.java</span><span style="font-size:13px;font-family:宋体;color:black">类</span><span style="font-size:13px;font-family:'Courier New';color:black">authcookie</span><span style="font-size:13px;font-family:宋体;color:black">方法代码：</span></p> 
<pre class="brush:java;toolbar: true; auto-links: false;">/**
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;验证用户本地cookie值，如果通过验证则登录到业务系统总，如果没有通过验证，
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;则跳转到单点登录系统认证页面。
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;result
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/
&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;String&nbsp;authcookie(){
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;info&nbsp;=&nbsp;null;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SysUser&nbsp;tmpUser&nbsp;=&nbsp;sysUserService.getSysUserById(getCookieName());
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(&nbsp;tmpUser&nbsp;==&nbsp;null){
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;response.setHeader(&quot;result&quot;,&nbsp;&quot;failed&quot;);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;info&nbsp;&nbsp;=&nbsp;LoggerUtil.getInfoMsg(&quot;未通过验证用户本地cookie值。&quot;);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}else{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;response.setHeader(&quot;result&quot;,&nbsp;&quot;success&quot;);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;info&nbsp;&nbsp;=&nbsp;LoggerUtil.getInfoMsg(&quot;通过验证用户本地cookie值。&quot;);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//释放资源
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tmpUser&nbsp;=&nbsp;null;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//打印日志
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;log.info(info);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;null;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}catch(Exception&nbsp;ex){
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.exceptionMessage.setError(ex.toString());
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.exceptionMessage.setClassName(this.getClass().getName());
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.exceptionMessage.setMessage(&quot;登录业务系统出现异常！&quot;);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;log.error(ex.toString());
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;ERROR;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;}</pre> 
<p></p> 
<p><span style="font-family:宋体">此种登录方法要修改原有业务系统中的登录</span>action<span style="font-family:宋体">方法。</span></p> 
<p>&nbsp;</p> 
<p><span style="font-family:宋体">业务系统</span>LoginSSOAction.java<span style="font-family:宋体">类，</span><span style="font-size:13px;font-family:'Courier New';color:black">loginSSO</span><span style="font-size:13px;font-family: 宋体;color:black">登录方法</span></p> 
<pre class="brush:java;toolbar: true; auto-links: false;">public&nbsp;String&nbsp;loginSSO(){
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//获取认证系统传过来的用户名密码
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;sysUserCode&nbsp;=&nbsp;ActionContext.getContext().getSession().get(&quot;sso&quot;).toString();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;log.info(&quot;【权限系统】获取用户登录信息：[sysUserCode=&quot;+sysUserCode+&quot;]&quot;);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SysUser&nbsp;sysUser_&nbsp;=&nbsp;this.loginService.findByPk(sysUserCode);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//判断输入用户名是否正确
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(sysUser_&nbsp;!=&nbsp;null)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//判断输入密码是否正确
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;-&nbsp;查找用户岗位集合
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;StringBuilder&nbsp;hql&nbsp;=&nbsp;new&nbsp;StringBuilder(300);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hql.append(&quot;SELECT&nbsp;sg.sysRole&nbsp;FROM&nbsp;SysUserGroup&nbsp;su,&nbsp;SysGroupRole&nbsp;sg&nbsp;WHERE&nbsp;su.id.userCode&nbsp;=&nbsp;'&quot;).append(sysUserCode)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.append(&quot;'&nbsp;AND&nbsp;su.id.groupCode&nbsp;=&nbsp;sg.id.groupCode&nbsp;AND&nbsp;sg.sysRole.roleType&nbsp;=&nbsp;'&quot;).append(AppConst.ROLE_TYPE_01).append(&quot;'&quot;);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;List&lt;SysRole&gt;&nbsp;rolesList&nbsp;=&nbsp;this.sysRoleService.findSysRoleList(hql.toString());
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;-&nbsp;将功能性的岗位添加至集合，并排除不同岗位中的相同功能
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;-&nbsp;查找用户所有功能集合
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Map&lt;String,&nbsp;SysRole&gt;&nbsp;funcPowersMap&nbsp;=&nbsp;new&nbsp;HashMap&lt;String,&nbsp;SysRole&gt;();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(SysRole&nbsp;role&nbsp;:&nbsp;rolesList)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;funcPowersMap.put(role.getRoleCode(),&nbsp;role);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;-&nbsp;组织UserSession
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UserSession&nbsp;userSession&nbsp;=&nbsp;new&nbsp;UserSession();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;userSession.setUserCode(sysUserCode);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;userSession.setUserName(sysUser_.getUserName());
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;userSession.setComCode(sysUser_.getSysCompany().getComCode());
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;userSession.setComCname(sysUser_.getSysCompany().getComCname());
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;userSession.setAreaCode(sysUser_.getSysCompany().getSysArea().getAreaCode());
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;userSession.setComType(sysUser_.getSysCompany().getComType());
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;userSession.setComLevel(sysUser_.getSysCompany().getComLevel());
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;userSession.setFuncPowers(funcPowersMap);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//用户信息放入session
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ActionContext.getContext().getSession().put(AppConst.USER_SESSION_ID,&nbsp;userSession);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//释放map引用
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;funcPowersMap&nbsp;=&nbsp;null;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//打印日志
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;StringBuffer&nbsp;infoBuffer&nbsp;=&nbsp;new&nbsp;StringBuffer();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;infoBuffer.append(&quot;【用户登录】&nbsp;机构代码:&nbsp;&quot;);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;infoBuffer.append(userSession.getComCode());
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;infoBuffer.append(&quot;&nbsp;用户代码:&nbsp;&quot;);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;infoBuffer.append(userSession.getUserCode());
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;infoBuffer.append(&quot;&nbsp;(&quot;);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;infoBuffer.append(userSession.getUserName());
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;infoBuffer.append(&quot;)&nbsp;登录时间:&nbsp;&quot;);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;infoBuffer.append(new&nbsp;DateTime(DateTime.current(),&nbsp;DateTime.YEAR_TO_SECOND));
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;infoBuffer.append(&quot;&nbsp;登录成功！&quot;);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;log.info(infoBuffer.toString());
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;SUCCESS;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.exceptionMessage.setClassName(this.getClass().getName());
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.exceptionMessage.setMessage(&quot;密码不正确！&quot;);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;log.info(&quot;密码不正确！&quot;);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;ERROR;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(Exception&nbsp;e)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//返回异常信息
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.exceptionMessage.setError(e.toString());
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.exceptionMessage.setClassName(this.getClass().getName());
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.exceptionMessage.setMessage(&quot;用户登录出现异常！&quot;);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;log.info(e.toString());
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;ERROR;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;}</pre> 
<p></p> 
<p><img src="http://static.oschina.net/uploads/space/2014/0514/182616_aUFg_225084.jpg" /></p> 
<p><span style="font-family:宋体">业务系统总</span>filter <span style="font-family:宋体">在</span>web.xml<span style="font-family:宋体">文件中配置方法</span>:</p> 
<pre class="brush:xml;toolbar: true; auto-links: false;">&nbsp;&lt;!--&nbsp;实现单点登录Fileter&nbsp;start--&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;filter&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;filter-name&gt;SSOFilter&lt;/filter-name&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;filter-class&gt;SSO.SSOFilter&lt;/filter-class&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;init-param&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;param-name&gt;cookieName&lt;/param-name&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;param-value&gt;hzpCookies&lt;/param-value&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/init-param&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;init-param&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;param-name&gt;ssoServiceURL&lt;/param-name&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;param-value&gt;http://192.168.61.124:8080/SSOAuth_v1.0.0/&lt;/param-value&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/init-param&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;init-param&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;param-name&gt;ssoLoginPage&lt;/param-name&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;param-value&gt;http://192.168.61.124:8080/SSOAuth_v1.0.0/login.jsp&lt;/param-value&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/init-param&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/filter&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;filter-mapping&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;filter-name&gt;SSOFilter&lt;/filter-name&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;url-pattern&gt;/*&lt;/url-pattern&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/filter-mapping&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;!--&nbsp;实现单点登录Fileter&nbsp;end--&gt;</pre> 
<p></p> 
<p><span style="font-family:宋体">未通过认证，登录业务系统，跳转到单点登录认证。</span></p> 
<p>1、<span style="font:9px 'Times New Roman'">&nbsp; </span><span style="font-family:宋体">输入业务系统服务地址</span></p> 
<p>2、<span style="font:9px 'Times New Roman'">&nbsp; </span><span style="font-family:宋体">系统自动跳转到单点登录服务器，下边过程同上“直接登录单点登录认证系统流程”</span></p> 
<p><span style="font-family:宋体">其原理是通过</span>filter<span style="font-family:宋体">实现类中</span>dofilter<span style="font-family:宋体">方法进行过滤，判断用没有</span>Cookie<span style="font-family:宋体">，则进行跳转到单点登录认证界面。</span></p> 
<p><span style="font-family:宋体">过滤代码如下：</span></p> 
<pre class="brush:java;toolbar: true; auto-links: false;">//&nbsp;检查HTTP请求的head是否有需要的cookie
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Cookie[]&nbsp;diskCookies&nbsp;=&nbsp;request.getCookies();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(diskCookies&nbsp;!=&nbsp;null)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;log.info(&quot;【权限系统-用户认证过滤器】找到COOKIES&quot;);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(int&nbsp;i&nbsp;=&nbsp;0;&nbsp;i&nbsp;&lt;&nbsp;diskCookies.length;&nbsp;i++)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cookieValue&nbsp;=&nbsp;diskCookies[i].getValue();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;log.info(&quot;【权限系统-用户认证过滤器】COOKIES中找到用户标识:&quot;&nbsp;+&nbsp;diskCookies[i].getName()&nbsp;+&nbsp;&quot;=&quot;&nbsp;+&nbsp;cookieValue);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(SSO_AUTH.equals(diskCookies[i].getName()))&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result&nbsp;=&nbsp;SSOService(cookieValue);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(&quot;success&quot;.equals(result))&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;log.info(&quot;【通过单点登录服务器认证】&quot;);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;log.info(&quot;【未通过单点登录服务器认证】COOKIES认证失败&quot;);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;response.sendRedirect(ssoLoginPage);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;if&nbsp;(&quot;sso&quot;.equals(diskCookies[i].getName()))&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HttpSession&nbsp;session&nbsp;=&nbsp;&nbsp;request.getSession();&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;session.setAttribute(&quot;sso&quot;,&nbsp;cookieValue);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result&nbsp;=&nbsp;&quot;success&quot;;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;log.info(&quot;【权限系统-用户认证过滤器】未找到COOKIES&quot;);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;COOKIES效验,转到单点登录认证页面
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(result.equals(&quot;failed&quot;))&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;log.info(&quot;【权限系统-用户认证过滤器】COOKIES认证失败&quot;);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;response.sendRedirect(ssoLoginPage);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;效验成功并退出服务
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;if&nbsp;(result.equals(&quot;logout&quot;))&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;log.info(&quot;【权限系统-用户认证过滤器】退出登录&quot;);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//logoutService(cookieValue);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;response.sendRedirect(ssoLoginPage);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;效验成功
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;log.info(&quot;【权限系统-用户认证过滤器】认证成功&quot;);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Throwable&nbsp;problem&nbsp;=&nbsp;null;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;chain.doFilter(req,&nbsp;res);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(Throwable&nbsp;t)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;problem&nbsp;=&nbsp;t;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t.printStackTrace();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(problem&nbsp;!=&nbsp;null)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(problem&nbsp;instanceof&nbsp;ServletException)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;((ServletException)&nbsp;problem);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(problem&nbsp;instanceof&nbsp;IOException)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;((IOException)&nbsp;problem);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sendProcessingError(problem,&nbsp;res);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</pre> 
<p></p> 
<p><br /></p></div>
	      </div>
        <div class='blog'>
      <h2><a href="#top" class='top'>回到顶部</a><a name="blog_264045" href="https://my.oschina.net/u/225084/blog/264045">单点登录系统技术(SSO)梳理(一)</a></h2>
	  <div class='outline'>
	  <div class='date'>时间：2014-05-13 08:54:20</div>
	  <div class='catalog'>分类：web开发</div>
	  	  	  <div class='tags'>标签：单点登录,跨域,jsonp</div>	  	  	  </div>
      <div class='content'><h2>1、<span style="font:9px 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="font-family:宋体">概念</span></h2> 
<p><span style="font-family:宋体">单点登录概念：</span>Single Sign On<span style="font-family:宋体">，简称</span>SSO<span style="font-family:宋体">，即在多个应用系统中，用户只需要登录一次就可以访问所有相互信任的应用系统。</span></p> 
<h2>2、<span style="font:9px 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>SSO<span style="font-family:宋体">实现方法</span></h2> 
<p><span style="font-family:宋体">单点登录实现方法：</span></p> 
<p>1、<span style="font:9px 'Times New Roman'">&nbsp; </span><span style="font-family:宋体">例如：惠普灵越单点登录系统，只是通过向各个系统发送用户名和密码</span></p> 
<p>2、<span style="font:9px 'Times New Roman'">&nbsp; </span><span style="font-family:宋体">例如：例如淘宝、天猫大型网站所使用的</span>SSO<span style="font-family:宋体">技术，只要登录一个另一个关联网站就不用在登录。</span></p> 
<p><span style="font-family:宋体">案例实现说明：</span></p> 
<p><a href="http://blog.chinaunix.net/uid-25508399-id-3431705.html" rel="nofollow">http://blog.chinaunix.net/uid-25508399-id-3431705.html</a></p> 
<p><a href="http://developer.51cto.com/art/201104/255729.htm" rel="nofollow">http://developer.51cto.com/art/201104/255729.htm</a></p> 
<p><a href="http://blog.csdn.net/clh604/article/details/20365967" rel="nofollow">http://blog.csdn.net/clh604/article/details/20365967</a></p> 
<p>&nbsp;</p> 
<p><span style="font-family:宋体">单点登录网上有很多实现方法，例如：</span></p> 
<ul> 
 <li><p><span style="font-family:宋体">基于</span>cookies<span style="font-family:宋体">实现</span></p></li> 
 <li><p>Broker-based(<span style="font-family:宋体">基于经纪人</span>)</p></li> 
 <li><p>Agent-based(<span style="font-family:宋体">基于代理</span>)</p></li> 
 <li><p>Token-based</p></li> 
</ul> 
<p>&nbsp;</p> 
<p><span style="font-family:宋体">本次单点系统的是基于</span>Cookie<span style="font-family:宋体">技术实现的，但是使用</span>cookie<span style="font-family:宋体">存在两个大问题：</span></p> 
<p>1、<span style="font:9px 'Times New Roman'">&nbsp; </span><span style="font-family:宋体">由于</span>cookie<span style="font-family:宋体">是存储在客户端本地，所以在安全性是是存在问题。</span></p> 
<p style="text-indent:0"><span style="font-family:宋体">解决方法：通过对</span>cookie<span style="font-family:宋体">值进行加密操作。</span></p> 
<p>2、<span style="font:9px 'Times New Roman'">&nbsp; </span>Cookie<span style="font-family:宋体">本身是不能跨域的，这个问题难解决。</span></p> 
<p style="text-indent:0"><span style="font-family:宋体">解决方法：将</span>cookie<span style="font-family:宋体">结合</span>Ajax<span style="font-family:宋体">中的</span>jsonp<span style="font-family:宋体">协议。</span></p> 
<h2>3、<span style="font:9px 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>JSOP<span style="font-family:宋体">跨域原理</span></h2> 
<p style="text-indent:24px"><span style="font-family:宋体">利用在页面中创建</span>&lt;script&gt;<span style="font-family:宋体">节点的方法向不同域提交</span>HTTP<span style="font-family:宋体">请求的方法称为</span>JSONP<span style="font-family:宋体">，这项技术可以解决跨域提交</span>Ajax<span style="font-family:宋体">请求的问题。</span>JSONP<span style="font-family:宋体">的工作原理如下所述：</span></p> 
<p style="text-indent:24px"><span style="font-family:宋体">假设在</span>http://example1.com/index.jsp<span style="font-family:宋体">这个页面中向</span>http://example2.com/getinfo.jsp<span style="font-family:宋体">提交</span>GET<span style="font-family:宋体">请求，我们可以将下面的</span>JavaScript<span style="font-family:宋体">代码放在</span>http://example1.com/index.jsp<span style="font-family:宋体">这个页面中来实现：</span></p> 
<pre class="brush:js;toolbar: true; auto-links: false;">var&nbsp;eleScript=&nbsp;document.createElement(&quot;script&quot;);
eleScript.type&nbsp;=&nbsp;&quot;text/javascript&quot;;
eleScript.src&nbsp;=&nbsp;&quot;http://example2.com/getinfo.jsp&quot;;
document.getElementsByTagName(&quot;HEAD&quot;)[0].appendChild(eleScript);</pre> 
<p style="text-indent:28px"><span style="font-family:宋体">当</span>GET<span style="font-family:宋体">请求从</span>http://example2.com/getinfo.jsp<span style="font-family:宋体">返回时，可以返回一段</span>JavaScript<span style="font-family:宋体">代码，这段代码会自动执行，可以用来负责调用</span>http://example1.com/index.jsp<span style="font-family:宋体">页面中的一个</span>callback<span style="font-family:宋体">函数。</span></p> 
<p style="text-indent:28px">JSONP<span style="font-family:宋体">的<strong>优点</strong>是：它不像</span>XMLHttpRequest<span style="font-family:宋体">对象实现的</span>Ajax<span style="font-family:宋体">请求那样受到同源策略的限制；它的兼容性更好，在更加古老的浏览器中都可以运行，不需要</span>XMLHttpRequest<span style="font-family:宋体">或</span>ActiveX<span style="font-family:宋体">的支持；并且在请求完毕后可以通过调用</span>callback<span style="font-family:宋体">的方式回传结果。</span></p> 
<p style="text-indent:28px">JSONP<span style="font-family:宋体">的<strong>缺点</strong>则是：它只支持</span>GET<span style="font-family:宋体">请求而不支持</span>POST<span style="font-family:宋体">等其它类型的</span>HTTP<span style="font-family:宋体">请求；它只支持跨域</span>HTTP<span style="font-family:宋体">请求这种情况，不能解决不同域的两个页面之间如何进行</span>JavaScript<span style="font-family:宋体">调用的问题。</span></p> 
<p style="text-indent:28px">&nbsp;</p> 
<p><span style="font-family:宋体">下面我中点说明一下跨域问题：</span></p> 
<p><span style="font-family:宋体">什么是跨域：</span></p> 
<p><span style="font-size:14px;font-family:宋体">之所以会有跨域问题，产生的根本原因是浏览器的同源策略限制，理解同源策略的限制是指代码获得或者更改从一个域名下获取文件或者信息，也就是说我们请求地址必须和当前网站的地址相同。同源策略通过隔离来实现对资源的保护。</span></p></div>
	      </div>
        <div class='blog'>
      <h2><a href="#top" class='top'>回到顶部</a><a name="blog_228609" href="https://my.oschina.net/u/225084/blog/228609">ajax "SyntaxError: missing ; before statement"错误解决</a></h2>
	  <div class='outline'>
	  <div class='date'>时间：2014-04-29 18:35:08</div>
	  <div class='catalog'>分类：web开发</div>
	  	  	  <div class='tags'>标签：ajax,jsonp,SyntaxError,missing</div>	  	  	  </div>
      <div class='content'><p>前台页面：</p> 
<pre class="default prettyprint prettyprinted">$.ajax({
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;type:&nbsp;'GET',
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;url:&nbsp;url,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;async:&nbsp;false,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jsonpCallback:&nbsp;'jsonCallback',
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;contentType:&nbsp;&quot;application/json&quot;,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dataType:&quot;jsonp&quot;,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;success:&nbsp;function(json)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;alert(json);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;error:&nbsp;function(e)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;console.log(e.message);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});</pre> 
<p></p> 
<p>后台Servlet：</p> 
<pre class="brush:java;toolbar: true; auto-links: false;">JSONObject&nbsp;jsonObject&nbsp;=&nbsp;new&nbsp;JSONObject();
jsonObject.put(&quot;msg&quot;,&nbsp;&quot;hello&quot;);
response.setContentType(&quot;application/json&quot;);
response.setCharacterEncoding(&quot;UTF-8&quot;);&nbsp;&nbsp;
response.setHeader(&quot;Cache-Control&quot;,&nbsp;&quot;no-cache&quot;);&nbsp;&nbsp;
response.getWriter().write(jsonObject.toString());
response.getWriter().flush();</pre> 
<p></p> 
<p>但是前台接受值的时候，通过firebug调试发现抛出“SyntaxError: missing ; before statement“，在百度上搜了半天也没有找到一个靠谱的方法，有好多帖子说是URL问题，但是我肯定URL没有问题。后来转而用google，一下就找到问题根源了，嗨... ... 差距啊，还是推荐使用google。</p> 
<p>参考网址：<br /></p> 
<p>http://stackoverflow.com/questions/20658674/syntaxerror-missing-before-statement-jquery-jsonp</p> 
<p><br /></p> 
<p>解决方法：</p> 
<p>将 dataType:&quot;jsonp&quot; 这个属性去掉就可以啦，具体原因还没有查，下班了，明日继续刨根问底。<br /></p> 
<pre class="brush:js;toolbar: true; auto-links: false;">$.ajax({
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;type:&nbsp;'GET',
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;url:&nbsp;url,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;contentType:&nbsp;&quot;application/json&quot;,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;success:&nbsp;function(json)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;alert(json);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;error:&nbsp;function(e)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;console.log(e.message);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}});</pre> 
<p></p> 
<p><br /></p></div>
	      </div>
        <div class='blog'>
      <h2><a href="#top" class='top'>回到顶部</a><a name="blog_215673" href="https://my.oschina.net/u/225084/blog/215673">Kettle 学习知识总结（三）</a></h2>
	  <div class='outline'>
	  <div class='date'>时间：2014-04-03 08:55:28</div>
	  <div class='catalog'>分类：Kettle</div>
	  	  	  	  	  </div>
      <div class='content'><p>接kettle学习知识总结（一）<br /></p> 
<p>【注意事项】<br /></p> 
<p>1、<span style="font:9px 'Times New Roman'">&nbsp; </span><span style="font-family:宋体">如果</span>kettle <span style="font-family:宋体">转化过程中，要将一张表中数据转化到另一张不同的数据结构表中，最好在进行“表输入”或者“插入</span>/<span style="font-family:宋体">更新”前加入字段选择插件，通过字段选择中的“列映射”，将</span>A<span style="font-family:宋体">表中同类型字段映射到</span>B<span style="font-family:宋体">表中。</span></p> 
<p><img src="http://static.oschina.net/uploads/space/2014/0403/085154_92uN_225084.jpg" /></p> 
<p><br /></p> 
<p><span style="font-size:14px;font-family:宋体">2、如果要在</span><span style="font-size:14px;font-family:'Calibri','sans-serif'">SQL</span><span style="font-size:14px;font-family:宋体">语句中引用系统变量使用</span><strong><span style="font-size:14px;font-family:'Calibri','sans-serif'">${xxx}</span></strong><span style="font-size:14px;font-family:宋体">形式，此外还要将“替换</span><span style="font-size:14px;font-family:'Calibri','sans-serif'">SQL</span><span style="font-size:14px;font-family:宋体">语句中里的变量”复选框勾选上，这样在执行的过程中才能正确替换系统变量。</span></p> 
<p><span style="font-size:14px;font-family:宋体"><img src="http://static.oschina.net/uploads/space/2014/0403/085235_ZF89_225084.jpg" /></span></p> 
<p><br /><span style="font-size:14px;font-family:宋体"></span></p> 
<p><span style="font-size:14px;font-family:宋体"></span></p> 
<p>3、<span style="font:9px 'Times New Roman'">&nbsp; </span><span style="font-family:宋体">如果在</span>js<span style="font-family:宋体">脚本中系统自带函数不会使用，可以通过鼠标右键点击“</span>Sample<span style="font-family:宋体">”产看函数实例。</span></p> 
<p><img src="http://static.oschina.net/uploads/space/2014/0403/085320_bsM8_225084.jpg" /></p> 
<p><br /></p> 
<p><span style="font-size:14px;font-family:宋体">4、在</span><span style="font-size:14px;font-family:'Calibri','sans-serif'">kettle</span><span style="font-size:14px;font-family:宋体">开发过程中，尽量使用相对路径，而不是用绝对路径，并将路径参数设置到系统的变量中，这样即便后期对目录结构造成较大的改动，只会对</span><span style="font-size:14px;font-family:'Calibri','sans-serif'">kettle</span><span style="font-size:14px;font-family:宋体">代码产生较小的影响。</span><br /></p> 
<p><br /></p> 
<p>5、<span style="font-size:14px;font-family:宋体">如果相对已经设置好的表输出——</span><span style="font-size:14px;font-family:'Calibri','sans-serif'">Database field</span><span style="font-size: 14px;font-family:宋体">进行设置，首先要将“</span><span style="font-size:14px;font-family:'Calibri','sans-serif'">Specify database fields</span><span style="font-size:14px;font-family:宋体">”复选框进行选中。才能修改。</span></p> 
<p><span style="font-size:14px;font-family:宋体"><img src="http://static.oschina.net/uploads/space/2014/0403/085432_58vf_225084.jpg" /></span></p> 
<p><span style="font-size:14px;font-family:宋体"><br /></span></p> 
<p><span style="font-size:14px;font-family:宋体"></span></p> 
<p>6、<span style="font:9px 'Times New Roman'">&nbsp; </span><span style="font-family:宋体">表输出中“剪裁表”复选框，作用相对先将表中原有内容全部清除，然后重新添加数据。</span></p> 
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p> 
<p>7、<span style="font:9px 'Times New Roman'">&nbsp; </span><span style="font-family:宋体">如果想将日志输出到</span>kettle<span style="font-family:宋体">日志控制台中，要使用</span>utility<span style="font-family:宋体">中的“</span>write to log<span style="font-family:宋体">”工具。否者将不能打印各个步骤执行过程中的步骤。</span></p> 
<p>&nbsp;</p> 
<p>8、<span style="font:9px 'Times New Roman'">&nbsp; </span><span style="font-family:宋体">对于“插入</span>/<span style="font-family:宋体">更新”插件</span></p> 
<p><span style="font-family:宋体">如果不填写查询关键字参数，既可以实现插入操作</span></p> 
<p><span style="font-family:宋体">如果填写查询关键字插件，实现的根据查询条件更新数据（注：必须将“</span><strong>update</strong><span style="font-family:宋体">”属性设置为“</span><strong>Y</strong><span style="font-family:宋体">”）</span></p> 
<p>&nbsp;</p> 
<p>9、<span style="font:9px 'Times New Roman'">&nbsp; </span><span style="font-family:宋体">对于</span>kettle<span style="font-family:宋体">中定时插件，在执行时会一直占用某个</span>shell<span style="font-family:宋体">，只有当执行完成之后</span>kettle<span style="font-family:宋体">的定时器才会退出。所以我们在项目中使用</span>linux <span style="font-family:宋体">定时插件</span>Crontab<span style="font-size:14px;font-family:宋体">。</span><br /></p></div>
	      </div>
        <div class='blog'>
      <h2><a href="#top" class='top'>回到顶部</a><a name="blog_215672" href="https://my.oschina.net/u/225084/blog/215672">Linux 定时插件Crontab</a></h2>
	  <div class='outline'>
	  <div class='date'>时间：2014-04-03 08:49:02</div>
	  <div class='catalog'>分类：shell编程</div>
	  	  	  <div class='tags'>标签：linux,Crontab</div>	  	  	  </div>
      <div class='content'><p><span style="font-family:宋体">【</span><strong>Linux </strong><strong><span style="font-family:宋体">定时插件</span>Crontab</strong><span style="font-family:宋体">】</span></p> 
<p style="margin-left:10px;text-align:left"><span style="color:black">-e : </span><span style="font-family:宋体;color:black">执行文字编辑器来设定时程表，内定的文字编辑器是</span><span style="color:black"> VI</span><span style="font-family:宋体;color:black">，如果你想用别的文字编辑器，则请先设定</span><span style="color:black"> VISUAL </span><span style="font-family:宋体;color:black">环境变数来指定使用那个文字编辑器</span><span style="color:black">(</span><span style="font-family:宋体;color:black">比如说</span><span style="color:black"> setenv VISUAL joe) </span></p> 
<p style="margin-left:10px;text-align:left"><span style="color:black">-r : </span><span style="font-family:宋体;color:black">删除目前的时程表</span><span style="color:black"> </span></p> 
<p style="margin-left:10px;text-align:left"><span style="color:black">-l : </span><span style="font-family:宋体;color:black">列出目前的时程表</span><span style="font-family:宋体">用户所建立的</span>Crontab<span style="font-family:宋体">文件存于</span>/var/spool/cron<span style="font-family:宋体">中，其文件名与用户名一致。</span></p> 
<p style="text-align:left;text-indent:14px"><span style="font-family:宋体">它的格式共分为六段，前五段为时间设定段，第六段为所要执行的命令段，</span></p> 
<p style="text-align:left;text-indent:0"><span style="font-family:宋体">格式如下：</span><span style="color:black">f1 f2 f3 f4 f5 program</span></p> 
<p style="text-align:left">第一段<span style="font:9px 'Times New Roman'">&nbsp;&nbsp; </span><span style="font-family:宋体">代表分钟</span> 0—59</p> 
<p style="text-align:left">第二段<span style="font:9px 'Times New Roman'">&nbsp;&nbsp; </span><span style="font-family:宋体">代表小时</span> 0—23</p> 
<p style="text-align:left">第三段<span style="font:9px 'Times New Roman'">&nbsp;&nbsp; </span><span style="font-family:宋体">代表日期</span> 1—31</p> 
<p style="text-align:left">第四段<span style="font:9px 'Times New Roman'">&nbsp;&nbsp; </span><span style="font-family:宋体">代表月份</span> 1—12</p> 
<p style="text-align:left">第五段<span style="font:9px 'Times New Roman'">&nbsp;&nbsp; </span><span style="font-family:宋体">代表星期几，</span>0<span style="font-family:宋体">代表星期日</span> 0—6</p> 
<p><br /></p></div>
	      </div>
        <div class='blog'>
      <h2><a href="#top" class='top'>回到顶部</a><a name="blog_215671" href="https://my.oschina.net/u/225084/blog/215671">Kettle 学习知识总结（二）</a></h2>
	  <div class='outline'>
	  <div class='date'>时间：2014-04-03 08:47:27</div>
	  <div class='catalog'>分类：Kettle</div>
	  	  	  <div class='tags'>标签：kettle,循环控制</div>	  	  	  </div>
      <div class='content'><p><span style="font:9px 'Times New Roman'"></span>kettle<span style="font-family:宋体">循环控制方式设置：</span></p> 
<p><span style="font-family:宋体"><img src="http://static.oschina.net/uploads/space/2014/0403/084414_LKHg_225084.jpg" /><br /></span></p> 
<p><span style="font-family:宋体"><span style="font-size:14px;font-family:'Calibri','sans-serif'">Select_Count_IALClaim_TRG </span><span style="font-size:14px;font-family: 宋体">转化内容如下图：将所有的表输入的查询结果复制到结果中。</span><br /></span></p> 
<p><span style="font-family:宋体"><img src="http://static.oschina.net/uploads/space/2014/0403/084514_EtTZ_225084.jpg" /><br /></span></p> 
<p><span style="font-family:宋体"><img src="http://static.oschina.net/uploads/space/2014/0403/084549_6aIP_225084.jpg" /><br /></span></p> 
<p><span style="font-family:宋体"><span style="font-size:14px;font-family:宋体">循环控制器配置，如图：</span><br /></span></p> 
<p><span style="font-family:宋体"><img src="http://static.oschina.net/uploads/space/2014/0403/084640_8T0q_225084.jpg" /><br /></span></p> 
<p><span style="font-family:宋体"></span></p> 
<p>Deal_IALClaim_fr_IALClaim_TRG <span style="font-family:宋体">转化步骤，为要循环体中主要循环执行的内容</span><br /></p> 
<p><br /></p></div>
	      </div>
        <div class='blog'>
      <h2><a href="#top" class='top'>回到顶部</a><a name="blog_213454" href="https://my.oschina.net/u/225084/blog/213454">SQL  case when 语句学习</a></h2>
	  <div class='outline'>
	  <div class='date'>时间：2014-03-27 17:08:05</div>
	  <div class='catalog'>分类：数据库</div>
	  	  	  <div class='tags'>标签：case,when,sql</div>	  	  	  </div>
      <div class='content'><p>刚刚同时跑来问我一个sql语句顿时，一看我有点蒙，因为之前没有用过，所以在这里写下学习笔记加深印象。<br />语法如下：<br /></p> 
<pre class="brush:sql;toolbar: true; auto-links: false;">CASE&nbsp;value&nbsp;WHEN&nbsp;[compare-value01]&nbsp;THEN&nbsp;result01&nbsp;[WHEN&nbsp;[compare-value02]&nbsp;THEN&nbsp;result01&nbsp;...]&nbsp;[ELSE&nbsp;result]&nbsp;END</pre> 
<p></p> 
<p>此sql语句我认为有点像条件语句。<br />意思是：<br />&nbsp;&nbsp; &nbsp;条件一，当字段value的值等于&quot;compare-value&quot;时,赋值为result01；<br />&nbsp;&nbsp; &nbsp;条件二，当字段value的值等于&quot;compare-value&quot;时,赋值为result02；<br />&nbsp;&nbsp; &nbsp;...<br />&nbsp;&nbsp; &nbsp;条件N，,赋值为result02；<br />&nbsp;&nbsp; &nbsp;结束</p> 
<p>这么说肯定感觉很抽象，上实例，一看就明白了。</p> 
<p>usersa表及数据如下图</p> 
<p><img src="http://static.oschina.net/uploads/space/2014/0327/165826_EIfi_225084.jpg" /></p> 
<p>样例1查询SQL</p> 
<pre class="brush:sql;toolbar: true; auto-links: false;">select&nbsp;*,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(CASE&nbsp;username&nbsp;WHEN&nbsp;&quot;李四&quot;&nbsp;THEN&nbsp;&quot;四&quot;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;&quot;张三&quot;&nbsp;&nbsp;THEN&nbsp;&quot;三&quot;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE&nbsp;'more'&nbsp;END&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)as&nbsp;&quot;Column&quot;
FROM&nbsp;usersa;</pre> 
<p></p> 
<p>查询结果图</p> 
<p><img src="http://static.oschina.net/uploads/space/2014/0327/170622_ahgz_225084.jpg" /></p> 
<p>样例2查询SQL<br /></p> 
<pre class="brush:sql;toolbar: true; auto-links: false;">select&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sex,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;count(case&nbsp;username&nbsp;when&nbsp;&quot;李四&quot;&nbsp;then&nbsp;&quot;李四&quot;&nbsp;end)&nbsp;as&nbsp;&quot;李四&quot;,&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;count(case&nbsp;username&nbsp;when&nbsp;&quot;张三&quot;&nbsp;then&nbsp;&quot;张三&quot;&nbsp;end)&nbsp;as&nbsp;&quot;张三&quot;&nbsp;
from&nbsp;usersa&nbsp;
group&nbsp;by&nbsp;sex;</pre> 
<p></p> 
<p>查询结果图</p> 
<p><img src="http://static.oschina.net/uploads/space/2014/0327/170107_TcRJ_225084.jpg" /></p> 
<p>【参考资料】</p> 
<p><span style="text-decoration: underline;">http://www.jb51.net/article/28222.htm</span></p></div>
	      </div>
        <div class='blog'>
      <h2><a href="#top" class='top'>回到顶部</a><a name="blog_213292" href="https://my.oschina.net/u/225084/blog/213292">Junit 4 学习笔记（四、Junit Parameters）</a></h2>
	  <div class='outline'>
	  <div class='date'>时间：2014-03-27 13:14:51</div>
	  <div class='catalog'>分类：Junit</div>
	  	  	  <div class='tags'>标签：Junit,Paramter</div>	  	  	  </div>
      <div class='content'><p>@Parameters<span style="font-family: 宋体">：用于</span>JUnit<span style="font-family:宋体">的参数化功能，用来标记准备数据的方法。</span></p> 
<p><span style="font-family:宋体">注意：该方法需要满足一定的要求：</span> </p> 
<p>(1)<span style="font-family:宋体">该方法必须为</span><strong>public static</strong><span style="font-family:宋体">的</span></p> 
<p>(2)<span style="font-family:宋体">该方法返回值必须为</span><strong>java.util.Collection</strong><span style="font-family:宋体">类型</span> </p> 
<p>(3)<span style="font-family:宋体">该方法的名字不做要求</span> </p> 
<p>(4)<span style="font-family:宋体">该方法<strong>没有参数</strong></span></p> 
<pre class="brush:java;toolbar: true; auto-links: false;">@RunWith(Parameterized.class&nbsp;)
public&nbsp;class&nbsp;TestDemoParamter&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;String&nbsp;target;
&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;String&nbsp;except;
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;@Parameters
&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;Collection&nbsp;setParam()&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;Arrays.asList(new&nbsp;Object[][]&nbsp;{&nbsp;{&nbsp;&quot;emplee_info&quot;,&nbsp;&quot;empleeInfo&quot;&nbsp;},&nbsp;//&nbsp;测试正常情况
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;null,&nbsp;null&nbsp;},&nbsp;//&nbsp;测试null时处理情况
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&quot;&quot;,&nbsp;&quot;&quot;&nbsp;},&nbsp;//&nbsp;测试空字符串的情况
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&quot;employee_info&quot;,&nbsp;&quot;EmployeeInfo&quot;&nbsp;},&nbsp;//&nbsp;测试当首字母大写时的情况
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&quot;employee_info_a&quot;,&nbsp;&quot;employeeInfoA&quot;&nbsp;},&nbsp;//&nbsp;测试当尾字母为大写时的情况
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&quot;employee_a_info&quot;,&nbsp;&quot;employeeAInfo&quot;&nbsp;}&nbsp;//&nbsp;测试多个相连字母大写时的情况
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});
&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;/**
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;参数化测试必须的构造函数
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;expected&nbsp;期望的测试结果&nbsp;，对应参数集中的第一个参数
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;target&nbsp;测试数据，对应结果集中的第二个参数
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/
&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;TestDemoParamter(String&nbsp;target,&nbsp;String&nbsp;except)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.except&nbsp;=&nbsp;except;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.target&nbsp;=&nbsp;target;
&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;@Test
&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;testParam(){
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Assert.assertEquals(except,&nbsp;target);
&nbsp;&nbsp;&nbsp;&nbsp;}
}</pre></div>
	      </div>
        <div class='blog'>
      <h2><a href="#top" class='top'>回到顶部</a><a name="blog_213267" href="https://my.oschina.net/u/225084/blog/213267">Junit 4 学习笔记（三、测试套件TestSuite）</a></h2>
	  <div class='outline'>
	  <div class='date'>时间：2014-03-27 12:07:22</div>
	  <div class='catalog'>分类：Junit</div>
	  	  	  <div class='tags'>标签：Junit4,TestSuite</div>	  	  	  </div>
      <div class='content'><p><span style="font-size:13px;font-family:宋体">在实际项目中，随着项目进度的开展，单元测试类会越来越多，可是直到现在我们还只会一个一个的单独运行测试类，这在实际项目实践中肯定是不可行的。为了解决这个问题，</span><span style="font-size:13px;font-family:'Verdana','sans-serif'">JUnit </span><span style="font-size:13px;font-family:宋体">提供了一种批量运行测试类的方法，叫做测试套件（</span><span style="font-size:13px;font-family:'Verdana','sans-serif'">TestSuite</span><span style="font-size:13px;font-family:宋体">）。这样，每次需要验证系统功能正确性时，只执行一个或几个测试套件便可以了。</span><strong><span style="font-family:宋体"><br /></span></strong></p> 
<p><strong><span style="font-family:宋体">一种是类似</span>Junit3</strong><strong><span style="font-family:宋体">的方法</span></strong><span style="font-family: 宋体">：</span></p> 
<pre class="brush:java;toolbar: true; auto-links: false;">public&nbsp;class&nbsp;TestSuite1&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;/**
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;测试TestSuite&nbsp;类似Junit3
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;TestSuite
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/
&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;TestSuite&nbsp;testSuite(){
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TestSuite&nbsp;testSuite&nbsp;=&nbsp;new&nbsp;TestSuite(&quot;aa&quot;);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;testSuite.addTest(new&nbsp;JUnit4TestAdapter(Test.class));
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;testSuite.addTest(new&nbsp;JUnit4TestAdapter(TestDemo01.class));
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;testSuite;
&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;void&nbsp;main(String[]&nbsp;args)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;junit.textui.TestRunner.run(TestSuiteDemo.testSuite());
&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;
}</pre> 
<p></p> 
<p><span style="font-size:13px;font-family:'Courier New';color:black"></span></p> 
<p>Junit3<span style="font-family:宋体">中是直接test</span>Suite.addTest(Test1.class)<span style="font-family:宋体">，</span>Junit4<span style="font-family:宋体">中需要用</span>JUnit4TestAdapter<span style="font-family:宋体">来转换一下。</span>TestSuite<span style="font-family:宋体">中也可以添加</span>TestSuite<span style="font-family:宋体">，方法是一样的，即testS</span>uite.addTest(new JUnit4TestAdapter(TestDemo01.class));</p> 
<p><br /></p> 
<p><strong><span style="font-family:宋体">另一种是使用标注的方法</span></strong><span style="font-family:宋体">：</span></p> 
<p><span style="font-size:13px;font-family:宋体">创建一个空类作为测试套件的入口。</span> <span style="font-size:13px;font-family:宋体">使用注解</span><span style="font-size:13px;font-family:'Verdana','sans-serif'"> org.junit.runner.RunWith </span><span style="font-size:13px;font-family:宋体">和</span><span style="font-size:13px;font-family:'Verdana','sans-serif'"> org.junit.runners.Suite.SuiteClasses </span><span style="font-size:13px;font-family:宋体">修饰这个空类。将</span><span style="font-size:13px;font-family:'Verdana','sans-serif'"> org.junit.runners.Suite </span><span style="font-size:13px;font-family:宋体">作为参数传入注解</span><span style="font-size:13px;font-family:'Verdana','sans-serif'"> RunWith</span><span style="font-size:13px;font-family:宋体">，以提示</span><span style="font-size:13px;font-family:'Verdana','sans-serif'"> JUnit </span><span style="font-size:13px;font-family:宋体">为此类使用套件运行器执行。</span> </p> 
<p><span style="font-size:13px;font-family:宋体">将需要放入此测试套件的测试类组成数组作为注解</span><span style="font-size:13px;font-family:'Verdana','sans-serif'"> SuiteClasses </span><span style="font-size:13px;font-family:宋体">的参数。</span> <span style="font-size:13px;font-family:宋体">保证这个空类</span><strong><span style="font-size:13px;font-family:宋体">使用</span><span style="font-size:13px;font-family:'Verdana','sans-serif'"> public </span><span style="font-size:13px;font-family:宋体">修饰</span></strong><span style="font-size:13px;font-family:宋体">，而且存在公开的<strong>不带有任何参数的构造函数</strong>。</span></p> 
<pre class="brush:java;toolbar: true; auto-links: false;">@RunWith(Suite.class[)
@SuiteClasses({TestWordDealUtil.class,...&nbsp;})
public&nbsp;class&nbsp;TestBatch&nbsp;{

}</pre></div>
	      </div>
        <div class='blog'>
      <h2><a href="#top" class='top'>回到顶部</a><a name="blog_213266" href="https://my.oschina.net/u/225084/blog/213266">Junit 4 学习笔记（二、assert方法的分类）</a></h2>
	  <div class='outline'>
	  <div class='date'>时间：2014-03-27 12:01:06</div>
	  <div class='catalog'>分类：Junit</div>
	  	  	  <div class='tags'>标签：Junit4,Assert</div>	  	  	  </div>
      <div class='content'><p><strong><span style="font:9px 'Times New Roman'">&nbsp;&nbsp; </span></strong><span style="font-size: 12px;">1、</span>assertTrue/False([String message,]boolean condition);</p> 
<p><span style="font-family:宋体">用来查看变量是是否为</span>false<span style="font-family:宋体">或</span>true<span style="font-family:宋体">，如果</span>assertFalse()<span style="font-family:宋体">查看的变量的值是</span>false<span style="font-family:宋体">则测试成功，如果是</span>true<span style="font-family:宋体">则失败，</span>assertTrue()<span style="font-family:宋体">与之相反；</span></p> 
<p>&nbsp;</p> 
<p>2、fail([String message,]);</p> 
<p><span style="font-family:宋体">直接用来抛出错误。</span></p> 
<p>&nbsp;</p> 
<p>3、assertEquals([String message,]Object expected,Object actual);</p> 
<p><span style="font-family:宋体">判断是否相等，可以指定输出错误信息。</span></p> 
<p><span style="font-family:宋体">第一个参数是期望值，第二个参数是实际的值。</span></p> 
<p><span style="font-family:宋体">这个方法对各个变量有多种实现</span></p> 
<p>&nbsp;</p> 
<p>4、assertNotNull/Null([String message,]Object obj);</p> 
<p><span style="font-family:宋体">判读一个对象是否非空</span>(<span style="font-family:宋体">非空</span>)<span style="font-family:宋体">。</span></p> 
<p>&nbsp;</p> 
<p>5、assertSame/NotSame([String message,]Object expected,Object actual);</p> 
<p><span style="font-family:宋体">判断两个对象是否指向同一个对象。看内存地址。</span></p> 
<p>&nbsp;</p> 
<p>6、failNotSame/failNotEquals(String message, Object expected, Object actual)</p> 
<p><span style="font-family:宋体">当不指向同一个内存地址或者不相等的时候，输出错误信息。</span></p> 
<p><span style="font-family:宋体">注意信息是必须的，而且这个输出是格式化过的。</span></p></div>
	      </div>
        <div class='blog'>
      <h2><a href="#top" class='top'>回到顶部</a><a name="blog_213261" href="https://my.oschina.net/u/225084/blog/213261">Junit 4 学习笔记（一、注释学习）</a></h2>
	  <div class='outline'>
	  <div class='date'>时间：2014-03-27 11:57:05</div>
	  <div class='catalog'>分类：Junit</div>
	  	  	  <div class='tags'>标签：Junit4,annotation</div>	  	  	  </div>
      <div class='content'><p>1.@Before:</p> 
<p><span style=";font-family:宋体">表示该方法在每个测试方法执行前执行一次，可用于一些初始工作。</span></p> 
<p>&nbsp;</p> 
<p>2.@BeforeClass:</p> 
<p><span style=";font-family:宋体">该方法在所有测试方法运行前运行，且只运行一次</span>,<span style=";font-family:宋体">添加该注释的方法必须修饰为</span> public static void <span style=";font-family:宋体">且没有参数。</span></p> 
<p>&nbsp;</p> 
<p>3.<a href="http://my.oschina.net/azibug" target="_blank" rel="nofollow">@Test</a> : <span style=";font-family:宋体">表示测试方法。</span></p> 
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <strong><span style="font-family:宋体;color:red">注意：</span></strong><span style=";font-family:'Arial','sans-serif'">&nbsp;&nbsp;&nbsp;&nbsp;</span></p> 
<p><span style=";font-family:'Arial','sans-serif'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1</span><span style=";font-family:宋体">．测试方法必须使用注解</span><span style=";font-family:'Arial','sans-serif'"> org.junit.Test </span><span style=";font-family:宋体">修饰。</span> </p> 
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=";font-family:'Arial','sans-serif'">2</span><span style=";font-family:宋体">．测试方法必须使用</span><span style=";font-family:'Arial','sans-serif'"> public void </span><span style=";font-family:宋体">修饰，而且不能带有任何参数。</span></p> 
<p><span style=";font-family:宋体"><span style=";font-family:宋体">该方法有两个属性</span>：</span></p> 
<p>&nbsp; a: expected :<span style=";font-family:宋体">该属性表示测试方法必须抛出一个异常，且异常的类型必须是该属性要求的类型，否则表示测试方法失败。也叫做异常测试。</span></p> 
<p>&nbsp; <span style=";font-family:宋体">例如：</span>@Test(expected=IndexOutOfBoundsException.class)</p> 
<p>&nbsp; b:timeout <span style=";font-family: 宋体">用于超时测试，表示该测试方法的执行时间如果超过了要求的时间则失败</span> <span style=";font-family:宋体">单位为毫秒</span></p> 
<p>&nbsp; <span style=";font-family:宋体">例如：</span>@Test(timeout=100)</p> 
<p>&nbsp;</p> 
<p>4.<a href="http://my.oschina.net/u/150077" target="_blank" rel="nofollow">@Ignore</a> <span style=";font-family:宋体">：</span></p> 
<p><span style=";font-family:宋体">表示会被忽略的测试方法</span></p> 
<p>&nbsp;</p> 
<p>5.<a href="http://my.oschina.net/u/45139" target="_blank" rel="nofollow">@After</a> <span style=";font-family:宋体">：</span></p> 
<p><span style=";font-family:宋体">被注释的方法会在每个测试方法执行完成之后执行一次，如果其它的方法抛出了异常，该方法同样会被执行。主要用于释放在</span>@Before<span style=";font-family:宋体">方法中初始化的资源。</span></p> 
<p>&nbsp;</p> 
<p>6.@AfterClass<span style=";font-family:宋体">：</span></p> 
<p><span style=";font-family:宋体">功能同</span><a href="http://my.oschina.net/u/45139" target="_blank" rel="nofollow">@After</a> <span style=";font-family:宋体">，只不过是该方法释放的是</span>@BeforeClass<span style=";font-family:宋体">方法初始化的资源。且在所有的测试方法执行完成之后，只执行一次。</span></p> 
<p>&nbsp;</p> 
<p>7.@Runwith<span style="font-family:宋体">：</span></p> 
<p><span style="font-family:宋体">测试运行器，放在测试类名之前，用来确定测试类怎么运行的，当不指定这个注解时，使用默认</span>Runner<span style="font-family:宋体">来运行测试代码，即</span>@RunWith(JUnit4.class)<span style="font-family:宋体">。常见的运行器有：</span></p> 
<p>(1)@RunWith(Parameterized.class)<span style="font-family: 宋体">：参数化运行器，配合</span>@Parameters<span style="font-family:宋体">使用</span>JUnit<span style="font-family:宋体">的参数化功能。</span></p> 
<p>(2)@RunWith(Suite.class)</p> 
<p>&nbsp;@SuiteClasses({ATest.class,BTest.class,CTest.class})</p> 
<p><span style="font-family:宋体">测试集运行器配合使用测试集功能。</span>&nbsp;&nbsp;&nbsp;</p> 
<p>(3)@RunWith(JUnit4.class)<span style="font-family:宋体">：</span>JUnit 4<span style="font-family:宋体">的默认运行器</span></p> 
<p>(4)@RunWith(JUnit38ClassRunner.class)<span style="font-family: 宋体">：用于兼容</span>junit3.8<span style="font-family:宋体">的运行器</span></p> 
<p><br /></p> 
<p>8.@Parameters<span style="font-family:宋体">：</span></p> 
<p><span style="font-family:宋体">用于</span>JUnit<span style="font-family:宋体">的参数化功能，用来标记准备数据的方法。</span></p> 
<p>&nbsp;</p> 
<p><span style=";font-family:宋体">一个</span>JUnit 4 <span style=";font-family:宋体">的单元测试用例执行顺序为：</span></p> 
<p>@BeforeClass –&gt; @Before –&gt; <a href="http://my.oschina.net/azibug" target="_blank" rel="nofollow">@Test</a> &nbsp;–&gt; <a href="http://my.oschina.net/u/45139" target="_blank" rel="nofollow">@After</a> &nbsp;–&gt; @AfterClass</p></div>
	      </div>
        <div class='blog'>
      <h2><a href="#top" class='top'>回到顶部</a><a name="blog_207215" href="https://my.oschina.net/u/225084/blog/207215">常用的js正则校验表达式</a></h2>
	  <div class='outline'>
	  <div class='date'>时间：2014-03-11 16:29:24</div>
	  <div class='catalog'>分类：web开发</div>
	  	  	  <div class='tags'>标签：js,正则</div>	  	  	  </div>
      <div class='content'><p>常用的js正则校验表达式，一为加深自己记忆，二供大家参考。</p> 
<p>正则非法字符串校验<br />var charCheck = /[&quot;~!@#%&amp;*`']/;<br /><br />正则整数校验<br />var integerCheck = /^[1-9]*[1-9][0-9]*$/&nbsp;&nbsp; //chenxiang<br /><br />正则url地址校验<br />var urlCheck = /(http[s]?|ftp):\/\/[^\/\.]+?\..+\w$/i;<br /><br />正则email地址校验<br />var emailCheck = /\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*/<br /></p> 
<p><br /></p> 
<p>【ps 其他blog几个写的不错的js】<br /></p> 
<p>js&nbsp; 车牌号校验<br />http://www.blogjava.net/weiwei/articles/401703.html<br /><br />js 身份证校验<br />http://www.cnblogs.com/shenliang123/archive/2012/04/05/2432880.html</p> 
<p><br /></p> 
<p><br /></p> 
<p><br /></p></div>
	      </div>
        <div class='blog'>
      <h2><a href="#top" class='top'>回到顶部</a><a name="blog_207192" href="https://my.oschina.net/u/225084/blog/207192">有趣的winodw.open方法</a></h2>
	  <div class='outline'>
	  <div class='date'>时间：2014-03-11 16:00:46</div>
	  <div class='catalog'>分类：web开发</div>
	  	  	  	  	  </div>
      <div class='content'><p>最近在学习致远的OA系统，发现系统中使用了一些有趣的window.open属性。其中的一些参数很有意思，之前没有注意过，找了一篇文章，写的不错，引用一下，加深印象。<br /><br /><span style="font-size: 18px;"><strong>winodw.open(url, name, features, replace)</strong></span><br />参数属性：<br /><strong>&nbsp;url：</strong> 一个可选的字符串，声明了要在新窗口中显示的文档的 URL。如果省略了这个参数，或者它的值是空字符串，那么新窗口就不会显示任何文档。&nbsp;</p> 
<p><br /><strong>name：</strong>一个可选的字符串，该字符串是一个由逗号分隔的特征列表，其中包括数字、字母和下划线，该字符声明了新窗口的名称。这个名称可以用作标记 &lt;a&gt; 和 &lt;form&gt; 的属性 target 的值。如果该参数指定了一个已经存在的窗口，那么 open() 方法就不再创建一个新窗口，而只是返回对指定窗口的引用。在这种情况下，features 将被忽略。&nbsp;</p> 
<p><br /><strong>features：</strong> 一个可选的字符串，声明了新窗口要显示的标准浏览器的特征。如果省略该参数，新窗口将具有所有标准特征。在窗口特征这个表格中，我们对该字符串的格式进行了详细的说明。&nbsp;</p> 
<p><br /><strong>replace：</strong> 一个可选的布尔值。规定了装载到窗口的 URL 是在窗口的浏览历史中创建一个新条目，还是替换浏览历史中的当前条目。支持下面的值：<br />&nbsp;&nbsp; &nbsp;•true - URL 替换浏览历史中的当前条目。 <br />&nbsp;&nbsp; &nbsp;•false - URL 在浏览历史中创建新的条目。 <br />&nbsp;<br />引自：http://blog.csdn.net/vastskyjoe/article/details/4122104</p></div>
	      </div>
        <div class='blog'>
      <h2><a href="#top" class='top'>回到顶部</a><a name="blog_191845" href="https://my.oschina.net/u/225084/blog/191845">Was(WebSphere)不能正常打印程序日志问题</a></h2>
	  <div class='outline'>
	  <div class='date'>时间：2014-01-09 18:56:47</div>
	  <div class='catalog'>分类：常见异常</div>
	  	  	  	  	  </div>
      <div class='content'><p> <span><span> </span></span> </p> 
<p> <span style="font-family:宋体;"> </span></p> 
<p> <span style="font-family:宋体;">【was日志配置】</span> </p> 
<p> <span style="font-family:宋体;">服务器 -- 服务器类型 ——webSphere Appliaction server -- 选择sever -- java和进程管理 -- 进程定义 -- java虚拟机 ，调整“<span style="font-family:宋体;"><span style="font-family:宋体;">通用</span><span>JVM</span><span style="font-family:宋体;">参数</span></span>”。<br /> </span> </p> 
<p> <span style="font-family:宋体;">例如</span><span>Log4j</span><span style="font-family:宋体;">日志变量名称为：打印目录为：</span> </p> 
<p> <span style="font-family:宋体;">则“通用</span><span>JVM</span><span style="font-family:宋体;">参数设置为”：</span><span>-Dfile.encoding=GBK -Ddefault.client.encoding=GBK -Dclient.encoding.override=GBK –Dlog4j.path.sinoiaciv23 =/opt/IBM/WebSphere/AppServer/profiles/iaContactSrv/log4j_xxx</span> </p> 
<p> <span style="font-family:宋体;color:red;">注：配置完日志目录后，要在服务器上建立与目录对应的文件夹</span><span style="color:red;">(mkdir /opt/IBM/WebSphere/AppServer/profiles/iaContactSrv/log4j_xxx)</span><span style="font-family:宋体;color:red;">，否则，日志会保存在根目录下。</span><span style="color:red;"></span> </p> 
<p></p> 
<p> <span style="font-family:宋体;"><br /> </span> </p> 
<p> <span style="font-family:宋体;">最近在搭建大连运维监控系统的过程中发现，</span><span>was</span><span style="font-family:宋体;">无法正常打印程序日志。</span> </p> 
<p> <span style="font-family:宋体;">【解决方法】<br /> </span> </p> 
<p> <span><span>1、<span>&nbsp; </span></span></span><span style="font-family:宋体;">检查</span><span>jvm</span><span style="font-family:宋体;">中的“调试参数”是否正确</span> </p> 
<p> <span><span>2、<span>&nbsp; </span></span></span><span style="font-family:宋体;">检查</span><span>jvm</span><span style="font-family:宋体;">中的“通用</span><span> JVM </span><span style="font-family:宋体;">参数”是否正确，并且确定已经在服务器中创建了此日志文件目录。</span> </p> 
<p> <span><span>3、<span>&nbsp; </span></span></span><span style="font-family:宋体;">打开</span><span>was</span><span style="font-family:宋体;">程序安装目录，找到</span><span>properties</span><span style="font-family:宋体;">文件夹，将</span><span>commons-logging.properties </span><span style="font-family:宋体;">拷贝到文件中，然后重启</span><span>server</span><span style="font-family:宋体;">。</span> </p></div>
	      </div>
        <div class='blog'>
      <h2><a href="#top" class='top'>回到顶部</a><a name="blog_188126" href="https://my.oschina.net/u/225084/blog/188126">程序员的吐槽</a></h2>
	  <div class='outline'>
	  <div class='date'>时间：2013-12-26 23:38:15</div>
	  <div class='catalog'>分类：日常记录</div>
	  	  	  	  	  </div>
      <div class='content'><p> 本人在A公司工作，公司主要业务跟保险行业有关，开发的程序大部分提供为各大保险公司。近日的在工作中发生的一些事，让我这个小程序员，让我感到及心酸又生气，所以特来次吐槽，可能现在借着点酒劲写的内容，会有些客观偏激。但是实在是太憋屈了，没办法就是想吐槽。欢迎板砖。 </p> 
<p> 事情是这样的，我们小组开发的程序是用来检测服务器的运行情况，我有幸分配到了程序的核心模块开发，经过三个月左右的设计、开发和测试工作整个程序基本上圆满了。领导让我我负责程序的搭建工作，这时在我看来噩梦才刚刚开始，程序开始上线了。可是到了生成环境，本身我们程序能够完全支持jdk1.5，可生产环境偏不这样，开始的时候给您来个jdk1.4，经过老大和客户协商后终于同意升级jdk，生就生吧？按说应该升级到jdk1.5，好达到“完美&quot;支持程序。可是人家偏不，直接来个1.6。没办法，出现了一些问题，那好吧改程序吧。 </p> 
<p> 按说对程序进行微调之后应该就可以正常上线了，但是这时程序又被客户的各种环境、权限进行了限制。这时程序与起初的设计有了较大的变化，导致问题出现了一大片，那好吧，我继续修改，这时已经做了将近三天的修改。心中是各种郁闷啊。这还没玩，改完之后，发现是“一波未平一波又起啊”。程序又开始出问题了，那继续改吧，在我便测试边改程序的同时，”事故“就这样发送了，mysql的数据库连接数因为我的程序达到了最大80，直接导致生产环境，其他程序或库无法访问数据库。领导发威了”我希望是就这一次，仅此一次 ... ...“。我去，为啥我费了这么大劲，花了将近一个星期的时间对程序修改。换了的是一个事故，领导的警告。 </p> 
<p> 出事就算我们这帮小兵程序员的头上，环境搭好了，领导收到客户和各种上级表扬、奖金。好人你们来当，出问题我们总是被先”捏死“的那个，你为啥不说是因为客户环境导致的程序现在这样问题啊。程序员，干的最多，拿的最少，程序出现bug问题，测试和运维人员就会各种理直气壮，指责程序各种不好，真是站着说话不腰疼啊。那里有十全十美的code啊。总之，这行真的很难干啊。 </p> 
<p> <span style="line-height:1.5;font-size:12.5px;">今天就先写到这吧，改日继续吐槽。</span> </p></div>
	      </div>
        <div class='blog'>
      <h2><a href="#top" class='top'>回到顶部</a><a name="blog_181021" href="https://my.oschina.net/u/225084/blog/181021">org.hibernate.exception.GenericJDBCException异常</a></h2>
	  <div class='outline'>
	  <div class='date'>时间：2013-12-03 12:10:42</div>
	  <div class='catalog'>分类：常见异常</div>
	  	  	  <div class='tags'>标签：GenericJDBCException,异常</div>	  	  	  </div>
      <div class='content'><p> org.hibernate.exception.GenericJDBCException异常 </p> 
<p> Caused by: java.net.ConnectException: Connection refused: connect </p> 有3种可能： 
<br /> 1.数据库没有启动 
<br /> 
<br /> 2.数据库连接url没写正确， 
<br /> 
<ul> 
 <li> ip地址; </li> 
</ul> 
<ul> 
 <li> 数据库名【数据库是否存在？还是名字写错】; </li> 
 <li> 检查用户名、密码是否正确; </li> 
</ul> 
<br /> 3.数据库连接驱动包不正确、不匹配，或者甚至没有。 
<br /> 检查lib目录下是否有对应数据库的jar包。</div>
	      </div>
        <div class='blog'>
      <h2><a href="#top" class='top'>回到顶部</a><a name="blog_181020" href="https://my.oschina.net/u/225084/blog/181020">sun.io.MalformedInputException  IBM Websphere 中间件异常</a></h2>
	  <div class='outline'>
	  <div class='date'>时间：2013-12-03 12:05:17</div>
	  <div class='catalog'>分类：常见异常</div>
	  	  	  <div class='tags'>标签：MalformedInputException,was,websphere</div>	  	  	  </div>
      <div class='content'>sun.io.MalformedInputException&nbsp; IBM Websphere 中间件异常 
<br /> 
<br /> 
<pre class="brush:xml; toolbar: true; auto-links: false;">[13-12-2 18:09:21:923 CST] 00000015 WebApp        E   Exception caught while initializing context
org.springframework.beans.factory.BeanDefinitionStoreException: Unable to determine validation mode for [file [/opt/IBM/WebSphere/AppServer/profiles/Appserver02/installedApps/Appserver02/sinoom_v1_0_0_war.ear/sinoom_v1.0.0.war/WEB-INF/classes/spring/applicationContext-quartz.xml]]: an error occurred whilst reading from the InputStream.; nested exception is sun.io.MalformedInputException
Caused by: sun.io.MalformedInputException
    at sun.io.ByteToCharGB18030.convert(ByteToCharGB18030.java:171)
    at sun.nio.cs.StreamDecoder$ConverterSD.convertInto(StreamDecoder.java:314)
    at sun.nio.cs.StreamDecoder$ConverterSD.implRead(StreamDecoder.java:364)
    at sun.nio.cs.StreamDecoder.read(StreamDecoder.java:250)
    at java.io.InputStreamReader.read(InputStreamReader.java:212)
    at java.io.BufferedReader.fill(BufferedReader.java:157)
    at java.io.BufferedReader.readLine(BufferedReader.java:320)
    at java.io.BufferedReader.readLine(BufferedReader.java:383)
    at org.springframework.util.xml.XmlValidationModeDetector.detectValidationMode(XmlValidationModeDetector.java:79)
    at org.springframework.beans.factory.xml.XmlBeanDefinitionReader.detectValidationMode(XmlBeanDefinitionReader.java:468)
    at org.springframework.beans.factory.xml.XmlBeanDefinitionReader.getValidationModeForResource(XmlBeanDefinitionReader.java:438)
    at org.springframework.beans.factory.xml.XmlBeanDefinitionReader.doLoadBeanDefinitions(XmlBeanDefinitionReader.java:404)
    at org.springframework.beans.factory.xml.XmlBeanDefinitionReader.loadBeanDefinitions(XmlBeanDefinitionReader.java:357)
    at org.springframework.beans.factory.xml.XmlBeanDefinitionReader.loadBeanDefinitions(XmlBeanDefinitionReader.java:334)
    at org.springframework.beans.factory.support.AbstractBeanDefinitionReader.loadBeanDefinitions(AbstractBeanDefinitionReader.java:126)
    at org.springframework.beans.factory.support.AbstractBeanDefinitionReader.loadBeanDefinitions(AbstractBeanDefinitionReader.java:142)
    at org.springframework.web.context.support.XmlWebApplicationContext.loadBeanDefinitions(XmlWebApplicationContext.java:123)
    at org.springframework.web.context.support.XmlWebApplicationContext.loadBeanDefinitions(XmlWebApplicationContext.java:91)
    at org.springframework.context.support.AbstractRefreshableApplicationContext.refreshBeanFactory(AbstractRefreshableApplicationContext.java:94)
    at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:294)
    at org.springframework.web.context.support.AbstractRefreshableWebApplicationContext.refresh(AbstractRefreshableWebApplicationContext.java:156)
    at org.springframework.web.context.ContextLoader.createWebApplicationContext(ContextLoader.java:246)
    at org.springframework.web.context.ContextLoader.initWebApplicationContext(ContextLoader.java:184)
    at org.springframework.web.context.ContextLoaderListener.contextInitialized(ContextLoaderListener.java:49)
    at com.ibm.ws.wswebcontainer.webapp.WebApp.notifyServletContextCreated(WebApp.java:641)
    at com.ibm.ws.webcontainer.webapp.WebApp.commonInitializationFinish(WebApp.java:298)
    at com.ibm.ws.wswebcontainer.webapp.WebApp.initialize(WebApp.java:289)
    at com.ibm.ws.wswebcontainer.webapp.WebGroup.addWebApplication(WebGroup.java:90)
    at com.ibm.ws.wswebcontainer.VirtualHost.addWebApplication(VirtualHost.java:157)
    at com.ibm.ws.wswebcontainer.WebContainer.addWebApp(WebContainer.java:665)
    at com.ibm.ws.wswebcontainer.WebContainer.addWebApplication(WebContainer.java:618)
    at com.ibm.ws.webcontainer.component.WebContainerImpl.install(WebContainerImpl.java:335)
    at com.ibm.ws.webcontainer.component.WebContainerImpl.start(WebContainerImpl.java:551)
    at com.ibm.ws.runtime.component.ApplicationMgrImpl.start(ApplicationMgrImpl.java:1301)
    at com.ibm.ws.runtime.component.DeployedApplicationImpl.fireDeployedObjectStart(DeployedApplicationImpl.java:1138)
    at com.ibm.ws.runtime.component.DeployedModuleImpl.start(DeployedModuleImpl.java:569)
    at com.ibm.ws.runtime.component.DeployedApplicationImpl.start(DeployedApplicationImpl.java:817)
    at com.ibm.ws.runtime.component.ApplicationMgrImpl.startApplication(ApplicationMgrImpl.java:950)
    at com.ibm.ws.runtime.component.ApplicationMgrImpl$AppInitializer.run(ApplicationMgrImpl.java:2120)
    at com.ibm.wsspi.runtime.component.WsComponentImpl$_AsynchInitializer.run(WsComponentImpl.java:342)
    at com.ibm.ws.util.ThreadPool$Worker.run(ThreadPool.java:1469)</pre> 
<br /> 此问题为xml配置文件编码问题，一般出现的websphere、weblogic等中间件上。 
<br /> 1、解决方法将xml文件的编码格式，注意是文件，改成GB18030。此外还要将内部编码格式encoding=&quot;GB18030&quot;。 
<br /> 这里说明一下修改方法: 
<br /> 1)、创建一个xml文件，将其文件格式改为GB18030 
<br /> 2)、将原来出问题的编码格式的文件所有内容copy到记事本中，注意是记事本，而不是其他编辑器。 
<br /> 3)、将xml中编码格式改为encoding=&quot;GB18030&quot; 
<br /> 
<br /> 2、如果上边的第一种方法解决不了，我们可以将xml配置文件里的所有中文字符删掉，再试试。 
<br /> 
<br /> 3、有的人认为是ibm io的问题，他们是这样解决问题的。 
<br /> 这个问题产生的原因是IBM在JDK 1.4版本中为了追求对io通道的高效率改变了JDK 1.3中对io通道中异常处理的策略。 
<br /> IBM JDK 1.4中对于io通道的异常处理更加严格，因此系统中会报上面的错误。 
<br /> 解决这一问题的办法是不使用IBM JDK 1.4中默认的io通道，而使用nio通道。具体的做法如下： 
<br /> 1)、打开管理控制台,找到并选择运行这个JSP的应用服务器 
<br /> 2)、依次选择进程定义，java虚拟机，一般JVM自变量 
<br /> 3)、添加-Dibm.stream.nio=true 
<br /> 4)、确定，保存 
<br /> 5)、重新启动该服务器 
<br /> 
<br /> 
<br /> 参考文档 
<br /> 
<p> <a href="http://blog.csdn.net/xiangnideshen/article/details/7469400" target="_blank" rel="nofollow">http://blog.csdn.net/xiangnideshen/article/details/7469400</a> </p> 
<p> <a href="http://www.cnblogs.com/keer/archive/2007/07/11/814225.html" target="_blank" rel="nofollow">http://www.cnblogs.com/keer/archive/2007/07/11/814225.html</a> </p></div>
	      </div>
        <div class='blog'>
      <h2><a href="#top" class='top'>回到顶部</a><a name="blog_178261" href="https://my.oschina.net/u/225084/blog/178261">破解word受保护文档</a></h2>
	  <div class='outline'>
	  <div class='date'>时间：2013-11-22 13:02:44</div>
	  <div class='catalog'>分类：office办公</div>
	  	  	  	  	  </div>
      <div class='content'><p>最近工作中遇到一种word文档，以前没有见过。打开word文档，不能进行任何的编辑操作，只能看。这个很是郁闷啊，整的跟pdf似的。在网上一查发现文档是被设置为保护。那作为开发人员，肯定不能轻易妥协，必须取消保护。网上有很多方法说是将文档转为xml格式\html格式，设置unprotectform。个人认为只要知道密码就ok了。</p> 
<p><strong>解决办法</strong></p> 
<p>第一步：点击头部菜单 “审阅”——“保护文档”——”限制格式和编辑“ <img src="http://static.oschina.net/uploads/space/2013/1204/122153_9tNA_225084.jpg" alt="在此输入图片描述"></p> 
<p>第二步：点击右边栏下部”停止保护“ <img src="http://static.oschina.net/uploads/space/2013/1204/122245_TUMP_225084.jpg" alt="在此输入图片描述"></p> 
<p>第三步：输入密码，即可编辑文档。 获取密码可以使用“<strong>Ha_Passwarekit.rar</strong>”这个软件破解</p></div>
	  	  <div class='commentList'>
		<h3>评论列表</h3>
	    	    <div class='comment'>
		  <div class='author'>道格</div>
		  <div class='date'>2013-12-04 11:56:33</div>
		  <div class='content'>恩，不错。最好加上截图</div>
		</div>
			    <div class='comment'>
		  <div class='author'>gerry_pang</div>
		  <div class='date'>2013-12-04 12:23:22</div>
		  <div class='content'><div class=ref><h4>引用来自“道格”的评论</h4><p>恩，不错。最好加上截图</p></div>好了，已经有图有真相了</div>
		</div>
			  </div>
	      </div>
        <div class='blog'>
      <h2><a href="#top" class='top'>回到顶部</a><a name="blog_177185" href="https://my.oschina.net/u/225084/blog/177185">杂记</a></h2>
	  <div class='outline'>
	  <div class='date'>时间：2013-11-18 13:17:32</div>
	  <div class='catalog'>分类：日常记录</div>
	  	  	  	  	  </div>
      <div class='content'><p><a href="http://money.cnn.com/calculator/pf/cost-of-living/" rel="nofollow">http://money.cnn.com/calculator/pf/cost-of-living/</a> 在线生活成本计算器可以帮助人们转换、粗略地计算出现有工资在当地购买力的情况。</p></div>
	      </div>
        <div class='blog'>
      <h2><a href="#top" class='top'>回到顶部</a><a name="blog_177184" href="https://my.oschina.net/u/225084/blog/177184">前端界面开发精彩文章总结</a></h2>
	  <div class='outline'>
	  <div class='date'>时间：2013-11-18 13:12:06</div>
	  <div class='catalog'>分类：转贴的文章</div>
	  	  	  	  	  </div>
      <div class='content'><p>EasyUI之DataGrid使用 : <a href="http://blog.csdn.net/liovey/article/details/9173931" rel="nofollow">http://blog.csdn.net/liovey/article/details/9173931</a></p></div>
	      </div>
        <div class='blog'>
      <h2><a href="#top" class='top'>回到顶部</a><a name="blog_177183" href="https://my.oschina.net/u/225084/blog/177183">Spring事务</a></h2>
	  <div class='outline'>
	  <div class='date'>时间：2013-11-18 13:04:37</div>
	  <div class='catalog'>分类：转贴的文章</div>
	  	  	  	  	  </div>
      <div class='content'><p>Spring事务传播特性实例解析 <a href="http://blog.csdn.net/liovey/article/details/14149137" rel="nofollow">http://blog.csdn.net/liovey/article/details/14149137</a></p></div>
	      </div>
        <div class='blog'>
      <h2><a href="#top" class='top'>回到顶部</a><a name="blog_172780" href="https://my.oschina.net/u/225084/blog/172780">ssh数据源（c3p0+was）</a></h2>
	  <div class='outline'>
	  <div class='date'>时间：2013-10-29 20:21:51</div>
	  <div class='catalog'>分类：转贴的文章</div>
	  	  	  <div class='tags'>标签：c3p0,was,websphere</div>	  	  	  </div>
      <div class='content'><p><a href="http://www.iteye.com/topic/1126528" rel="nofollow">ssh web 应用使用c3p0数据库连接池</a></p> 
<p><a href="http://www.ibm.com/developerworks/cn/websphere/library/techarticles/1111_zhangt_opensource/1111_zhangt_opensource.html" rel="nofollow">ibm 给出的实例说明 将ssh web应用程序从tomcat迁移到websphere(was)</a></p> 
<p><a href="http://www.ibm.com/developerworks/cn/websphere/library/techarticles/fanggw/0406_was5ds/was5ds.html" rel="nofollow">WAS 中数据源的配置使用及其常见问题</a></p> 
<p><a href="http://%20http://blog.csdn.net/caiqiling/article/details/7220966" rel="nofollow">开源DBCP、C3P0、Proxool 、 BoneCP连接池的比较 </a></p></div>
	      </div>
        <div class='blog'>
      <h2><a href="#top" class='top'>回到顶部</a><a name="blog_170831" href="https://my.oschina.net/u/225084/blog/170831">quartz demo</a></h2>
	  <div class='outline'>
	  <div class='date'>时间：2013-10-23 16:54:04</div>
	  <div class='catalog'>分类：web开发</div>
	  	  	  <div class='tags'>标签：quartz,demo</div>	  	  	  </div>
      <div class='content'><p>QuartzJob 类：创建job类，实现org.quartz.job接口类，并实现execute方法。</p> 
<pre><code>&lt;!-- lang: java --&gt;
package com.pgw.quartz;
import java.util.Date;
import org.quartz.Job;
import org.quartz.JobExecutionContext;
import org.quartz.JobExecutionException;

public class QuartzJob implements Job{
	public void execute(JobExecutionContext arg0) throws JobExecutionException {
		System.out.println("Hello world !!!" + new Date());
	}
}
</code></pre> 
<p>QuartzCronTrigger 类：创建crontrigger类，继承CronTrigger类，实现 Serializable接口</p> 
<pre><code>&lt;!-- lang: java --&gt;
package com.pgw.quartz;
import java.io.Serializable;
import java.text.ParseException;
import org.quartz.CronTrigger;

public class QuartzCronTrigger extends CronTrigger implements Serializable{
	private static final long serialVersionUID = 1L;
	
	public QuartzCronTrigger(){
		
	}
	
	public void setCronExpress(String corn, String name, String groupName){
		try {
			this.setCronExpression(corn);
			this.setName(name);
			this.setGroup(groupName);
		} catch (ParseException e) {
			e.printStackTrace();
		}
	}
}
</code></pre> 
<p>QuartzMain 类</p> 
<p>1、如果Scheduler没有设置名称，通过scheduler = factory.getDefaultScheduler();获取的Scheduler对象名称为DefaultQuartzScheduler。</p> 
<p>2、Quartz可以设置一个Scheduler，然后在这个Scheduler下配置多对trigger和job度对象。</p> 
<pre><code>&lt;!-- lang: java --&gt;
package com.pgw.quartz;
import org.quartz.CronTrigger;
import org.quartz.JobDetail;
import org.quartz.Scheduler;
import org.quartz.impl.StdSchedulerFactory;

public class QuartzMain{
	public static void main(String[] args) {
		// 创建一个jobDetail对象，将Job实际业务类放入jobDetail中
		JobDetail jobDetail = new JobDetail("demo", "demo", QuartzJob.class);
		// 创建一个触发器
		CronTrigger triggers = new QuartzCronTrigger();
		try {
			// 设置触发器 名字
			triggers.setName("demo");
			// 设置触发器所属组
			triggers.setGroup("demo");
			// 设置触发时间cron表达式
			triggers.setCronExpression("10 * * * * ?");
			// 将jobDetail放入触发器中
			triggers.setJobGroup("demo");
		
			// 创建schedulerFactory对象
			StdSchedulerFactory factory = new StdSchedulerFactory();
			
			Scheduler scheduler = factory.getDefaultScheduler();
		    // Register the JobDetail and Trigger
			scheduler.scheduleJob(jobDetail, triggers);
			
		    // 挂起定时线程
			scheduler.start();
		}catch(Exception ex){
				ex.printStackTrace();
		}
	}
}
</code></pre></div>
	      </div>
        <div class='blog'>
      <h2><a href="#top" class='top'>回到顶部</a><a name="blog_170620" href="https://my.oschina.net/u/225084/blog/170620">HQL学习总结</a></h2>
	  <div class='outline'>
	  <div class='date'>时间：2013-10-22 18:18:59</div>
	  <div class='catalog'>分类：web开发</div>
	  	  	  <div class='tags'>标签：hql,like,in</div>	  	  	  </div>
      <div class='content'><ol> 
 <li> <p>hql语句是区分大小写的。</p> </li> 
 <li> <p>查询时候表名必须和实体类（po）相同，而查询的字段必须和实体类的属性名相同（而不是数据库的字段名）。</p> </li> 
 <li> <p>hql是面向对象的查询语句。</p> </li> 
 <li> <p>注意：在hql模糊查询中,在“%”的两旁要加上单引号,eg: LIKE '%value%',否则会出错。</p> </li> 
 <li> <p>包含where子句的查询，使用"where 1=1",如果后面的查询条件都不符合，会保证语法的正确性。</p> </li> 
 <li> <p>包含in子句的查询，使用"in（'', ...）",如果没有其他限定范围，同样也会保证语法的正确性。</p> </li> 
 <li> <p>在hql语句中“=”后面为string类型时，应写成 ='xxxx' 形式，否则hql语句会报错。</p> </li> 
 <li> <p>在hql语句中escape 'X'，会将 X 出现之后的字符视为非特殊字符。</p> </li> 
 <li> <p>在hql模糊查询中包含“_”和“%”特殊字符，进行查询</p> <p>1)“<em>”替换为“/</em>” like '%/_..%' espase ‘/’;</p> <p>2)“%”替换为“/%” like '%/%..%' espase ‘/’;</p> </li> 
</ol></div>
	      </div>
        <div class='blog'>
      <h2><a href="#top" class='top'>回到顶部</a><a name="blog_170619" href="https://my.oschina.net/u/225084/blog/170619">shell编程时要注意点</a></h2>
	  <div class='outline'>
	  <div class='date'>时间：2013-10-22 18:15:40</div>
	  <div class='catalog'>分类：shell编程</div>
	  	  	  <div class='tags'>标签：shell,notice</div>	  	  	  </div>
      <div class='content'><p>在shell编程时要注意一下几点：</p> 
<ol> 
 <li>赋值时“=”两边不能有空格。</li> 
 <li>测试条件[]，在方括号内容的两侧都要加上空格。</li> 
 <li>echo 后的内容，系统一般都会认为为字符串。</li> 
</ol></div>
	      </div>
        <div class='blog'>
      <h2><a href="#top" class='top'>回到顶部</a><a name="blog_170617" href="https://my.oschina.net/u/225084/blog/170617">list使用的低级错误</a></h2>
	  <div class='outline'>
	  <div class='date'>时间：2013-10-22 18:05:10</div>
	  <div class='catalog'>分类：常见异常</div>
	  	  	  <div class='tags'>标签：低级错误,OutOfMemeryException,list</div>	  	  	  </div>
      <div class='content'><p>在本次的开发中，我们程序总是报内存溢出异常，后经过很长时间才分析出原因。发现后，感觉这是个十足的低级错误，现在写出来供大家阅读，以免再犯类似错误。</p> 
<p>事件是这样的： 我的一个位同事为了获得表中数据的条数。通过hql语句，将数据库中所有数据查询出来，并将所有查询结果集放到一个list中。在开始使用的时候没有发现有什么问题。但是当数量上万以后，一运行程序就会立即报错--OutOfMemeryException。</p> 
<p>估计讲到这里大家应该都明白怎么回事了。这个错误实在是太低级了。原本使用count就能解决的问题，他偏要将使用list.size获取数据条数。</p> 
<p>总之，警示，误再犯此低级错了</p></div>
	  	  <div class='commentList'>
		<h3>评论列表</h3>
	    	    <div class='comment'>
		  <div class='author'>五杀联盟</div>
		  <div class='date'>2013-10-23 00:22:44</div>
		  <div class='content'>这。。。太坑爹了吧，还有这人？ </div>
		</div>
			    <div class='comment'>
		  <div class='author'>Timco</div>
		  <div class='date'>2013-10-23 01:55:24</div>
		  <div class='content'>这。。又是实习生吧 </div>
		</div>
			    <div class='comment'>
		  <div class='author'>Jr小王子</div>
		  <div class='date'>2015-05-21 18:53:07</div>
		  <div class='content'><img src="/js/ke/plugins/emoticons/3.gif" alt="3"/>没看懂 我也是实习生</div>
		</div>
			    <div class='comment'>
		  <div class='author'>gerry_pang</div>
		  <div class='date'>2015-05-29 12:43:37</div>
		  <div class='content'><div class='ref'><h4>引用来自“Jr小王子”的评论</h4><img src="/js/ke/plugins/emoticons/3.gif" alt="3"/>没看懂 我也是实习生</div>假如你要查询表中符合某个条件的数据量有多少，你会怎么办？我同事做法是获得所有对象放入list中，利用list的size得出条数。如果数据量小还可以，但是如果是上100W，就会内存溢出。最近的方法执行SQL查一下count不就行了。</div>
		</div>
			  </div>
	      </div>
        <div class='blog'>
      <h2><a href="#top" class='top'>回到顶部</a><a name="blog_170615" href="https://my.oschina.net/u/225084/blog/170615">spring主动注入（每次调用getBean类似new一个对象）</a></h2>
	  <div class='outline'>
	  <div class='date'>时间：2013-10-22 17:53:59</div>
	  <div class='catalog'>分类：web开发</div>
	  	  	  <div class='tags'>标签：spring主动注入</div>	  	  	  </div>
      <div class='content'><p>spring主动注入，类似每次调用new一个对象</p> 
<p>页面调用：</p> 
<pre><code>&lt;!-- lang: java --&gt;
// 使用spring注入一个新的connectionSSH对象（like new）    
Connections conn = getConnectionSSH();  
</code></pre> 
<p>spring配置：</p> 
<pre><code>&lt;!-- lang: xml --&gt;
&lt;lookup-method name="getConnectionTelnet" bean="connectionTelnet"/&gt; 
</code></pre></div>
	      </div>
        <div class='blog'>
      <h2><a href="#top" class='top'>回到顶部</a><a name="blog_170614" href="https://my.oschina.net/u/225084/blog/170614">数据库连接超时异常</a></h2>
	  <div class='outline'>
	  <div class='date'>时间：2013-10-22 17:49:00</div>
	  <div class='catalog'>分类：常见异常</div>
	  	  	  	  	  </div>
      <div class='content'><pre><code>    The last packet successfully received from the server was 32,399,735 milliseconds ago.  The last packet sent successfully to the server was 0 milliseconds ago.
	at com.mysql.jdbc.SQLError.createCommunicationsException(SQLError.java:1112)
	at com.mysql.jdbc.MysqlIO.reuseAndReadPacket(MysqlIO.java:3092)
	at com.mysql.jdbc.MysqlIO.reuseAndReadPacket(MysqlIO.java:2978)
	at com.mysql.jdbc.MysqlIO.checkErrorPacket(MysqlIO.java:3526)
	at com.mysql.jdbc.MysqlIO.sendCommand(MysqlIO.java:1989)
	at com.mysql.jdbc.MysqlIO.sqlQueryDirect(MysqlIO.java:2150)
	at com.mysql.jdbc.ConnectionImpl.execSQL(ConnectionImpl.java:2620)
	at com.mysql.jdbc.ConnectionImpl.setAutoCommit(ConnectionImpl.java:5022)
	at org.apache.tomcat.dbcp.dbcp.DelegatingConnection.setAutoCommit(DelegatingConnection.java:331)
	at org.apache.tomcat.dbcp.dbcp.PoolingDataSource$PoolGuardConnectionWrapper.setAutoCommit(PoolingDataSource.java:317)
	at org.hibernate.transaction.JDBCTransaction.begin(JDBCTransaction.java:63)
	at org.hibernate.impl.SessionImpl.beginTransaction(SessionImpl.java:1326)
	at org.springframework.orm.hibernate3.HibernateTransactionManager.doBegin(HibernateTransactionManager.java:494)
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.getTransaction(AbstractPlatformTransactionManager.java:315)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.createTransactionIfNecessary(TransactionAspectSupport.java:257)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:102)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:185)
	at org.springframework.aop.framework.Cglib2AopProxy$DynamicAdvisedInterceptor.intercept(Cglib2AopProxy.java:652)
	at com.sinosoft.sepmis.inspection.service.InspectionDataServiceImpl$$EnhancerByCGLIB$$e65cc02b.saveInspectionData(&lt;generated&gt;)
	at com.sinosoft.sepmis.util.ConnectionTelnet.execute(ConnectionTelnet.java:319)
	at com.sinosoft.sepmis.util.InspectionUtil.inspectExecute(InspectionUtil.java:331)
	at com.sinosoft.sepmis.util.InspectionUtil.timer(InspectionUtil.java:79)
	at com.sinosoft.sepmis.quartz.QuartzJobTask.execute(QuartzJobTask.java:196)
	at org.quartz.core.JobRunShell.run(JobRunShell.java:202)
	at org.quartz.simpl.SimpleThreadPool$WorkerThread.run(SimpleThreadPool.java:529)
Caused by: java.io.EOFException: Can not read response from server. Expected to read 4 bytes, read 0 bytes before connection was unexpectedly lost.
	at com.mysql.jdbc.MysqlIO.readFully(MysqlIO.java:2539)
	at com.mysql.jdbc.MysqlIO.reuseAndReadPacket(MysqlIO.java:2989)
	... 23 more
	org.springframework.transaction.CannotCreateTransactionException: Could not open Hibernate Session for transaction; nested exception is org.hibernate.TransactionException: JDBC begin failed: 
</code></pre> 
<p>原因：数据库连接超时造成，</p> 
<p>解决：</p> 
<pre><code>方法1、修改mysql数据库wait_timeout配置属性，将mysql数据库连接时间增长。

方法2、修改Hibernate配置
&lt;!-- lang: xml --&gt;
&lt;prop key="hibernate.connection.autoReconnect"&gt;true&lt;/prop&gt;
&lt;prop key="hibernate.connection.autoReconnectForPools"&gt;true&lt;/prop&gt;
&lt;prop key="hibernate.connection.is-connection-validation-required"&gt;true&lt;/prop&gt;
</code></pre></div>
	      </div>
        <div class='blog'>
      <h2><a href="#top" class='top'>回到顶部</a><a name="blog_169410" href="https://my.oschina.net/u/225084/blog/169410">处女作开发总结</a></h2>
	  <div class='outline'>
	  <div class='date'>时间：2013-10-16 23:18:02</div>
	  <div class='catalog'>分类：日常记录</div>
	  	  	  <div class='tags'>标签：开发,总结</div>	  	  	  </div>
      <div class='content'><p><strong>前言：</strong></p> 
<p>最近这三个月，我们组（3个组员，1个组长）在公司接了一个项目。”运维监控系统“ -- 对公司各省份的服务器进行巡检、监控操作。这个项目可以说是我到这公司的“处女”作。所以在需求、设计、开发、测试阶段我都格外用心，想尽量做到更好。在项目的开发和设计阶段组长还有时间管我们，并时不时帮我们看看，并管理项目的进度。但是到了后期开发由于他个人又接了一个项目，就没有时间顾及我们这三个“菜鸟”了。</p> 
<p>这样一来，反而我发现，在后期没有“老大”管理的日子里（开发和测试阶段），我们三个“菜鸟”成长的飞快。为什么这么说呢？因为这时遇到的问题，只能我们三个商量解决。具体的测试计划以及测试进度、测试环境的搭建，以及与测试组之间的对外沟通，我们都必须自己处理。这期间我们遇到了各种问题。以下是各阶段，自己总结的一些经验，有不对之处，勿喷。</p> 
<p><strong>设计：</strong></p> 
<p>1、数据库的设计可以有千万种，但一定要选择最有利于开发，便于实现的，并且存储效率较高的方案。</p> 
<p>2、没有“天衣无缝”的设计，再好的设计在开发阶段也会出现问题。因为唯有在编码的时候，才会发现设计上一些潜在缺陷，所在设计阶段不要过去追求完美。</p> 
<p><strong>开发：</strong></p> 
<p>1、当所开发模块要与别人进行合并，或者别要调用你的模块时，这时候你一定要和他确定好他的需求，并且考虑此处可能出现的各种问题，因为很多bug都是出现在俩人交叉开发代码间。 a、传递/接受 参数个数、格式、顺序； b、数据传递会不会出现异步情况，要怎么避免；</p> 
<p>2、每天下班前或者是完成一个模块后，都要把自己确定无误的代码提交至svn。注意一定是自己确定没有问题的代码。不然会因为你的异常代码导致他人无法调试，影响团队的开发进度，而且还会给自带来无尽麻烦。</p> 
<p>3、开发时要注意细节，就可因为你在开发上的一个变量，没有考虑到数据量大了以后会出现什么问题（例：list的存储数据过大导致内存溢出等），没有考虑并发量高可能会引发的问题（例：变量值被覆盖，线程对同文件调用死锁等）。</p> 
<p><strong>测试：</strong></p> 
<p>1、前期要让测试人员逐个模块功能测起。</p> 
<p>2、压测要等到最后，确保系统各模块都没有问题了才能开始。要不然中途开始压测，各种问题都会跑出来。具体是什么原因都不好分析。</p> 
<p>3、测试中遇到问题，不管测试人员多么催你修改bug，不管后边有抛出多少个bug。都一定要静下心来，耐心根据异常信息，查找问题出现的根源。其实答案就在抛出才异常信息中，只要静下心来一定能找到原因。</p> 
<p>4、对于那种非常规的bug，你可以根据测试用例，错误日志生时间，以及bug出现的频率（时间）。找出规律，设法定位到自己认为有误的代码。</p></div>
	  	  <div class='commentList'>
		<h3>评论列表</h3>
	    	    <div class='comment'>
		  <div class='author'>nao</div>
		  <div class='date'>2016-12-23 15:02:36</div>
		  <div class='content'>Hi, 你做的项目跟我现在在做的差不多，差不多也做了三年了，收集器使用的是C语言，其他的都是用的erlang和web前端的一些东西. 明年可能要开始做巡检功能，但是还是没有思路，能否指点一二？（1:你们是做的某个时间点的巡检还是某个时间区间的巡检 2 巡检结果如何存储和显示的）</div>
		</div>
			    <div class='comment'>
		  <div class='author'>gerry_pang</div>
		  <div class='date'>2016-12-29 21:55:44</div>
		  <div class='content'><div class=ref><h4>引用来自“nao”的评论</h4><p>Hi, 你做的项目跟我现在在做的差不多，差不多也做了三年了，收集器使用的是C语言，其他的都是用的erlang和web前端的一些东西. 明年可能要开始做巡检功能，但是还是没有思路，能否指点一二？（1:你们是做的某个时间点的巡检还是某个时间区间的巡检 2 巡检结果如何存储和显示的）</p></div>我们做的时间点巡检，巡检结果直接先根据预先设置的阀值进行判断，然后将结果和巡检结论存库 </div>
		</div>
			  </div>
	      </div>
        <div class='blog'>
      <h2><a href="#top" class='top'>回到顶部</a><a name="blog_163707" href="https://my.oschina.net/u/225084/blog/163707">new idea</a></h2>
	  <div class='outline'>
	  <div class='date'>时间：2013-09-23 23:29:29</div>
	  <div class='catalog'>分类：web开发</div>
	  	  	  	  	  </div>
      <div class='content'><p>Yeoman <a href="http://yeoman.io/" rel="nofollow">http://yeoman.io/</a> <a href="http://www.36ria.com/6144" rel="nofollow">http://www.36ria.com/6144</a></p></div>
	      </div>
        <div class='blog'>
      <h2><a href="#top" class='top'>回到顶部</a><a name="blog_162411" href="https://my.oschina.net/u/225084/blog/162411">String类型使用注意</a></h2>
	  <div class='outline'>
	  <div class='date'>时间：2013-09-18 08:27:42</div>
	  <div class='catalog'>分类：web开发</div>
	  	  	  <div class='tags'>标签：String,注意</div>	  	  	  </div>
      <div class='content'><p>1、String.valueOf（）静态方法，可以将int，boolean等原生数据类型的值转换为字符串类型。</p> 
<p>2、String类中split(Str)方法可以通过设定拆分条件，将一个字符串拆分成相应的字符串数组。</p> 
<p>3、StringTokenizer类的作用等同于String.split（）方法。</p> 
<p>4、String.indexOf（str），返回str在查询字符串中第一次出现的位置，注意：从0计数，如果没有找到返回-1</p> 
<p>5、转码方法new String（str.getBytes("GBK"),"UTF-8"）,将utf-8转换成gbk。</p> 
<p>6、equalsIngoreCase("xxx"):忽略大小写的比较。</p></div>
	      </div>
        <div class='blog'>
      <h2><a href="#top" class='top'>回到顶部</a><a name="blog_162410" href="https://my.oschina.net/u/225084/blog/162410">Jsp中C标签学习总结</a></h2>
	  <div class='outline'>
	  <div class='date'>时间：2013-09-18 08:23:57</div>
	  <div class='catalog'>分类：web开发</div>
	  	  	  <div class='tags'>标签：C标签,总结</div>	  	  	  </div>
      <div class='content'><p>1、条件判断语句的写法: &lt;!-- lang: html --&gt; &lt;c:if test=”${…}”&gt; 输出内容 &lt;/c:if&gt; 注意：判断的条件只能为test</p> 
<p>2、when和otherwise必须和choose搭配才能使用，例 &lt;!-- lang: html --&gt; &lt;c:choose&gt; &lt;c:when test=""&gt;...&lt;/c:when&gt; &lt;c:otherwise&gt;...&lt;/c:otherwise&gt; &lt;/c:choose&gt;</p> 
<p>3、使用foreach中的varStatus属性，可以获取循环中的current、index、count、first、last值。</p> 
<p>4、&lt;c:forech item="xx"&gt; 获取结果集中属性值，不要写成”xx.对象.属性“的形式，直接写成“xx.属性”</p> 
<p>5、注意在&lt;c:if test=${xx &amp;&amp; xx}&gt;进行条件判断时，必须将并条件（&amp;&amp;）写在花括号内。</p></div>
	  	  <div class='commentList'>
		<h3>评论列表</h3>
	    	    <div class='comment'>
		  <div class='author'>RobertCool</div>
		  <div class='date'>2013-09-18 17:13:37</div>
		  <div class='content'>你说的 c  标记，其实叫做jstl</div>
		</div>
			    <div class='comment'>
		  <div class='author'>gerry_pang</div>
		  <div class='date'>2013-09-20 21:22:16</div>
		  <div class='content'><div class=ref><h4>引用来自“RobertCool”的评论</h4><p>你说的 c  标记，其实叫做jstl</p></div>嗯，是的，不过公司的同事都这么叫，我也就这么写了。谢谢，学习了，有什么写的不对的，请多指教。</div>
		</div>
			  </div>
	      </div>
        <div class='blog'>
      <h2><a href="#top" class='top'>回到顶部</a><a name="blog_162409" href="https://my.oschina.net/u/225084/blog/162409">开发中与浏览器相关的一些问题总结</a></h2>
	  <div class='outline'>
	  <div class='date'>时间：2013-09-18 08:22:15</div>
	  <div class='catalog'>分类：web开发</div>
	  	  	  <div class='tags'>标签：浏览器,问题总结</div>	  	  	  </div>
      <div class='content'><p>开发中与浏览器相关的一些问题：</p> 
<p>1、如果在表单中只有一个文本框，点击回车键后，浏览器会自动将此表单提交给服务器，而不经过页面的js验证。 解决方法：在页面中添加一个文本框隐藏的文本框，隐藏的目的是为了不影响功能，这时在点击回车键浏览器就不会自动提交表单。</p> 
<p>2、在ie中是没有js的trim方法。 解决方法使用JQuery的$.trim（）， 只是去掉首尾的空格</p> 
<p>3、火狐调试方法：在调试页面js错误时可以使用firefox的工具--web开发者--错误控制台，检查错误原因。</p> 
<p>4、获取用户浏览器信息： request.getHeader("user-agent"); user-agent 可以识别客户使用的操作系统版本，浏览器版本\语言\插件\渲染引擎</p></div>
	      </div>
        <div class='blog'>
      <h2><a href="#top" class='top'>回到顶部</a><a name="blog_161048" href="https://my.oschina.net/u/225084/blog/161048">Illegal attempt to associate a collection with ...</a></h2>
	  <div class='outline'>
	  <div class='date'>时间：2013-09-13 08:43:16</div>
	  <div class='catalog'>分类：常见异常</div>
	  	  	  <div class='tags'>标签：two,session,hibernate,exception</div>	  	  	  </div>
      <div class='content'><pre><code>&lt;!-- lang: java --&gt;
org.springframework.orm.hibernate3.HibernateSystemException: Illegal attempt to associate a collection with two open sessions;
</code></pre> 
<p>错误原因分析： 因为Hibernate默认是只允许单个session存在，如果有两个session同时open，并同一个collection进行操作，Hibernate是无法判断使用那个。 在wel.xml文件中配置了opensession Filter，设置为singleSession。</p> 
<pre><code>&lt;!-- lang: xml --&gt;
&lt;filter&gt;
	&lt;filter-name&gt;hibernateFilter&lt;/filter-name&gt;
	&lt;filter-class&gt;org.springframework.orm.hibernate3.support.OpenSessionInViewFilter&lt;/filter-class&gt;
	&lt;/init-param&gt;
			&lt;param-name&gt;singleSession&lt;/param-name&gt;
    &lt;param-value&gt;true&lt;/param-value&gt;
	&lt;/init-param&gt;
&lt;/filter&gt;
</code></pre> 
<p>但是如果我们想通过改变singleSession为false解决问题，我个人认为这个是不合理做法，还是该想其他解决方法。我提供一个解决方法供大家参考。</p> 
<p>解决方法： 而且我通过google的搜索的时候，发现这个问题经常出现在1：N的情况下。所以在这种情况下要更为注意open two session这个问题，以免浪费必要的时间在解决错误上。</p> 
<p>1、将两个同时对数据库操作的（update/save）法写在一个事务中。</p> 
<p>2、将Hibernate的update方法改为merge。</p></div>
	      </div>
        <div class='blog'>
      <h2><a href="#top" class='top'>回到顶部</a><a name="blog_161046" href="https://my.oschina.net/u/225084/blog/161046">Unable to instantiate Action 异常</a></h2>
	  <div class='outline'>
	  <div class='date'>时间：2013-09-13 08:22:29</div>
	  <div class='catalog'>分类：常见异常</div>
	  	  	  <div class='tags'>标签：instantiate,Action,异常</div>	  	  	  </div>
      <div class='content'><p>Unable to instantiate Action 异常</p> 
<p>解决方法：</p> 
<p>1、查看action的名字和页面的中的action是否相同</p> 
<p>2、查看action的class属性 路径是否写对，如果交给Spring注入则检查，注入的applicationContext文件路径是否写正确 之前错误原因：在web.xml中spring首字母为小写，与文件夹名不符。 &lt;context-param&gt; &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt; &lt;param-value&gt;classpath*:Spring/*.xml&lt;/param-value&gt; &lt;/context-param&gt;</p> 
<p>3、struts配置里写上: &lt;constant name="struts.objectFactory" value="spring"&gt; &lt;constant name="struts.objectFactory.spring.autoWire" value="true"/&gt; &lt;constant name="struts.objectFactory.spring.useClassCache" value="true"/&gt;</p> 
<p>4、是否导入struts2-spring-plugin-2.2.3.jar</p> 
<p>5、尤其要检查单词的拼写是否正确，字母的大小。</p></div>
	      </div>
        <div class='blog'>
      <h2><a href="#top" class='top'>回到顶部</a><a name="blog_161045" href="https://my.oschina.net/u/225084/blog/161045"> There is no result type defined for type &apos...</a></h2>
	  <div class='outline'>
	  <div class='date'>时间：2013-09-13 08:21:17</div>
	  <div class='catalog'>分类：常见异常</div>
	  	  	  <div class='tags'>标签：struct,异常,redirectaction</div>	  	  	  </div>
      <div class='content'><p>There is no result type defined for type 'redirect-action' mapped with name 'success'. Did you mean 'redirectAction'?</p> 
<p>解决方法： 将redirect-action 改为 redirectAction</p></div>
	      </div>
        <div class='blog'>
      <h2><a href="#top" class='top'>回到顶部</a><a name="blog_161044" href="https://my.oschina.net/u/225084/blog/161044">spring quartz 常见的"Table 'database.qrtz_locks' d...</a></h2>
	  <div class='outline'>
	  <div class='date'>时间：2013-09-13 08:19:53</div>
	  <div class='catalog'>分类：常见异常</div>
	  	  	  <div class='tags'>标签：spring,quartz,异常</div>	  	  	  </div>
      <div class='content'><p>spring quartz 常见的"Table 'database.qrtz_locks' doesn't exist异常"</p> 
<p>原因:出现此异常,通常是因为spring配了 &lt;beans xmlns="<a href="http://www.springframework.org/schema/beans" rel="nofollow">http://www.springframework.org/schema/beans</a>" xmlns:xsi="<a href="http://www.w3.org/2001/XMLSchema-instance" rel="nofollow">http://www.w3.org/2001/XMLSchema-instance</a>" xmlns:context="<a href="http://www.springframework.org/schema/context" rel="nofollow">http://www.springframework.org/schema/context</a>" xmlns:aop="<a href="http://www.springframework.org/schema/aop" rel="nofollow">http://www.springframework.org/schema/aop</a>" xmlns:tx="<a href="http://www.springframework.org/schema/tx" rel="nofollow">http://www.springframework.org/schema/tx</a>" xsi:schemaLocation="<a href="http://www.springframework.org/schema/beans" rel="nofollow">http://www.springframework.org/schema/beans</a> <a href="http://www.springframework.org/schema/beans/spring-beans-2.5.xsd" rel="nofollow">http://www.springframework.org/schema/beans/spring-beans-2.5.xsd</a> <a href="http://www.springframework.org/schema/context" rel="nofollow">http://www.springframework.org/schema/context</a> <a href="http://www.springframework.org/schema/context/spring-context-2.5.xsd" rel="nofollow">http://www.springframework.org/schema/context/spring-context-2.5.xsd</a> <a href="http://www.springframework.org/schema/aop" rel="nofollow">http://www.springframework.org/schema/aop</a> <a href="http://www.springframework.org/schema/aop/spring-aop-2.5.xsd" rel="nofollow">http://www.springframework.org/schema/aop/spring-aop-2.5.xsd</a> <a href="http://www.springframework.org/schema/tx" rel="nofollow">http://www.springframework.org/schema/tx</a> <a href="http://www.springframework.org/schema/tx/spring-tx-2.5.xsd" rel="nofollow">http://www.springframework.org/schema/tx/spring-tx-2.5.xsd</a>" <strong>default-autowire="byName"</strong> &gt;</p> 
<p>原理: &lt;bean id="scheduler" lazy-init="false" class="org.springframework.scheduling.quartz.SchedulerFactoryBean"&gt; 此bean会试图访问数据库获取quartz的一些管理表信息,自然访问数据库时需要注入dataSource bean,当缺省autowire为no,则没有dataSource bean被注入,quartz会认为项目没连数据库,会BYPASS这个访问管理表的功能. 当你配置了default-autowire=byName时,dataSource bean被自动注入,这时quartz认为项目既然能连到数据库,就想当然的认为对应的那些表一定存在,没找到时就出异常.</p> 
<p>解决办法:</p> 
<p>1.去掉<strong>default-autowire=byName</strong>即可 此法简单,但往往很难决定,因为缺省,谁也不会傻乎乎的显示配这么一条,配了它一定是有用到它的地方.你愿不愿意牺牲这部分byName注入的功能?</p> 
<p>2.在库中建对应的表 此法不可取,因为非常麻烦,要建很多表 CREATE TABLE QRTZ_LOCKS CREATE TABLE QRTZ_JOB_DETAILS CREATE TABLE QRTZ_TRIGGERS CREATE TABLE QRTZ_FIRED_TRIGGERS CREATE TABLE QRTZ_JOB_LISTENERS 少一张,spring都报异常, 这是为大型调度功能准备的.你要有上百个任务,可能需要它.</p> 
<p>3.bean里直接关掉autowired 推荐此法 &lt;beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:context="http://www.springframework.org/schema/context" xmlns:aop="http://www.springframework.org/schema/aop" xmlns:tx="http://www.springframework.org/schema/tx" xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.5.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-2.5.xsd http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-2.5.xsd http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-2.5.xsd" default-autowire=byName &gt;</p> 
<p>&lt;bean id="scheduler" lazy-init="false" autowire="no" class="org.springframework.scheduling.quartz.SchedulerFactoryBean"&gt;</p></div>
	      </div>
        <div class='blog'>
      <h2><a href="#top" class='top'>回到顶部</a><a name="blog_161043" href="https://my.oschina.net/u/225084/blog/161043">tomcat异常：parmeter：Invalid chunk ignored</a></h2>
	  <div class='outline'>
	  <div class='date'>时间：2013-09-13 08:17:43</div>
	  <div class='catalog'>分类：常见异常</div>
	  	  	  <div class='tags'>标签：tomcat异常</div>	  	  	  </div>
      <div class='content'><p>tomcat异常：parmeter：Invalid chunk ignored</p> 
<p>原因：页面提交的url存在无效参数，或者书写错误。</p> 
<p>解决：检查url中的参数是否为null，以及url的书写形式是否正确。</p></div>
	      </div>
        <div class='blog'>
      <h2><a href="#top" class='top'>回到顶部</a><a name="blog_161042" href="https://my.oschina.net/u/225084/blog/161042">org.springframework.beans.factory.BeanCurrently...</a></h2>
	  <div class='outline'>
	  <div class='date'>时间：2013-09-13 08:16:46</div>
	  <div class='catalog'>分类：常见异常</div>
	  	  	  <div class='tags'>标签：BeanCurrentlyInCreationException</div>	  	  	  </div>
      <div class='content'><p>org.springframework.beans.factory.BeanCurrentlyInCreationException</p> 
<p>SPRING循环依赖(circular reference)的解决方法</p> 
<p>&lt;bean id="managerFactory" class="common.utils.ManagerFactory" lazy-init="true" /&gt;</p></div>
	      </div>
        <div class='blog'>
      <h2><a href="#top" class='top'>回到顶部</a><a name="blog_161041" href="https://my.oschina.net/u/225084/blog/161041">ognl.MethodFailedException 异常</a></h2>
	  <div class='outline'>
	  <div class='date'>时间：2013-09-13 08:15:35</div>
	  <div class='catalog'>分类：常见异常</div>
	  	  	  <div class='tags'>标签：异常,ognl</div>	  	  	  </div>
      <div class='content'><p>ognl.MethodFailedException 异常</p> 
<p>解决方法：检查setter 和getter方法是是否存在问题，比如输入类型不匹配等问题</p></div>
	      </div>
        <div class='blog'>
      <h2><a href="#top" class='top'>回到顶部</a><a name="blog_161040" href="https://my.oschina.net/u/225084/blog/161040">FileUploadBase$SizeLimitExceededException异常</a></h2>
	  <div class='outline'>
	  <div class='date'>时间：2013-09-13 08:12:49</div>
	  <div class='catalog'>分类：常见异常</div>
	  	  	  <div class='tags'>标签：strut,上传文件,异常</div>	  	  	  </div>
      <div class='content'><p>FileUploadBase$SizeLimitExceededException异常，出现原因：在struts core文件中default.propreties设置了上传文件的最大限制。上传文件超过这个限制就会报错。</p> 
<p>方法1：重写struts core中的default.propreties文件。</p> 
<p>方法2：struts.xml中加入&lt;constant name="struts.multipart.maxsize" value="上传文件限制"&gt;</p></div>
	      </div>
        <div class='blog'>
      <h2><a href="#top" class='top'>回到顶部</a><a name="blog_161039" href="https://my.oschina.net/u/225084/blog/161039">Could not find property struts.actionMapping st...</a></h2>
	  <div class='outline'>
	  <div class='date'>时间：2013-09-13 08:11:08</div>
	  <div class='catalog'>分类：常见异常</div>
	  	  	  <div class='tags'>标签：struts,异常</div>	  	  	  </div>
      <div class='content'><p>2010-5-27 10:34:05 com.opensymphony.xwork2.util.logging.commons.CommonsLogger warn 警告: Could not find property [struts.actionMapping] 2010-5-27 10:34:05 com.opensymphony.xwork2.util.logging.commons.CommonsLogger warn 警告: Could not find property [struts.valueStack] 2010-5-27 10:34:05 com.opensymphony.xwork2.util.logging.commons.CommonsLogger warn 警告: Could not find property [org.apache.catalina.jsp_file]</p> 
<p>解决方案： 在网上找了好长时间，都说是警告，不影响我晕死，俺看着别扭，经过尝试终于解决了：原来是少是log4j.jar包，</p></div>
	      </div>
        <div class='blog'>
      <h2><a href="#top" class='top'>回到顶部</a><a name="blog_157919" href="https://my.oschina.net/u/225084/blog/157919">jquery ajax post 回调函数不执行的原因分析和解决办法 </a></h2>
	  <div class='outline'>
	  <div class='date'>时间：2013-08-30 07:35:15</div>
	  <div class='catalog'>分类：web开发</div>
	  	  	  <div class='tags'>标签：ajax,post</div>	  	  	  </div>
      <div class='content'><p>情况一：</p> 
<pre><code>&lt;!-- lang: js --&gt;
        $.post('checkUser.ashx', { Action: "Check", Name: user },
            function (data) {
                alert(data);
            });
</code></pre> 
<p>原因： $.post('checkUser.ashx', { Action: "Check", Name: user }, Name:user 没有加双引号</p> 
<p>情况二：没有引用对正确的jquery-xxx.js文件，查看当前页是否能够应用到这个文件。</p> 
<p>情况三：如果回调函数中打印的不知json类型的数据，如</p> 
<pre><code>&lt;!-- lang: js --&gt;
        $.post('checkUser.ashx', { Action: "Check", Name: user },
            function (data) {
                alert(data);   //alert  data不是json类的数据,后边的json必须改为text或其他对应类型
            },
        "json");
</code></pre> 
<p>w3c school 给出的标准用法，即参数说明如下：</p> 
<pre><code>&lt;!-- lang: js --&gt;
$(selector).post(URL,data,function(data,status,xhr),dataType)
</code></pre> 
<p><img src="http://static.oschina.net/uploads/space/2013/0913/085156_CLiw_225084.jpg" alt="在此输入图片描述"></p></div>
	  	  <div class='commentList'>
		<h3>评论列表</h3>
	    	    <div class='comment'>
		  <div class='author'>赛海鲁</div>
		  <div class='date'>2014-02-09 14:04:51</div>
		  <div class='content'>解决了我的问题，datatype未指定导致回调函数不执行。</div>
		</div>
			    <div class='comment'>
		  <div class='author'>Alen_Lee</div>
		  <div class='date'>2015-08-09 10:47:18</div>
		  <div class='content'>谢谢楼主的总结，也解决了我的问题，谢谢</div>
		</div>
			  </div>
	      </div>
        <div class='blog'>
      <h2><a href="#top" class='top'>回到顶部</a><a name="blog_157080" href="https://my.oschina.net/u/225084/blog/157080">浅谈数据库设计技巧(下)(转)</a></h2>
	  <div class='outline'>
	  <div class='date'>时间：2013-08-26 23:48:08</div>
	  <div class='catalog'>分类：转贴的文章</div>
	  	  	  <div class='tags'>标签：数据库,设计</div>	  	  	  </div>
      <div class='content'><p>　三、多用户及其权限管理的设计 　　开发数据库管理类的软件，不可能不考虑多用户和用户权限设置的问题。尽管目前市面上的大、中型的后台数据库系统软件都提供了多用户，以及细至某个数据库内某张表的权限设置的功能，我个人建议：一套成熟的数据库管理软件，还是应该自行设计用户管理这块功能，原因有二： 　　1.那些大、中型后台数据库系统软件所提供的多用户及其权限设置都是针对数据库的共有属性，并不一定能完全满足某些特例的需求; 　　2.不要过多的依赖后台数据库系统软件的某些特殊功能，多种大、中型后台数据库系统软件之间并不完全兼容。否则一旦日后需要转换数据库平台或后台数据库系统软件版本升级，之前的架构设计很可能无法重用。 　　下面看看如何自行设计一套比较灵活的多用户管理模块，即该数据库管理软件的系统管理员可以自行添加新用户，修改已有用户的权限，删除已有用户。 首先，分析用户需求，列出该数据库管理软件所有需要实现的功能;然后，根据一定的联系对这些功能进行分类，即把某类用户需使用的功能归为一类;最后开始建 表： 　　功能表(Function_table) 　　名称　　　　　类型　　　　约束条件　　　说明 　　f_id int 　 无重复　　 功能标识，主键 　　f_name char(20) 不允许为空 功能名称，不允许重复 　　f_desc char(50) 允许为空 功能描述 　　用户组表(User_group) 　　名称　　　　　类型　　　　约束条件　　　说明 　　group_id int 无重复 用户组标识，主键 　　group_name char(20) 不允许为空 用户组名称 　　group_power char(100) 不允许为空 用户组权限表，内容为功能表f_id的集合 　　用户表(User_table) 　　名称　　　　　类型　　　　约束条件　　　说明 　　user_id int 无重复 用户标识，主键 　　user_name char(20) 无重复 用户名 　　user_pwd char(20) 不允许为空 用户密码 　　user_type int 不允许为空 所属用户组标识，和User_group.group_id关联 　　采用这种用户组的架构设计，当需要添加新用户时，只需指定新用户所属的用户组;当以后系统需要添加新功能或对旧有功能权限进行修改时，只用操作 功能表和用户组表的记录，原有用户的功能即可相应随之变化。当然，这种架构设计把数据库管理软件的功能判定移到了前台，使得前台开发相对复杂一些。但是， 当用户数较大(10人以上)，或日后软件升级的概率较大时，这个代价是值得的。 　　四、简洁的批量m:n设计 　　碰到m:n的关系，一般都是建立3个表，m一个，n一个，m:n一个。但是，m:n有时会遇到批量处理的情况，例如到图书馆借书，一般都是允许 用户同时借阅n本书，如果要求按批查询借阅记录，即列出某个用户某次借阅的所有书籍，该如何设计呢?让我们建好必须的3个表先： 　　书籍表(Book_table) 　　名称　　　　　类型　　　　约束条件　　　说明 　　book_id int 无重复 书籍标识，主键 　　book_no char(20) 无重复 书籍编号 　　book_name char(100) 不允许为空 书籍名称 　　…… 　　借阅用户表(Renter_table) 　　名称　　　　　类型　　　　约束条件　　　说明 　　renter_id int 无重复 用户标识，主键 　　renter_name char(20) 不允许为空 用户姓名 　　…… 　　借阅记录表(Rent_log) 　　名称　　　　　类型　　　　约束条件　　　说明 　　rent_id int 无重复 借阅记录标识，主键 　　r_id int 不允许为空 用户标识，和Renter_table.renter_id关联 　　b_id int 不允许为空 书籍标识，和Book_table.book_id关联 　　rent_date datetime 不允许为空 借阅时间 　　…… 　　为了实现按批查询借阅记录，我们可以再建一个表来保存批量借阅的信息，例如： 　　批量借阅表(Batch_rent) 　　名称　　　　　类型　　　　约束条件　　　说明 　　batch_id int 无重复 批量借阅标识，主键 　　batch_no int 不允许为空 批量借阅编号，同一批借阅的batch_no相同 　　rent_id int 不允许为空 借阅记录标识，和Rent_log.rent_id关联 　　batch_date datetime 不允许为空 批量借阅时间 　　这样的设计好吗?我们来看看为了列出某个用户某次借阅的所有书籍，需要如何查询?首先检索批量借阅表(Batch_rent)，把符合条件的的 所有记录的rent_id字段的数据保存起来，再用这些数据作为查询条件带入到借阅记录表(Rent_log)中去查询。那么，有没有什么办法改进呢?下 面给出一种简洁的批量设计方案，不需添加新表，只需修改一下借阅记录表(Rent_log)即可。修改后的记录表(Rent_log)如下： 　　借阅记录表(Rent_log) 　　名称　　　　　类型　　　　约束条件　　　说明 　　rent_id int 无重复 借阅记录标识，主键 　　r_id int 不允许为空 用户标识，和Renter_table.renter_id关联 　　b_id int 不允许为空 书籍标识，和Book_table.book_id关联 　　batch_no int 不允许为空 批量借阅编号，同一批借阅的batch_no相同 　　rent_date datetime 不允许为空 借阅时间 　　…… 　　其中，同一次借阅的batch_no和该批第一条入库的rent_id相同。举例：假设当前最大rent_id是64，接着某用户一次借阅了3 本书，则批量插入的3条借阅记录的batch_no都是65。之后另外一个用户租了一套碟，再插入出租记录的rent_id是68。采用这种设计，查询批 量借阅的信息时，只需使用一条标准T_SQL的嵌套查询即可。当然，这种设计不符合3NF，但是和上面标准的3NF设计比起来，哪一种更好呢?答案就不用我说了吧。 　　五、冗余数据的取舍 　　上篇的“树型关系的数据表”中保留了一个冗余字段，这里的例子更进一步——添加了一个冗余表。先看看例子：我原先所在的公司为了解决员工的工作 餐，和附近的一家小餐馆联系，每天吃饭记账，费用按人数平摊，月底由公司现金结算，每个人每个月的工作餐费从工资中扣除。当然，每天吃饭的人员和人数都不 是固定的，而且，由于每顿工作餐的所点的菜色不同，每顿的花费也不相同。例如，星期一中餐5人花费40元，晚餐2人花费20，星期二中餐6人花费36元， 晚餐3人花费18元。为了方便计算每个人每个月的工作餐费，我写了一个简陋的就餐记账管理程序，数据库里有3个表： 　　员工表(Clerk_table) 　　名称　　　　　类型　　　　约束条件　　　说明 　　clerk_id int 无重复 员工标识，主键 　　clerk_name char(10) 不允许为空 员工姓名 　　每餐总表(Eatdata1) 　　名称　　　　　类型　　　　约束条件　　　说明 　　totle_id int 无重复 每餐总表标识，主键 　　persons char(100) 不允许为空 就餐员工的员工标识集合 　　eat_date datetime 不允许为空 就餐日期 　　eat_type char(1) 不允许为空 就餐类型，用来区分中、晚餐 　　totle_price money 不允许为空 每餐总花费 　　persons_num int 不允许为空 就餐人数 　　就餐计费细表(Eatdata2) 　　名称　　　　　类型　　　　约束条件　　　说明 　　id int 无重复 就餐计费细表标识，主键 　　t_id int 不允许为空 每餐总表标识，和Eatdata1.totle_id关联 　　c_id int 不允许为空 员工标识标识，和Clerk_table.clerk_id关联 　　price money 不允许为空 每人每餐花费 　　其中，就餐计费细表(Eatdata2)的记录就是把每餐总表(Eatdata1)的一条记录按就餐员工平摊拆开，是个不折不扣的冗余表。当 然，也可以把每餐总表(Eatdata1)的部分字段合并到就餐计费细表(Eatdata2)中，这样每餐总表(Eatdata1)就成了冗余表，不过这 样所设计出来的就餐计费细表重复数据更多，相比来说还是上面的方案好些。但是，就是就餐计费细表(Eatdata2)这个冗余表，在做每月每人餐费统计的 时候，大大简化了编程的复杂度，只用类似这么一条查询语句即可统计出每人每月的寄餐次数和餐费总帐： 　　SELECT clerk_name AS personname,COUNT(c_id) as eattimes,SUM(price) AS ptprice FROM Eatdata2 JOIN Clerk_tabsle ON (c_id=clerk_id) JOIN eatdata1 ON (totleid=tid) WHERE eat_date&gt;=CONVERT(datetime,'"&amp;the_date&amp;"') AND eat_date 　　想象一下，如果不用这个冗余表，每次统计每人每月的餐费总帐时会多麻烦，程序效率也够呛。那么，到底什么时候可以增加一定的冗余数据呢?我认为有2个原则： 　　1、用户的整体需求。当用户更多的关注于，对数据库的规范记录按一定的算法进行处理后，再列出的数据。如果该算法可以直接利用后台数据库系统的 内嵌函数来完成，此时可以适当的增加冗余字段，甚至冗余表来保存这些经过算法处理后的数据。要知道，对于大批量数据的查询，修改或删除，后台数据库系统的 效率远远高于我们自己编写的代码。 　　2、简化开发的复杂度。现代软件开发，实现同样的功能，方法有很多。尽管不必要求程序员精 通绝大部分的开发工具和平台，但是还是需要了解哪种方法搭配哪种开发工具的程序更简洁，效率更高一些。冗余数据的本质就是用空间换时间，尤其是目前硬件的 发展远远高于软件，所以适当的冗余是可以接受的。不过我还是在最后再强调一下：不要过多的依赖平台和开发工具的特性来简化开发，这个度要是没把握好的话， 后期维护升级会栽大跟头的。</p></div>
	      </div>
        <div class='blog'>
      <h2><a href="#top" class='top'>回到顶部</a><a name="blog_157079" href="https://my.oschina.net/u/225084/blog/157079">浅谈数据库设计技巧(上)（转）</a></h2>
	  <div class='outline'>
	  <div class='date'>时间：2013-08-26 23:45:34</div>
	  <div class='catalog'>分类：转贴的文章</div>
	  	  	  <div class='tags'>标签：数据库,设计</div>	  	  	  </div>
      <div class='content'><pre><code>   说到数据库， 我认为不能不先谈数据结构。1996年，在我初入大学学习计算机编程时，当时的老师就告诉我们说：计算机程序＝数据结构＋算法。尽管现在的程序开发已由面 向过程为主逐步过渡到面向对象为主，但我还是深深赞同8年前老师的告诉我们的公式：计算机程序＝数据结构＋算法。面向对象的程序开发，要做的第一件事就 是，先分析整个程序中需处理的数据，从中提取出抽象模板，以这个抽象模板设计类，再在其中逐步添加处理其数据的函数(即算法)，最后，再给类中的数据成员和函数划分访问权限，从而实现封装。
</code></pre> 
<p>　　数据库的最初雏形据说源自美国一个奶牛场的记账薄(纸质的，由此可见，数据库并不一定是存储在电脑里的数据^_^)，里面记录的是该奶牛场的收 支账目，程序员在将其整理、录入到电脑中时从中受到启发。当按照规定好的数据结构所采集到的数据量大到一定程度后，出于程序执行效率的考虑，程序员将其中 的检索、更新维护等功能分离出来，做成单独调用的模块，这个模块后来就慢慢发展、演变成现在我们所接触到的数据库管理系统(DBMS)——程序开发中的一 个重要分支。 　　下面进入正题，首先按我个人所接触过的程序给数据库设计人员的功底分一下类： 　　１、没有系统学习过数据结构的程序员。这类程序员的作 品往往只是他们的即兴玩具，他们往往习惯只设计有限的几个表，实现某类功能的数据全部塞在一个表中，各表之间几乎毫无关联。网上不少的免费管理软件都是这 样的东西，当程序功能有限，数据量不多的时候，其程序运行起来没有什么问题，但是如果用其管理比较重要的数据，风险性非常大。 　　２、系统学习过数据结构，但是还没有开发过对程序效率要求比较高的管理软件的程序员。这类人多半刚从学校毕业不久，他们在设计数据库表结构时，严格按照教科书上的规定，死扣E-R图和3NF(别灰心，所有的数据库设计高手都是从这一步开始的)。他们的作品，对于一般的access型轻量级的管理软件，已经够用。但是一旦该系统需要添加新功能，原有的数据库表差不多得进行大换血。 　 　３、第二类程序员，在经历过数次程序效率的提升，以及功能升级的折腾后，终于升级成为数据库设计的老鸟，第一类程序员眼中的高人。这类程序员可以胜任二 十个表以上的中型商业数据管理系统的开发工作。他们知道该在什么样的情况下保留一定的冗余数据来提高程序效率，而且其设计的数据库可拓展性较好，当用户需 要添加新功能时，原有数据库表只需做少量修改即可。 　　４、在经历过上十个类似数据库管理软件的重复设计后，第三类程序员中坚持下来没有转行，而 是希望从中找出“偷懒”窍门的有心人会慢慢觉悟，从而完成量变到质变的转换。他们所设计的数据库表结构有一定的远见，能够预测到未来功能升级所需要的数 据，从而预先留下伏笔。这类程序员目前大多晋级成数据挖掘方面的高级软件开发人员。 　　５、第三类程序员或第四类程序员，在对现有的各家数据库管理系统的原理和开发都有一定的钻研后，要么在其基础上进行二次开发，要么自行开发一套有自主版权的通用数据库管理系统。 　　我个人正处于第三类的末期，所以下面所列出的一些设计技巧只适合第二类和部分第三类数据库设计人员。同时，由于我很少碰到有兴趣在这方面深钻下去的同行，所以文中难免出现错误和遗漏，在此先行声明，欢迎大家指正，不要藏私哦8) 　　一、树型关系的数据表 　　不少程序员在进行数据库设计的时候都遇到过树型关系的数据，例如常见的类别表，即一个大类，下面有若干个子 类，某些子类又有子类这样的情况。当类别不确定，用户希望可以在任意类别下添加新的子类，或者删除某个类别和其下的所有子类，而且预计以后其数量会逐步增 长，此时我们就会考虑用一个数据表来保存这些数据。按照教科书上的教导，第二类程序员大概会设计出类似这样的数据表结构： 类别表_1(Type_table_1) 名称　　　　　类型　　　　约束条件　　　说明 type_id 　 int 　 无重复　　 类别标识，主键 type_name　　char(50) 不允许为空 类型名称，不允许重复 type_father int 不允许为空 该类别的父类别标识，如果是顶节点的话设定为某个唯一值 　　这样的设计短小精悍，完全满足3NF，而且可以满足用户的所有要求。是不是这样就行呢？答案是NO！Why？ 　　我们来估计一下用户希望如何罗列出这个表的数据的。对用户而言，他当然期望按他所设定的层次关系一次罗列出所有的类别，例如这样： 总类别 　　类别1 　　　　类别1.1 　　　　　　类别1.1.1 　　　　类别1.2 　　类别2 　　　　类别2.1 　　类别3 　　　　类别3.1 　　　　类别3.2 　　…… 　　看看为了实现这样的列表显示(树的先序遍历)，要对上面的表进行多少次检索？注意，尽管类别1.1.1可能是在类别3.2之后添加的记录，答案 仍然是N次。这样的效率对于少量的数据没什么影响，但是日后类型扩充到数十条甚至上百条记录后，单单列一次类型就要检索数十次该表，整个程序的运行效率就 不敢恭维了。或许第二类程序员会说，那我再建一个临时数组或临时表，专门保存类型表的先序遍历结果，这样只在第一次运行时检索数十次，再次罗列所有的类型 关系时就直接读那个临时数组或临时表就行了。其实，用不着再去分配一块新的内存来保存这些数据，只要对数据表进行一定的扩充，再对添加类型的数量进行一下 约束就行了，要完成上面的列表只需一次检索就行了。下面是扩充后的数据表结构： 类别表_2(Type_table_2) 名称　　　　　类型　　　　约束条件　　　 说明 type_id 　 int 　 无重复　　 类别标识，主键 type_name　　char(50) 不允许为空 类型名称，不允许重复 type_father int 不允许为空 该类别的父类别标识，如果是顶节点的话设定为某个唯一值 type_layer char(6) 限定3层,初始值为000000 类别的先序遍历，主要为减少检索数据库的次数 　　按照这样的表结构，我们来看看上面例子记录在表中的数据是怎样的： type_id type_name type_father type_layer 1 总类别 0 000000 2 类别1 1 010000 3 类别1.1 2 010100 4 类别1.2 2 010200 5 类别2 1 020000 6 类别2.1 5 020100 7 类别3 1 030000 8 类别3.1 7 030100 9 类别3.2 7 030200 10 类别1.1.1 3 010101 …… 　　现在按type_layer的大小来检索一下：SELECT * FROM Type_table_2 ORDER BY type_layer 列出记录集如下： type_id type_name type_father type_layer 1 总类别 0 000000 2 类别1 1 010000 3 类别1.1 2 010100 10 类别1.1.1 3 010101 4 类别1.2 2 010200 5 类别2 1 020000 6 类别2.1 5 020100 7 类别3 1 030000 8 类别3.1 7 030100 9 类别3.2 7 030200 …… 　　现在列出的记录顺序正好是先序遍历的结果。在控制显示类别的层次时，只要对type_layer字段中的数值进行判断，每2位一组，如大于0则 向右移2个空格。当然，我这个例子中设定的限制条件是最多3层，每层最多可设99个子类别，只要按用户的需求情况修改一下type_layer的长度和位 数，即可更改限制层数和子类别数。其实，上面的设计不单单只在类别表中用到，网上某些可按树型列表显示的论坛程序大多采用类似的设计。 　　或许有人认为，Type_table_2中的type_father字段是冗余数据，可以除去。如果这样，在插入、删除某个类别的时候，就得对 type_layer 的内容进行比较繁琐的判定，所以我并没有消去type_father字段，这也正符合数据库设计中适当保留冗余数据的来降低程序复杂度的原则，后面我会举 一个故意增加数据冗余的案例。 　　 　　二、商品信息表的设计 　　假设你是一家百货公司电脑部的开发人员，某天老板要求你为公司开发一套网上电子商务平台，该百货 公司有数千种商品出售，不过目前仅打算先在网上销售数十种方便运输的商品，当然，以后可能会陆续在该电子商务平台上增加新的商品出售。现在开始进行该平台 数据库的商品信息表的设计。每种出售的商品都会有相同的属性，如商品编号，商品名称，商品所属类别，相关信息，供货厂商，内含件数，库存，进货价，销售 价，优惠价。你很快就设计出4个表：商品类型表(Wares_type)，供货厂商表(Wares_PRovider)，商品信息表(Wares_info)： 商品类型表(Wares_type) 名称　　　　　类型　　　　约束条件　　　 说明 type_id 　 int 　 无重复　　 类别标识，主键 type_name　　 char(50) 不允许为空 类型名称，不允许重复 type_father int 不允许为空 该类别的父类别标识，如果是顶节点的话设定为某个唯一值 type_layer char(6) 限定3层,初始值为000000 类别的先序遍历，主要为减少检索数据库的次数 供货厂商表(Wares_provider) 名称　　　　　 类型　　　　约束条件　　　 说明 provider_id int 　 无重复　　 供货商标识，主键 provider_name char(100) 不允许为空 供货商名称 商品信息表(Wares_info) 名称　　　　 类型　　　　约束条件　　　 说明 wares_id int 　 无重复　　 商品标识，主键 wares_name char(100) 不允许为空 商品名称 wares_type　　 int 不允许为空　　　　　商品类型标识，和Wares_type.type_id关联 wares_info char(200) 允许为空 相关信息 provider int 不允许为空 供货厂商标识，和Wares_provider.provider_id关联 setnum int 初始值为1 内含件数，默认为1 stock int 初始值为0 库存，默认为0 buy_price money 不允许为空 进货价 sell_price money 不允许为空 销售价 discount money 不允许为空 优惠价 　　你拿着这3个表给老板检查，老板希望能够再添加一个商品图片的字段，不过只有一部分商品有图片。OK，你在商品信息表(Wares_info)中增加了一个haspic的BOOL型字段，然后再建了一个新表——商品图片表(Wares_pic)： 商品图片表(Wares_pic) 名称　　　　 类型　　　　约束条件　　　 说明 pic_id int 　 无重复　　 商品图片标识，主键 wares_id int 不允许为空 所属商品标识，和Wares_info.wares_id关联 pic_address　 char(200) 不允许为空　　　　　　 图片存放路径 　　程序开发完成后，完全满足老板目前的要求，于是正式启用。一段时间后，老板打算在这套平台上推出新的商品销售，其中，某类商品全部都需添加“长 度”的属性。第一轮折腾来了……当然，你按照添加商品图片表的老方法，在商品信息表(Wares_info)中增加了一个haslength的BOOL型 字段，又建了一个新表——商品长度表(Wares_length)： 商品长度表(Wares_length) 名称　　　　 类型　　　　约束条件　　　 说明 length_id int 　 无重复　　 商品图片标识，主键 wares_id int 不允许为空 所属商品标识，和Wares_info.wares_id关联 length　 char(20) 不允许为空　　　　　商品长度说明 　　刚刚改完没多久，老板又打算上一批新的商品，这次某类商品全部需要添加“宽度”的属性。你咬了咬牙，又照方抓药，添加了商品宽度表 (Wares_width)。又过了一段时间，老板新上的商品中有一些需要添加“高度”的属性，你是不是开始觉得你所设计的数据库按照这种方式增长下去， 很快就能变成一个迷宫呢？那么，有没有什么办法遏制这种不可预见性，但却类似重复的数据库膨胀呢？我在阅读《敏捷软件开发：原则、模式与实践》中发现作者 举过类似的例子：7.3　“Copy”程序。其中，我非常赞同敏捷软件开发这个观点：在最初几乎不进行预先设计，但是一旦需求发生变化，此时作为一名追求 卓越的程序员，应该从头审查整个架构设计，在此次修改中设计出能够满足日后类似修改的系统架构。下面是我在需要添加“长度”的属性时所提供的修改方案： 　　去掉商品信息表(Wares_info)中的haspic字段，添加商品额外属性表(Wares_ex_property)和商品额外信息表(Wares_ex_info)2个表来完成添加新属性的功能。 商品额外属性表(Wares_ex_property) 名称　　　　 类型　　　　约束条件　　　 说明 ex_pid int 　 无重复　　 商品额外属性标识，主键 p_name char(20) 不允许为空 额外属性名称 商品额外信息表(Wares_ex_info) 名称　　　　 类型　　　　约束条件　　　 说明 ex_iid int 　 无重复　　 商品额外信息标识，主键 wares_id int 不允许为空 所属商品标识，和Wares_info.wares_id关联 property_id　 int 不允许为空　　　　 商品额外属性标识，和Wares_ex_property.ex_pid关联 property_value char(200) 不允许为空 商品额外属性值 　　在商品额外属性表(Wares_ex_property)中添加2条记录： ex_pid p_name 1 商品图片 2 商品长度 　　再在整个电子商务平台的后台管理功能中追加一项商品额外属性管理的功能，以后添加新的商品时出现新的属性，只需利用该功能往商品额外属性表 (Wares_ex_property)中添加一条记录即可。不要害怕变化，被第一颗子弹击中并不是坏事，坏的是被相同轨道飞来的第二颗、第三颗子弹击 中。第一颗子弹来得越早，所受的伤越重，之后的抵抗力也越强8)(待续)</p></div>
	      </div>
      </div>
</body>
</html>
                        